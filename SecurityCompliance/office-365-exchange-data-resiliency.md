---
title: Устойчивость данных Exchange 365 в Office
ms.author: robmazz
author: robmazz
manager: laurawi
ms.date: 8/21/2018
audience: ITPro
ms.topic: article
ms.service: Office 365 Administration
localization_priority: None
search.appverid:
- MET150
ms.collection:
- Strat_O365_IP
- M365-security-compliance
description: Описание различных аспектов обеспечения устойчивости данных в Exchange Online и Office 365.
ms.openlocfilehash: 5c0f42d1abc48b497a915354e3056b47a41326c5
ms.sourcegitcommit: c94cb88a9ce5bcc2d3c558f0fcc648519cc264a2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/20/2019
ms.locfileid: "30090951"
---
# <a name="exchange-online-data-resiliency-in-office-365"></a><span data-ttu-id="29b10-103">Устойчивость данных Exchange Online в Office 365</span><span class="sxs-lookup"><span data-stu-id="29b10-103">Exchange Online Data Resiliency in Office 365</span></span>

## <a name="introduction"></a><span data-ttu-id="29b10-104">Введение</span><span class="sxs-lookup"><span data-stu-id="29b10-104">Introduction</span></span>
<span data-ttu-id="29b10-p101">Существует два типа повреждений, которые могут повлиять на базу данных Exchange: физическое повреждение, которое обычно вызвано оборудованием (в частности, аппаратным обеспечением хранилища), а также логическим повреждением, которое происходит из-за других факторов. Как правило, существует два типа логических повреждений, которые могут возникать в базе данных Exchange:</span><span class="sxs-lookup"><span data-stu-id="29b10-p101">There are two types of corruption that can affect an Exchange database: physical corruption, which is typically caused by hardware (in particular, storage hardware) problems, and logical corruption, which occurs due to other factors. Generally, there are two types of logical corruption that can occur within an Exchange database:</span></span> 
- <span data-ttu-id="29b10-p102">**Логическое повреждение базы данных** — контрольная сумма страницы базы данных совпадает, но данные на странице логически неверны. Это может произойти, если ядро СУБД (расширенный обработчик хранилищ (ESE)) пытается записать страницу базы данных и даже несмотря на то, что операционная система возвращает сообщение об успешном выполнении, данные либо никогда не записываются на диск, либо записываются в неправильное место. Это называется потерянным списанием \*\*. ESE включает многочисленные функции и меры безопасности, предназначенные для предотвращения физического повреждения базы данных и других сценариев потери данных. Чтобы предотвратить потерю данных, ESE включает в базу данных механизм обнаружения потерянных очисток вместе с компонентом (восстановление одной страницы), чтобы исправить ее.</span><span class="sxs-lookup"><span data-stu-id="29b10-p102">**Database logical corruption** - The database page checksum matches, but the data on the page is wrong logically. This can occur when the database engine (the Extensible Storage Engine (ESE)) attempts to write a database page and even though the operating system returns a success message, the data is either never written to the disk or it's written to the wrong place. This is referred to as a *lost flush*. ESE includes numerous features and safeguards that are designed to prevent physical corruption of a database and other data loss scenarios. To prevent lost flushes from losing data, ESE includes a lost flush detection mechanism in the database along with a feature (single page restore) to correct it.</span></span> 
- <span data-ttu-id="29b10-p103">**Хранение логического повреждения** — данные добавляются, удаляются или обрабатываются в том виде, в котором пользователь не ожидается. Эти случаи обычно вызваны сторонними приложениями. Как правило, это лишь повреждение в том смысле, что пользователь просматривает его как поврежденный. Хранилище Exchange считает транзакцию, приведшую к логической порче, серией допустимых операций MAPI. Функции [хранения на месте](https://docs.microsoft.com/exchange/security-and-compliance/create-or-remove-in-place-holds) в Exchange Online обеспечивают защиту от логического повреждения хранилища (так как предотвращает окончательное удаление содержимого пользователем или приложением).</span><span class="sxs-lookup"><span data-stu-id="29b10-p103">**Store logical corruption** - Data is added, deleted, or manipulated in a way that the user doesn't expect. These cases are generally caused by third-party applications. It's generally only corruption in the sense that the user views it as corruption. The Exchange store considers the transaction that produced the logical corruption to be a series of valid MAPI operations. The [In-Place Hold](https://docs.microsoft.com/exchange/security-and-compliance/create-or-remove-in-place-holds) features in Exchange Online provides protection from store logical corruption (because it prevents content from being permanently deleted by a user or an application).</span></span> 

<span data-ttu-id="29b10-p104">Exchange Online выполняет несколько проверок согласованности в файлах реплицированных журналов во время проверки журнала и преобразования журнала. Эти проверки согласованности предотвращают репликацию системы с физическим повреждением. Например, во время проверки журнала существует физическая проверка целостности, которая проверяет файл журнала и проверяет, совпадает ли контрольная сумма, записанная в файле журнала, с контрольной суммой, созданной в памяти. Кроме того, заголовком файла журнала считается проверка того, что подпись файла журнала, записанная в заголовке журнала, совпадает с именем файла журнала. Во время повтора журнала файл журнала становится еще больше. Например, заголовок базы данных также содержит подпись журнала, которая сравнивается с подписью файла журнала, чтобы убедиться, что они совпадают.</span><span class="sxs-lookup"><span data-stu-id="29b10-p104">Exchange Online performs several consistency checks on replicated log files during both log inspection and log replay. These consistency checks prevent physical corruption from being replicated by the system. For example, during log inspection, there is a physical integrity check which verifies the log file and validates that the checksum recorded in the log file matches the checksum generated in memory. In addition, the log file header is examined to make sure the log file signature recorded in the log header matches that of the log file. During log replay, the log file undergoes further scrutiny. For example, the database header also contains the log signature which is compared with the log file's signature to ensure they match.</span></span> 

<span data-ttu-id="29b10-p105">Защита от повреждения данных почтовых ящиков в Exchange Online достигается с помощью собственной защиты данных Exchange, стратегии устойчивости, использующей репликацию на уровне приложения на нескольких серверах и нескольких центрах обработки данных вместе с другими функции, помогающие предотвратить потерю данных из-за повреждения или по другим причинам. К этим функциям относятся встроенные функции, управляемые корпорацией Майкрософт или самим приложением Exchange Online, в том числе:</span><span class="sxs-lookup"><span data-stu-id="29b10-p105">Protection against corruption of mailbox data in Exchange Online is achieved by using Exchange Native Data Protection, a resiliency strategy that leverages application-level replication across multiple servers and multiple datacenters along with other features that help protect data from being lost due to corruption or other reasons. These features include native features that are managed by Microsoft or the Exchange Online application itself, such as:</span></span>

- [<span data-ttu-id="29b10-125">Группы обеспечения доступности данных</span><span class="sxs-lookup"><span data-stu-id="29b10-125">Data Availability Groups</span></span>](https://docs.microsoft.com/exchange/back-up-email)
- <span data-ttu-id="29b10-126">ОдноРазрядная одноСторонняя коррекция</span><span class="sxs-lookup"><span data-stu-id="29b10-126">Single Bit Correction</span></span> 
- <span data-ttu-id="29b10-127">Сканирование оперативной базы данных</span><span class="sxs-lookup"><span data-stu-id="29b10-127">Online Database Scanning</span></span> 
- <span data-ttu-id="29b10-128">Обнаружение потерянных очисток</span><span class="sxs-lookup"><span data-stu-id="29b10-128">Lost Flush Detection</span></span> 
- <span data-ttu-id="29b10-129">Восстановление отдельных страниц</span><span class="sxs-lookup"><span data-stu-id="29b10-129">Single Page Restore</span></span> 
- <span data-ttu-id="29b10-130">Служба репликации поЧтовых ящиков</span><span class="sxs-lookup"><span data-stu-id="29b10-130">Mailbox Replication Service</span></span> 
- <span data-ttu-id="29b10-131">Проверки файлов журналов</span><span class="sxs-lookup"><span data-stu-id="29b10-131">Log File Checks</span></span> 
- <span data-ttu-id="29b10-132">Развертывание в отказоустойчивой файловой системе</span><span class="sxs-lookup"><span data-stu-id="29b10-132">Deployment on Resilient File System</span></span> 

<span data-ttu-id="29b10-p106">Для получения дополнительных сведений о встроенных функциях, приведенных выше, щелкните приведенные выше гиперссылки и просмотрите дополнительные сведения и подробные сведения об элементах без гиперссылок. Кроме этих встроенных функций, Exchange Online также включает функции обеспечения устойчивости данных, которыми могут управлять пользователи, например:</span><span class="sxs-lookup"><span data-stu-id="29b10-p106">For more information on the native features listed above, click on the above hyperlinks, and see below for additional information and for details on items without hyperlinks. In addition to these native features, Exchange Online also includes data resiliency features that customers can manage, such as:</span></span> 
- [<span data-ttu-id="29b10-135">Восстановление отдельных элементов (включено по умолчанию)</span><span class="sxs-lookup"><span data-stu-id="29b10-135">Single Item Recovery (enabled by default)</span></span>](https://docs.microsoft.com/exchange/recipients-in-exchange-online/manage-user-mailboxes/recover-deleted-messages) 
- [<span data-ttu-id="29b10-136">Хранение на месте и хранение для судебного разбирательства</span><span class="sxs-lookup"><span data-stu-id="29b10-136">In-Place Hold and Litigation Hold</span></span>](https://docs.microsoft.com/exchange/security-and-compliance/in-place-and-litigation-holds) 
- [<span data-ttu-id="29b10-137">Хранение удаленных элементов и обратимо удаленные поЧтовые ящики (включены по умолчанию)</span><span class="sxs-lookup"><span data-stu-id="29b10-137">Deleted Item Retention and Soft-Deleted Mailboxes (both enabled by default)</span></span>](https://docs.microsoft.com/exchange/recipients-in-exchange-online/delete-or-restore-mailboxes) 

## <a name="database-availability-groups"></a><span data-ttu-id="29b10-138">Группы доступности базы данных</span><span class="sxs-lookup"><span data-stu-id="29b10-138">Database Availability Groups</span></span> 
<span data-ttu-id="29b10-p107">Каждая база данных почтовых ящиков в Office 365 размещается в [группе обеспечения доступности баз данных (DAG)](https://docs.microsoft.com/exchange/back-up-email) и реплицируется на географически раздельные центры обработки данных в пределах одного региона. Наиболее распространенная конфигурация состоит из четырех копий базы данных в четырех центрах обработки данных; Однако в некоторых регионах меньше центров данных (базы данных реплицируются в три центра данных в Индии и два центра обработки данных в Австралии и Японии). Однако во всех случаях каждая база данных почтовых ящиков содержит четыре копии, распределенные между несколькими центрами обработки данных, что гарантирует защиту данных почтовых ящиков от программного обеспечения, аппаратного обеспечения и даже неисправностей центра данных.</span><span class="sxs-lookup"><span data-stu-id="29b10-p107">Every mailbox database in Office 365 is hosted in a [database availability group (DAG)](https://docs.microsoft.com/exchange/back-up-email) and replicated to geographically-separate datacenters within the same region. The most common configuration is four database copies in four datacenters; however, some regions have fewer datacenters (databases are replicated to three datacenters in India, and two datacenters in Australia and Japan). But in all cases, every mailbox database has four copies that are distributed across multiple datacenters, thereby ensuring that mailbox data is protected from software, hardware, and even datacenter failures.</span></span> 

<span data-ttu-id="29b10-p108">Из этих четырех копий все три из них настраиваются как высокодоступные. Четвертая копия настроена как [копия базы данных изолированной](https://docs.microsoft.com/Exchange/high-availability/manage-ha/activate-lagged-db-copies). Копия базы данных изолированной не предназначена для восстановления отдельных почтовых ящиков или восстановления элементов почтового ящика. Его цель — предоставить механизм восстановления для редкого логического повреждения на уровне системы.</span><span class="sxs-lookup"><span data-stu-id="29b10-p108">Out of these four copies, three of them are configured as highly available. The fourth copy is configured as a [lagged database copy](https://docs.microsoft.com/Exchange/high-availability/manage-ha/activate-lagged-db-copies). The lagged database copy is not intended for individual mailbox recovery or mailbox item recovery. Its purpose is to provide a recovery mechanism for the rare event of system-wide, catastrophic logical corruption.</span></span> 

<span data-ttu-id="29b10-p109">Для копий базы данных изолированной в Exchange Online настроено время задержки преобразования файла журнала в семь дней. Кроме того, диспетчер задержки воспроизведений Exchange включается для создания динамического файла журнала для копий изолированной, чтобы позволить изолированной копии базы данных для автоматического восстановления и управления ростом файла журнала. Несмотря на то, что в Exchange Online используются копии баз данных изолированной, важно понимать, что они не гарантированно представляют собой резервную копию на момент времени. Изолированной копии базы данных в Exchange Online имеют пороговое значение доступности, обычно около 90% из-за тех периодов, когда диск с копией изолированной теряется из-за сбоя диска, изолированной копия становится высокодоступной копией (из-за автоматического проигрывания), а также в качестве периодов, в которых копия базы данных изолированной перемещает очередь повтора журнала.</span><span class="sxs-lookup"><span data-stu-id="29b10-p109">Lagged database copies in Exchange Online are configured with a seven-day log file replay lag time. In addition, the Exchange Replay Lag Manager is enabled to provide dynamic log file play down for lagged copies to allow lagged database copies to self-repair and manage log file growth. Although lagged database copies are used in Exchange Online, it is important to understand that they are not a guaranteed point-in-time backup. Lagged database copies in Exchange Online have an availability threshold, typically around 90%, due to periods where the disk containing a lagged copy is lost due to disk failure, the lagged copy becoming a highly-available copy (due to automatic play down), as well as the periods where the lagged database copy is re-building the log replay queue.</span></span> 

## <a name="transport-resilience"></a><span data-ttu-id="29b10-150">Устойчивость транспорта</span><span class="sxs-lookup"><span data-stu-id="29b10-150">Transport Resilience</span></span> 
<span data-ttu-id="29b10-p110">Exchange Online включает две основные функции обеспечения устойчивости транспорта: теневая избыточность и сеть безопасности. Теневая избыточность сохраняет резервную копию сообщения, находясь в пути. Служба безопасности сети сохраняет резервную копию сообщения после успешной доставки сообщения.</span><span class="sxs-lookup"><span data-stu-id="29b10-p110">Exchange Online includes two primary transport resilience features: Shadow Redundancy and Safety Net. Shadow Redundancy keeps a redundant copy of a message while it is in transit. Safety Net keeps a redundant copy of a message after the message is successfully delivered.</span></span> 

<span data-ttu-id="29b10-p111">При теневом резервировании каждый транспортный сервер Exchange Online создает копию каждого сообщения, которое он получает, прежде чем подтвердить успешное получение сообщения серверу-отправителю. Это делает все сообщения в транспортном конвейере избыточными при передаче. Если Exchange Online определяет исходное сообщение было разорвано при передаче, резервная копия сообщения будет доставлена повторно.</span><span class="sxs-lookup"><span data-stu-id="29b10-p111">With Shadow Redundancy, each Exchange Online transport server makes a copy of each messages it receives before it acknowledges successfully receiving the message to the sending server. This makes all messages in the transport pipeline redundant while in transit. If Exchange Online determines the original message was lost in transit, a redundant copy of the message is redelivered.</span></span> 

<span data-ttu-id="29b10-p112">Служба безопасности сети — это транспортная очередь, связанная со службой транспорта на сервере поЧтовых ящиков. В этой очереди хранятся копии сообщений, которые были успешно обработаны сервером. Если для базы данных почтовых ящиков или сервера почтовых ящиков требуется активация устаревших копий базы данных почтовых ящиков, сообщения в очереди безопасности сети автоматически повторно отправляются на новую активную копию базы данных почтовых ящиков. Кроме того, эта сеть также является избыточной и исключает транспортную систему в качестве единой точки отказа. Он использует концепцию основной сети безопасности и теневой сети безопасности, где если основная сеть безопасности недоступна в течение более 12 часов, запросы на повторную отправку преобразуются в теневые запросы на повторную отправку, а сообщения передаются из теневой сети безопасности.</span><span class="sxs-lookup"><span data-stu-id="29b10-p112">Safety Net is a transport queue that is associated with the Transport service on a Mailbox server. This queue stores copies of messages that were successfully processed by the server. When a mailbox database or server failure requires activating an out-of-date copy of the mailbox database, messages in the Safety Net queue are automatically resubmitted to the new active copy of the mailbox database. Safety Net is also redundant, thereby eliminating transport as a single point of failure. It uses the concept of a Primary Safety Net and a Shadow Safety Net wherein if the Primary Safety Net is unavailable for more than 12 hours, resubmit requests become shadow resubmit requests, and messages are re-delivered from the Shadow Safety Net.</span></span>

<span data-ttu-id="29b10-p113">Повторные отправки сообщений из сети безопасности автоматически инициируются компонентом Active Manager службы репликации Microsoft Exchange, который управляет копиями базы данных DAG и почтовых ящиков. Ручные действия для повторной подачи сообщений из сети безопасности не требуются.</span><span class="sxs-lookup"><span data-stu-id="29b10-p113">Message resubmissions from Safety Net are automatically initiated by the Active Manager component of the Microsoft Exchange Replication service that manages DAGs and mailbox database copies. No manual actions are required to resubmit messages from Safety Net.</span></span> 

## <a name="single-bit-correction"></a><span data-ttu-id="29b10-164">ОдноРазрядная одноСторонняя коррекция</span><span class="sxs-lookup"><span data-stu-id="29b10-164">Single Bit Correction</span></span> 
<span data-ttu-id="29b10-p114">ESE включает механизм обнаружения и разрешения одноразрядных ошибок CRC (с последующими перелистываниеми одноразрядных версий), которые являются результатом ошибок оборудования (и, как таковых, отражает физическую порчу). При возникновении этих ошибок ESE автоматически исправляет их и регистрирует событие в журнале событий.</span><span class="sxs-lookup"><span data-stu-id="29b10-p114">ESE includes a mechanism to detect and resolve single-bit CRC errors (aka single-bit flips) that are the result of hardware errors (and as such they represent physical corruption). When these errors occur, ESE automatically corrects them and logs an event in the event log.</span></span> 

## <a name="online-database-scanning"></a><span data-ttu-id="29b10-167">Сканирование оперативной базы данных</span><span class="sxs-lookup"><span data-stu-id="29b10-167">Online Database Scanning</span></span> 
<span data-ttu-id="29b10-p115">Сканирование оперативной базы данных (также называется контрольной *суммой базы данных*) — это процесс, в котором ESE использует проверку согласованности базы данных для чтения каждой страницы и проверки повреждения страницы. Основной целью является обнаружение физических повреждений и потерянных очисток, которые могут быть не обнаружены транзакционными операциями. Сканирование базы данных также выполняет операции сбоя постового хранения. Из-за сбоев может произойти утечка памяти, и при сканировании оперативной базы данных выполняется поиск и восстановление потерянного места. Система разработана с учетом того, что каждая база данных полностью сканируется каждые семь дней.</span><span class="sxs-lookup"><span data-stu-id="29b10-p115">Online database scanning (also known as *database checksumming*) is the process where an ESE uses a database consistency checker to read each page and check for page corruption. The primary purpose is to detect physical corruption and lost flushes that may not be getting detected by transactional operations. Database scanning also performs post-store crash operations. Space can be leaked due to crashes, and online database scanning finds and recovers lost space. The system is designed with the expectation that every database is fully scanned once every seven days.</span></span> 

## <a name="lost-flush-detection"></a><span data-ttu-id="29b10-173">Обнаружение потерянных очисток</span><span class="sxs-lookup"><span data-stu-id="29b10-173">Lost Flush Detection</span></span> 
<span data-ttu-id="29b10-p116">Потерянный сброс происходит, когда операция записи базы данных, возвращенная дисковой подсистемой или операционной системой, не была записана на диск или была записана в неправильном месте. Потерянные инциденты очистки могут приводить к логическому повреждению базы данных, поэтому для предотвращения потери данных в результате потерянных данных ESE включает механизм обнаружения потерянных очисток. Так как страницы базы данных записываются в пассивные копии, выполняется проверка на наличие потерянных очисток в активной копии. Если обнаружен потерянный диск, ESE может восстановить процесс с помощью процесса исправления страницы.</span><span class="sxs-lookup"><span data-stu-id="29b10-p116">A lost flush occurs when a database write operation that the disk subsystem/operating system returned as completed did not actually get written to disk, or was written in the wrong location. Lost flush incidents can result in database logical corruption, so to prevent lost flushes from resulting in lost data, ESE includes a lost flush detection mechanism. As database pages are written to passive copies, a check is performed for lost flushes on the active copy. If a lost flush is detected, ESE can repair the process using a page patching process.</span></span> 

## <a name="single-page-restore"></a><span data-ttu-id="29b10-178">Восстановление отдельных страниц</span><span class="sxs-lookup"><span data-stu-id="29b10-178">Single Page Restore</span></span> 
<span data-ttu-id="29b10-p117">Восстановление одной страницы с помощью одноименной *страницы*— это автоматический процесс, в котором поврежденные страницы базы данных заменяются работоспособными копиями из работоспособной реплики. Процесс восстановления поврежденной страницы зависит от того, является ли копия базы данных активной или пассивной. Когда активная копия базы данных обнаруживает поврежденную страницу, она может скопировать страницу из одной из ее реплик, если страница, которую она копирует, полностью обновлена. Это достигается путем добавления запроса страницы в поток журнала, который является основой репликации базы данных почтовых ящиков. Как только реплика встречает запрос страницы, она реагирует на нее, отправляя копию страницы в запрашивающую копию базы данных. Восстановление одной страницы также предоставляет механизм асинхронной связи для активного запроса страницы от реплик, даже если реплики находятся в автономном режиме.</span><span class="sxs-lookup"><span data-stu-id="29b10-p117">Single page restore, aka *page patching*, is an automatic process where corrupt database pages are replaced by healthy copies from a healthy replica. The repair process for a corrupt page depends on whether the database copy is active or passive. When an active database copy encounters a corrupted page, it can copy a page from one of its replicas, provided the page it copies is completely up-to-date. This is accomplished by putting a request for the page into the log stream, which is the basis of mailbox database replication. As soon as a replica encounters the page request it responds by sending a copy of the page to the requesting database copy. Single page restore also provides an asynchronous communication mechanism for the active to request a page from replicas, even if the replicas are currently offline.</span></span> 

<span data-ttu-id="29b10-p118">В случае повреждения в пассивной копии базы данных, в том числе копии базы данных изолированной, так как эти копии всегда находятся за активной копией, всегда безопасно копировать любую страницу из активной копии в пассивную копию. Пассивная копия базы данных по природе строго доступна, поэтому во время процесса исправления страниц восстановление журнала приостанавливается, но копирование журнала продолжается. Пассивная копия базы данных извлекает копию поврежденной страницы из активной копии, дождитесь копирования и проверки файла журнала, удовлетворяющего максимально необходимым требованиям для создания журнала, и последующее Исправление поврежденной страницы. После исправления страницы возобновляет воспроизведение журнала. Этот процесс аналогичен для копии базы данных изолированной, за исключением того, что база данных изолированной сначала воспроизводит все файлы журналов, необходимые для достижения исправленного состояния.</span><span class="sxs-lookup"><span data-stu-id="29b10-p118">In case of corruption in a passive database copy, including a lagged database copy, because these copies are always behind their active copy, it is always safe to copy any page from the active copy to a passive copy. A passive database copy is by nature highly available, so during the page patching process, log replaying is suspended, but log copying continues. The passive database copy retrieves a copy of the corrupted page from the active copy, waits until the log file which meets the maximum required log generation requirement is copied and inspected, and then patches the corrupt page. Once the page has been patched, log replay resumes. The process is the same for the lagged database copy, except that the lagged database first replays all log files that are necessary to achieve a patchable state.</span></span> 

## <a name="mailbox-replication-service"></a><span data-ttu-id="29b10-190">Служба репликации поЧтовых ящиков</span><span class="sxs-lookup"><span data-stu-id="29b10-190">Mailbox Replication Service</span></span> 
<span data-ttu-id="29b10-p119">Перемещение почтовых ящиков является ключевой частью управления крупномасштабной службой электронной почты. Вы всегда обновили технологии и аппаратные обновления и обновления версий, чтобы обеспечить надежную, регулируемую систему, позволяющую нашим специалистам выполнять эту работу, сохранив почтовые ящики прозрачными для пользователей (убедившись, что они остаются в сети). во всем процессе) — это ключ и гарантируется, что процесс постепенно масштабируется, как почтовые ящики увеличен и больше.</span><span class="sxs-lookup"><span data-stu-id="29b10-p119">Moving mailboxes is a key part of managing a large-scale email service. There are always updated technologies and hardware and version upgrades to deal with, so having a robust, throttled system that enables our engineers to accomplish this work while keeping the mailbox moves transparent to users (by making sure they stay online throughout the process) is key and making sure that the process scales up gracefully as mailboxes get larger and larger.</span></span> 

<span data-ttu-id="29b10-p120">Служба репликации поЧтовых ящиков Exchange (MRS) отвечает за перемещение почтовых ящиков между базами данных. Во время перемещения MRS выполняет проверку согласованности для всех элементов в почтовом ящике. Если обнаружена проблема с согласованием, MRS либо исправляет проблему, либо пропускует поврежденные элементы, что приведет к удалению поврежденного почтового ящика.</span><span class="sxs-lookup"><span data-stu-id="29b10-p120">The Exchange Mailbox Replication Service (MRS) is responsible for moving mailboxes between databases. During the move, MRS performs a consistency check on all items within the mailbox. If a consistency issue is found, MRS will either correct the problem, or skip the corrupted items, thereby removing the corruption from the mailbox.</span></span> 

<span data-ttu-id="29b10-p121">Так как MRS является компонентом Exchange Online, мы можем вносить изменения в свой код, чтобы устранить новые формы повреждений, обнаруженных в будущем. Например, если мы определим проблему согласованности, которую MRS не удается исправить, мы можем проанализировать повреждение, изменить код MRS и исправить несоответствие (если мы понимаем, как).</span><span class="sxs-lookup"><span data-stu-id="29b10-p121">Because MRS is a component of Exchange Online, we can make changes in its code to address new forms of corruption that are detected in the future. For example, if we detect a consistency issue that MRS is not able to fix, we can analyze the corruption, change the MRS code and correct the inconsistency (if we understand how to).</span></span> 

## <a name="log-file-checks"></a><span data-ttu-id="29b10-198">Проверки файлов журналов</span><span class="sxs-lookup"><span data-stu-id="29b10-198">Log File Checks</span></span> 
<span data-ttu-id="29b10-p122">Все файлы журналов транзакций, созданные базой данных Exchange, передаются в несколько видов проверки согласованности. При создании файла журнала первым делом является записывается битовый шаблон, а затем выполняется ряд операций записи в журнал. Это позволяет Exchange Online выполнять серию проверок (потерянных, КОНТРОЛЬных сумм и других проверок) для проверки каждого файла журнала при его записи и при репликации.</span><span class="sxs-lookup"><span data-stu-id="29b10-p122">All transaction log files generated by an Exchange database undergo several forms of consistency checks. When a log file is created, the first thing done is a bit pattern is written and then a series of log writes is performed. This enables Exchange Online to execute a series of checks (lost flush, CRC and other checks) to validate each log file as it is written, and again as it is replicated.</span></span> 

## <a name="deployment-on-resilient-file-system"></a><span data-ttu-id="29b10-202">Развертывание в отказоустойчивой файловой системе</span><span class="sxs-lookup"><span data-stu-id="29b10-202">Deployment on Resilient File System</span></span> 
<span data-ttu-id="29b10-p123">Чтобы защититься от повреждения на уровне файловой системы, Exchange Online развертывается в разделах отказоустойчивой файловой системы (ReFS) для обеспечения улучшенных возможностей восстановления. ReFS — это файловая система в Windows Server 2012 и более поздних версий, которая обеспечивает более устойчивую устойчивость к повреждению данных, обеспечивая доступность данных и целостность. В частности, ReFS приносит улучшения в способе обновления метаданных, что обеспечивает лучшую защиту данных и сокращает случаи повреждения данных. Он также использует контрольные суммы для проверки целостности данных файла и метаданных, гарантирующих простоту обнаружения и восстановления поврежденных данных.</span><span class="sxs-lookup"><span data-stu-id="29b10-p123">To help prevent corruption from occurring at the file system level, Exchange Online is being deployed on Resilient File System (ReFS) partitions to provide improved recovery capabilities. ReFS is a file system in Windows Server 2012 and later that is designed to be more resilient against data corruption thereby maximizing data availability and integrity. Specifically, ReFS brings improvements in the way that metadata is updated which offers better protection for data and reduces data corruption cases. It also uses checksums to verify the integrity of file data and metadata ensuring that data corruption is easily found and repaired.</span></span> 

<span data-ttu-id="29b10-207">Exchange Online использует несколько преимуществ в ReFS:</span><span class="sxs-lookup"><span data-stu-id="29b10-207">Exchange Online takes advantage of several ReFS benefits:</span></span> 
- <span data-ttu-id="29b10-p124">Более устойчивость к целостности данных означает меньше случаев повреждения данных. Уменьшение числа инцидентов повреждений означает уменьшение числа ненужных перезаполнений базы данных.</span><span class="sxs-lookup"><span data-stu-id="29b10-p124">More resiliency in data integrity means fewer data corruption incidents. Reducing the number of corruption incidents means fewer unnecessary database reseeds.</span></span> 
- <span data-ttu-id="29b10-210">Контрольная сумма, позволяющая обнаруживать случаи повреждения в случае более ранних и более детерминированных ситуаций, позволяющая нам устранять повреждение данных клиента до того, как на томах с данными возникли серые ошибки.</span><span class="sxs-lookup"><span data-stu-id="29b10-210">Checksum running on metadata enabling detections of corruption cases sooner and more deterministically, allowing us to fix customer data corruption before grey failures occur on data volumes.</span></span>
- <span data-ttu-id="29b10-211">Предназначен для работы с чрезвычайно большими наборами данных — петабитес и выше, без снижения производительности</span><span class="sxs-lookup"><span data-stu-id="29b10-211">Designed to work well with extremely large data sets—petabytes and larger—without performance impact</span></span>
- <span data-ttu-id="29b10-212">Поддержка других функций, используемых Exchange Online, например шифрования BitLocker.</span><span class="sxs-lookup"><span data-stu-id="29b10-212">Support for other features used by Exchange Online, such as BitLocker encryption.</span></span> 

<span data-ttu-id="29b10-213">Exchange Online также обладает преимуществами других компонентов ReFS:</span><span class="sxs-lookup"><span data-stu-id="29b10-213">Exchange Online also benefits from other ReFS features:</span></span> 
- <span data-ttu-id="29b10-p125">**Целостность (потоки целостности)** — ReFS хранят данные таким образом, чтобы защитить их от многих распространенных ошибок, которые обычно могут привести к потере данных. В Microsoft Office 365 для улучшения раннего обнаружения повреждений и контрольных сумм содержимого файлов используются потоки целостности. Кроме того, эта функция позволяет сократить количество повреждений, вызванных "разорванными операциями" (если операция записи не завершена из-за отключения питания и т. д.).</span><span class="sxs-lookup"><span data-stu-id="29b10-p125">**Integrity (Integrity Streams)** - ReFS stores data in a way that protects it from many of the common errors that can normally cause data loss. Office 365 Search uses Integrity Streams to help with early disk corruption detection and checksums of file content. The feature also reduces corruption incidents caused by “Torn Writes” (when a write operation does not complete due to power outages, etc.).</span></span> 
- <span data-ttu-id="29b10-p126">**Доступность (остаточная_стоимость)** — ReFS задает приоритет доступности данных. Историческось, что файловые системы часто подвержены повреждению данных, которое потребовало отключить систему для восстановления. Несмотря на то, что в случае повреждения возникают редкие проблемы, в ReFS реализована функция остаточная_стоимость, которая удаляет поврежденные данные из пространства имен на действующем Томе и гарантирует, что эти данные не подвержены неблагоприятным последствиям для поврежденных данных, которые не могут быть исправлены. Применение функции восстановления и изоляция повреждений данных в томах базы данных Exchange Online означает, что мы можем хранить незатронутые базы данных на поврежденном томе между моментом повреждения и действиями по восстановлению. Это повышает доступность баз данных, на которые обычно влияют такие проблемы с повреждением диска.</span><span class="sxs-lookup"><span data-stu-id="29b10-p126">**Availability (Salvage)** - ReFS prioritizes the availability of data. Historically, file systems were often susceptible to data corruption that would require the system to be taken offline for repair. Although rare, if corruption does occur, ReFS implements salvage, a feature that removes the corrupt data from the namespace on a live volume and ensures that good data is not adversely affected by non-repairable corrupt data. Applying the Salvage feature and isolating data corruption to Exchange Online database volumes means that we can keep non-affected databases on a corrupted volume healthy between the time of corruption and repair action. This increases the availability of databases that would normally be affected by such disk corruption issues.</span></span> 