---
title: Устойчивость данных Exchange 365 в Office
ms.author: robmazz
author: robmazz
manager: laurawi
audience: ITPro
ms.topic: article
ms.service: O365-seccomp
localization_priority: Normal
search.appverid:
- MET150
ms.collection:
- Strat_O365_IP
- M365-security-compliance
description: Описание различных аспектов обеспечения устойчивости данных в Exchange Online и Office 365.
ms.openlocfilehash: 9e61efaf95d466fcb268e12317c7feab0701c062
ms.sourcegitcommit: 0017dc6a5f81c165d9dfd88be39a6bb17856582e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "32262761"
---
# <a name="exchange-online-data-resiliency-in-office-365"></a>Устойчивость данных Exchange Online в Office 365

## <a name="introduction"></a>Введение
Существует два типа повреждений, которые могут повлиять на базу данных Exchange: физическое повреждение, которое обычно вызвано оборудованием (в частности, аппаратным обеспечением хранилища), а также логическим повреждением, которое происходит из-за других факторов. Как правило, существует два типа логических повреждений, которые могут возникать в базе данных Exchange: 
- **Логическое повреждение базы данных** — контрольная сумма страницы базы данных совпадает, но данные на странице логически неверны. Это может произойти, если ядро СУБД (расширенный обработчик хранилищ (ESE)) пытается записать страницу базы данных и даже несмотря на то, что операционная система возвращает сообщение об успешном выполнении, данные либо никогда не записываются на диск, либо записываются в неправильное место. Такая ситуация называется *утерянной очисткой*. ESE включает многочисленные функции и меры безопасности, предназначенные для предотвращения физического повреждения базы данных и других сценариев потери данных. Чтобы предотвратить потерю данных, ESE включает в базу данных механизм обнаружения потерянных очисток вместе с компонентом (восстановление одной страницы), чтобы исправить ее. 
- **Хранение логического повреждения** — данные добавляются, удаляются или обрабатываются в том виде, в котором пользователь не ожидается. Такие случаи обычно вызваны сторонними приложениями. Это повреждение является повреждением только в том смысле, что оно является таковым для пользователя. Хранилище Exchange считает транзакцию, которая привела к логическому повреждению серией правильных операций MAPI. Функции [хранения на месте](https://docs.microsoft.com/exchange/security-and-compliance/create-or-remove-in-place-holds) в Exchange Online обеспечивают защиту от логического повреждения хранилища (так как предотвращает окончательное удаление содержимого пользователем или приложением). 

Exchange Online выполняет несколько проверок согласованности в файлах реплицированных журналов во время проверки журнала и преобразования журнала. Эти проверки согласованности предотвращают репликацию системы с физическим повреждением. Например, во время проверки журнала существует физическая проверка целостности, которая проверяет файл журнала и проверяет, совпадает ли контрольная сумма, записанная в файле журнала, с контрольной суммой, созданной в памяти. Кроме того, заголовком файла журнала считается проверка того, что подпись файла журнала, записанная в заголовке журнала, совпадает с именем файла журнала. Во время повтора журнала файл журнала становится еще больше. Например, заголовок базы данных также содержит подпись журнала, которая сравнивается с подписью файла журнала, чтобы убедиться, что они совпадают. 

Защита от повреждения данных почтовых ящиков в Exchange Online достигается с помощью собственной защиты данных Exchange, стратегии устойчивости, использующей репликацию на уровне приложения на нескольких серверах и нескольких центрах обработки данных вместе с другими функции, помогающие предотвратить потерю данных из-за повреждения или по другим причинам. К этим функциям относятся встроенные функции, управляемые корпорацией Майкрософт или самим приложением Exchange Online, в том числе:

- [Группы обеспечения доступности данных](https://docs.microsoft.com/exchange/back-up-email)
- ОдноРазрядная одноСторонняя коррекция 
- Сканирование оперативной базы данных 
- Обнаружение потерянных очисток 
- Восстановление отдельных страниц 
- Служба репликации поЧтовых ящиков 
- Проверки файлов журналов 
- Развертывание в отказоустойчивой файловой системе 

Для получения дополнительных сведений о встроенных функциях, приведенных выше, щелкните приведенные выше гиперссылки и просмотрите дополнительные сведения и подробные сведения об элементах без гиперссылок. Кроме этих встроенных функций, Exchange Online также включает функции обеспечения устойчивости данных, которыми могут управлять пользователи, например: 
- [Восстановление отдельных элементов (включено по умолчанию)](https://docs.microsoft.com/exchange/recipients-in-exchange-online/manage-user-mailboxes/recover-deleted-messages) 
- [Хранение на месте и хранение для судебного разбирательства](https://docs.microsoft.com/exchange/security-and-compliance/in-place-and-litigation-holds) 
- [Хранение удаленных элементов и обратимо удаленные поЧтовые ящики (включены по умолчанию)](https://docs.microsoft.com/exchange/recipients-in-exchange-online/delete-or-restore-mailboxes) 

## <a name="database-availability-groups"></a>Группы обеспечения доступности баз данных 
Каждая база данных почтовых ящиков в Office 365 размещается в [группе обеспечения доступности баз данных (DAG)](https://docs.microsoft.com/exchange/back-up-email) и реплицируется на географически раздельные центры обработки данных в пределах одного региона. Наиболее распространенная конфигурация состоит из четырех копий базы данных в четырех центрах обработки данных; Однако в некоторых регионах меньше центров данных (базы данных реплицируются в три центра данных в Индии и два центра обработки данных в Австралии и Японии). Однако во всех случаях каждая база данных почтовых ящиков содержит четыре копии, распределенные между несколькими центрами обработки данных, что гарантирует защиту данных почтовых ящиков от программного обеспечения, аппаратного обеспечения и даже неисправностей центра данных. 

Из этих четырех копий все три из них настраиваются как высокодоступные. Четвертая копия настроена как [копия базы данных изолированной](https://docs.microsoft.com/Exchange/high-availability/manage-ha/activate-lagged-db-copies). Копия базы данных изолированной не предназначена для восстановления отдельных почтовых ящиков или восстановления элементов почтового ящика. Его цель — предоставить механизм восстановления для редкого логического повреждения на уровне системы. 

Для копий базы данных изолированной в Exchange Online настроено время задержки преобразования файла журнала в семь дней. Кроме того, диспетчер задержки воспроизведений Exchange включается для создания динамического файла журнала для копий изолированной, чтобы позволить изолированной копии базы данных для автоматического восстановления и управления ростом файла журнала. Несмотря на то, что в Exchange Online используются копии баз данных изолированной, важно понимать, что они не гарантированно представляют собой резервную копию на момент времени. Изолированной копии базы данных в Exchange Online имеют пороговое значение доступности, обычно около 90% из-за тех периодов, когда диск с копией изолированной теряется из-за сбоя диска, изолированной копия становится высокодоступной копией (из-за автоматического проигрывания), а также в качестве периодов, в которых копия базы данных изолированной перемещает очередь повтора журнала. 

## <a name="transport-resilience"></a>Устойчивость транспорта 
Exchange Online включает две основные функции обеспечения устойчивости транспорта: теневая избыточность и сеть безопасности. Теневая избыточность сохраняет резервную копию сообщения, находясь в пути. Служба безопасности сети сохраняет резервную копию сообщения после успешной доставки сообщения. 

При теневом резервировании каждый транспортный сервер Exchange Online создает копию каждого сообщения, которое он получает, прежде чем подтвердить успешное получение сообщения серверу-отправителю. Это делает все сообщения в транспортном конвейере избыточными при передаче. Если Exchange Online определяет исходное сообщение было разорвано при передаче, резервная копия сообщения будет доставлена повторно. 

Служба безопасности сети — это транспортная очередь, связанная со службой транспорта на сервере поЧтовых ящиков. В этой очереди хранятся копии сообщений, успешно обработанных сервером. Если для базы данных почтовых ящиков или сервера почтовых ящиков требуется активация устаревших копий базы данных почтовых ящиков, сообщения в очереди безопасности сети автоматически повторно отправляются на новую активную копию базы данных почтовых ящиков. Кроме того, эта сеть также является избыточной и исключает транспортную систему в качестве единой точки отказа. Он использует концепцию основной сети безопасности и теневой сети безопасности, где если основная сеть безопасности недоступна в течение более 12 часов, запросы на повторную отправку преобразуются в теневые запросы на повторную отправку, а сообщения передаются из теневой сети безопасности.

Повторные отправки сообщений из сети безопасности автоматически инициируются компонентом Active Manager службы репликации Microsoft Exchange, который управляет копиями базы данных DAG и почтовых ящиков. Ручные действия для повторной подачи сообщений из сети безопасности не требуются. 

## <a name="single-bit-correction"></a>ОдноРазрядная одноСторонняя коррекция 
ESE включает механизм обнаружения и разрешения одноразрядных ошибок CRC (с последующими перелистываниеми одноразрядных версий), которые являются результатом ошибок оборудования (и, как таковых, отражает физическую порчу). При возникновении этих ошибок ESE автоматически исправляет их и регистрирует событие в журнале событий. 

## <a name="online-database-scanning"></a>Сканирование оперативной базы данных 
Сканирование оперативной базы данных (также называется контрольной *суммой базы данных*) — это процесс, в котором ESE использует проверку согласованности базы данных для чтения каждой страницы и проверки повреждения страницы. Основной целью является обнаружение физических повреждений и потерянных очисток, которые могут быть не обнаружены транзакционными операциями. Сканирование базы данных также выполняет операции сбоя постового хранения. Из-за сбоев может произойти утечка памяти, и при сканировании оперативной базы данных выполняется поиск и восстановление потерянного места. Система разработана с учетом того, что каждая база данных полностью сканируется каждые семь дней. 

## <a name="lost-flush-detection"></a>Обнаружение потерянных очисток 
Потерянный сброс происходит, когда операция записи базы данных, возвращенная дисковой подсистемой или операционной системой, не была записана на диск или была записана в неправильном месте. Потерянные инциденты очистки могут приводить к логическому повреждению базы данных, поэтому для предотвращения потери данных в результате потерянных данных ESE включает механизм обнаружения потерянных очисток. Так как страницы базы данных записываются в пассивные копии, выполняется проверка на наличие потерянных очисток в активной копии. Если обнаружен потерянный диск, ESE может восстановить процесс с помощью процесса исправления страницы. 

## <a name="single-page-restore"></a>Восстановление отдельных страниц 
Восстановление одной страницы с помощью одноименной *страницы*— это автоматический процесс, в котором поврежденные страницы базы данных заменяются работоспособными копиями из работоспособной реплики. Процесс восстановления поврежденной страницы зависит от того, является ли копия базы данных активной или пассивной. Когда активная копия базы данных обнаруживает поврежденную страницу, она может скопировать страницу из одной из ее реплик, если страница, которую она копирует, полностью обновлена. Это достигается путем добавления запроса страницы в поток журнала, который является основой репликации базы данных почтовых ящиков. Как только реплика встречает запрос страницы, она реагирует на нее, отправляя копию страницы в запрашивающую копию базы данных. Восстановление одной страницы также предоставляет механизм асинхронной связи для активного запроса страницы от реплик, даже если реплики находятся в автономном режиме. 

В случае повреждения в пассивной копии базы данных, в том числе копии базы данных изолированной, так как эти копии всегда находятся за активной копией, всегда безопасно копировать любую страницу из активной копии в пассивную копию. Пассивная копия базы данных по природе строго доступна, поэтому во время процесса исправления страниц восстановление журнала приостанавливается, но копирование журнала продолжается. Пассивная копия базы данных извлекает копию поврежденной страницы из активной копии, дождитесь копирования и проверки файла журнала, удовлетворяющего максимально необходимым требованиям для создания журнала, и последующее Исправление поврежденной страницы. После исправления страницы возобновляет воспроизведение журнала. Этот процесс аналогичен для копии базы данных изолированной, за исключением того, что база данных изолированной сначала воспроизводит все файлы журналов, необходимые для достижения исправленного состояния. 

## <a name="mailbox-replication-service"></a>Служба репликации поЧтовых ящиков 
Перемещение почтовых ящиков является ключевой частью управления крупномасштабной службой электронной почты. Вы всегда обновили технологии и аппаратные обновления и обновления версий, чтобы обеспечить надежную, регулируемую систему, позволяющую нашим специалистам выполнять эту работу, сохранив почтовые ящики прозрачными для пользователей (убедившись, что они остаются в сети). во всем процессе) — это ключ и гарантируется, что процесс постепенно масштабируется, как почтовые ящики увеличен и больше. 

Служба репликации поЧтовых ящиков Exchange (MRS) отвечает за перемещение почтовых ящиков между базами данных. Во время перемещения MRS выполняет проверку согласованности для всех элементов в почтовом ящике. Если обнаружена проблема с согласованием, MRS либо исправляет проблему, либо пропускует поврежденные элементы, что приведет к удалению поврежденного почтового ящика. 

Так как MRS является компонентом Exchange Online, мы можем вносить изменения в свой код, чтобы устранить новые формы повреждений, обнаруженных в будущем. Например, если мы определим проблему согласованности, которую MRS не удается исправить, мы можем проанализировать повреждение, изменить код MRS и исправить несоответствие (если мы понимаем, как). 

## <a name="log-file-checks"></a>Проверки файлов журналов 
Все файлы журналов транзакций, созданные базой данных Exchange, передаются в несколько видов проверки согласованности. При создании файла журнала первым делом является записывается битовый шаблон, а затем выполняется ряд операций записи в журнал. Это позволяет Exchange Online выполнять серию проверок (потерянных, КОНТРОЛЬных сумм и других проверок) для проверки каждого файла журнала при его записи и при репликации. 

## <a name="deployment-on-resilient-file-system"></a>Развертывание в отказоустойчивой файловой системе 
Чтобы защититься от повреждения на уровне файловой системы, Exchange Online развертывается в разделах отказоустойчивой файловой системы (ReFS) для обеспечения улучшенных возможностей восстановления. ReFS — это файловая система в Windows Server 2012 и более поздних версий, которая обеспечивает более устойчивую устойчивость к повреждению данных, обеспечивая доступность данных и целостность. В частности, ReFS приносит улучшения в способе обновления метаданных, что обеспечивает лучшую защиту данных и сокращает случаи повреждения данных. Он также использует контрольные суммы для проверки целостности данных файла и метаданных, гарантирующих простоту обнаружения и восстановления поврежденных данных. 

Exchange Online использует несколько преимуществ в ReFS: 
- Более устойчивость к целостности данных означает меньше случаев повреждения данных. Уменьшение числа инцидентов повреждений означает уменьшение числа ненужных перезаполнений базы данных. 
- Контрольная сумма, позволяющая обнаруживать случаи повреждения в случае более ранних и более детерминированных ситуаций, позволяющая нам устранять повреждение данных клиента до того, как на томах с данными возникли серые ошибки.
- Предназначен для работы с чрезвычайно большими наборами данных — петабитес и выше, без снижения производительности
- Поддержка других функций, используемых Exchange Online, например шифрования BitLocker. 

Exchange Online также обладает преимуществами других компонентов ReFS: 
- **Целостность (потоки целостности)** — ReFS хранят данные таким образом, чтобы защитить их от многих распространенных ошибок, которые обычно могут привести к потере данных. В Microsoft Office 365 для улучшения раннего обнаружения повреждений и контрольных сумм содержимого файлов используются потоки целостности. Кроме того, эта функция позволяет сократить количество повреждений, вызванных "разорванными операциями" (если операция записи не завершена из-за отключения питания и т. д.). 
- **Доступность (остаточная_стоимость)** — ReFS задает приоритет доступности данных. Историческось, что файловые системы часто подвержены повреждению данных, которое потребовало отключить систему для восстановления. Несмотря на то, что в случае повреждения возникают редкие проблемы, в ReFS реализована функция остаточная_стоимость, которая удаляет поврежденные данные из пространства имен на действующем Томе и гарантирует, что эти данные не подвержены неблагоприятным последствиям для поврежденных данных, которые не могут быть исправлены. Применение функции восстановления и изоляция повреждений данных в томах базы данных Exchange Online означает, что мы можем хранить незатронутые базы данных на поврежденном томе между моментом повреждения и действиями по восстановлению. Это повышает доступность баз данных, на которые обычно влияют такие проблемы с повреждением диска. 