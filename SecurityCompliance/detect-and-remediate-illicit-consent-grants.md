---
title: Обнаружение случаев незаконного предоставления разрешений и устранение их последствий в Office 365
ms.author: chrfox
author: chrfox
manager: laurawi
ms.date: 4/23/2018
ms.audience: ITPro
ms.topic: article
ms.collection:
- o365_security_incident_response
- Strat_O365_IP
ms.service: o365-solutions
localization_priority: Normal
ms.custom: ''
ms.assetid: ''
search.appverid:
- MET150
description: Узнайте, как для распознавания и устранение атак предоставляет незаконных разрешения в Office 365.
ms.openlocfilehash: 457279e6d9498ac132ed3fb77b7c0fef68a293fa
ms.sourcegitcommit: d6a28c4f6db6a676ca960173e8ff8f17d4aa1c4b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/06/2019
ms.locfileid: "29755240"
---
# <a name="detect-and-remediate-illicit-consent-grants-in-office-365"></a>Обнаружение случаев незаконного предоставления разрешений и устранение их последствий в Office 365

**Сводка**  Узнайте, как для распознавания и устранение атак предоставляет незаконных разрешения в Office 365.

## <a name="what-is-the-illicit-consent-grant-attack-in-office-365"></a>Что такое атаки grant незаконных разрешения в Office 365?
В незаконных согласия предоставьте атаки, он создает зарегистрирована Azure приложение, которое запрашивает доступ к данным, такие как контактные данные, электронной почтой, или документы. Затем злоумышленник рекомендации конечного пользователя на предоставление этого приложения разрешения для доступа к своим данным через фишинга или добавление незаконных кода в надежных веб-сайта. После незаконных приложения были предоставлены разрешения, имеет учетной записи права на доступ к данным без необходимости организационной учетной записью. Действия по исправлению обычный, как сброс паролей для учетных записей нарушенным или требования многофакторной многофакторной проверки подлинности проверкой (Подлинности) на учетные записи, не эффективности защиты от этого типа атак, так как эти приложениями сторонних производителей и внешними по отношению к организации. Эти атаки использовать модель взаимодействия, который предполагает, что сущность, вызывающую сведения автоматизации и не пользователем.

## <a name="what-does-an-illicit-consent-grant-attack-look-like-in-office-365"></a>Незаконных разрешения grant атаки как выглядит в Office 365?
Необходимо выполнять поиск Office 365 **журнала аудита** для поиска знаки, называемые также индикаторы из компромиссов (IOC) этой атаки. Для организаций с много Azure зарегистрированных приложений и больших пользовательской базы рекомендуется рассмотреть предоставляет разрешения вашей организации неделю.
### <a name="steps-for-finding-signs-of-this-attack"></a>Действия для поиска знаки в этом атаки
1. Откройте **Центр соответствия требованиям и безопасности** в клиент Office 365.
2. Перейдите к узлу **расследования & поиска** и выберите Поиск в **журнале аудита** .
3. Создайте поиска (все операции и всех пользователей) и фильтровать результаты разрешения пользователя для приложения и добавьте OAuth2PermissionGrant.
4. Просмотрите расширенные свойства и проверьте, чтобы увидеть, если IsAdminContent имеет значение True.


Если это значение равно true, это означает, что кто-то с доступом к глобальный администратор может быть предоставлено широкий доступ к данным. В случае непредвиденного, выполните действия, чтобы [подтвердить атаки](detect-and-remediate-illicit-consent-grants.md#confirmattack).

<a name="confirmattack"> </a>
## <a name="how-to-confirm-an-attack"></a>Как проверить атаки
Если у вас есть одно или несколько экземпляров IOCs перечисленных выше, необходимо выполнить дополнительные исследование, чтобы явно убедиться, что произошла атаки. Можно использовать любой из этих трех методов для подтверждения атаки.
- Инвентаризация приложений и их разрешения с помощью портала Azure Active Directory. Этот метод является полная, но можно указать только одного пользователя одновременно, который может быть много времени при наличии нескольких пользователей для проверки.
- Инвентаризация приложений и их разрешения с помощью PowerShell. Это метод быстрый и наиболее полное с наименьшими объем нагрузки.
- У пользователей по отдельности проверьте их приложения и разрешения и возвращают результаты для администраторов коррекции.

## <a name="inventory-apps-with-access-in-your-organization"></a>Инвентаризация приложений с помощью доступа в организации
Можно сделать это для пользователей с Azure Active Directory портала или PowerShell или пользователей по отдельности перечисление их доступ к приложениям.

### <a name="steps-for-using-the-azure-active-directory-portal"></a>Действия по использованию портале Azure Active Directory
Может выполнять поиск приложения, к которым любого отдельного пользователя имеет разрешений с помощью [Azure Active Directory портала](https://portal.azure.com/). 
1. Войдите в портал Azure с правами администратора.
2. Выберите blade Azure Active Directory.
3. Выберите пункт **Пользователи**.
4. Выберите пользователя, которые необходимо просмотреть.
5. Выберите **приложения**.

Это позволит просмотреть приложения, назначенные для пользователя и что applcations имеют разрешения.

### <a name="steps-for-having-your-users-enumerate-their-application-access"></a>Действия для пользователей в вашей перечисление их доступ к приложениям
Перейдите к пользователей https://myapps.microsoft.com и предварительный просмотр собственные приложения access существует. Они смогут видеть все приложения с доступом к "," Просмотр сведений о них (в том числе область доступа) и иметь возможность отменить права подозрительные или запрещенное приложений.

### <a name="steps-for-doing-this-with-powershell"></a>Действия по созданию с помощью PowerShell
Простой способ проверить атаки незаконных Grant соглашаетесь должна выполняться [Get-AzureADPSPermissions.ps1](https://gist.github.com/psignoret/41793f8c6211d2df5051d77ca3728c09), который выгружать предоставляет разрешения OAuth и приложениях OAuth для всех пользователей в вашем клиенте в один CSV-файл. 

#### <a name="pre-requisites"></a>Предварительные действия
- В Windows Azure AD PowerShell библиотеку установлены.
- Права глобального администратора на клиента, который будет выполняться скрипт.
- Локального администратора на компьютере, с которого будет выполняться скрипты.

> [!IMPORTANT]
> Мы настоятельно рекомендуем требуют многофакторной проверки подлинности для учетной записи администратора.  Этот сценарий поддерживает проверку подлинности многофакторной проверкой Подлинности.

1. Войдите в компьютер, на котором будут выполняться сценарий с правами локального администратора.
2. Загрузите или скопируйте сценарий [Get-AzureADPSPermissions.ps1](https://gist.github.com/psignoret/41793f8c6211d2df5051d77ca3728c09) из репозиториев в папку, из которого будут выполняться scruipt.  Это будет той же папке, в котором будет записан выходного файла «permissions.csv».
3. Откройте экземпляр PowerShell с правами администратора и откройте папку, которую вы сохранили скрипт, чтобы.
4. Подключение к каталогу с помощью командлета [Connect-AzureAD](https://docs.microsoft.com/powershell/module/azuread/connect-azuread?view=azureadps-2.0) .
5. Запустите командную строку PowerShell следующим образом:`Get-AzureADPSPermissions.ps1 | Export-csv -path "Permissions.csv" -NoTypeInformation`

Сценарий создает один файл с именем Permissions.csv. Выполните следующие действия для поиска для предоставления разрешений на незаконных приложения. 
1. В столбце ConsentType (столбец G) поиска значения «AllPrinciples». AllPrincipals разрешение клиентского приложения для доступа к контенту всех пользователей в аренде. Собственные приложения Office 365 требуется это разрешение для правильной работы. Каждое приложение от стороннего с этим разрешением следует тщательно изучить.
2.  В разделе review столбец (F) разрешение разрешения, что каждый делегировано приложения должен содержимого. Найдите разрешение «Чтение» и «Запись» или «*. Все» разрешение и проверки, которые они точно так, как они могут быть соответствующие.
3.  Просмотр пользователей, имеющих предоставлены заранее признает правомочность обращения. Если профиль высоким или важных пользователей предоставлены неподходящие заранее признает правомочность обращения, вы должны исследование.
4.  В столбце ClientDisplayName (столбец C) найдите приложения, которые кажутся подозрительные. Тщательно следует изучить приложений с ошибочным имена, super простыми имена или имена выбираются злоумышленником.

## <a name="determine-the-scope-of-the-attack"></a>Определение области атаки
После завершения Инвентаризация доступ к приложениям, просмотрите Office 365 **журнала аудита** для определения полного области связи с нарушением условий.  Поиск на соответствующих пользователей интервалами времени, которым пришлось незаконных приложения доступ к вашей организации, а также разрешения имелся приложения. **Журнал аудита** можно найти в [центре соответствия требованиям и безопасности Office 365](https://support.office.com/article/Search-the-audit-log-in-the-Office-365-Security-Compliance-Center-0d4d0f35-390b-4518-800e-0c7ec95e946c). 

> [!IMPORTANT]
> [Аудит почтовых ящиков](https://support.office.com/article/Enable-mailbox-auditing-in-Office-365-aaca8987-5b62-458b-9882-c28476a66918) и [аудит активности для администраторов и пользователей,](https://support.office.com/article/turn-office-365-audit-log-search-on-or-off-e893b19a-660c-41f2-9074-d3631c95a014) должно быть включено до атаки позволяет получить эти сведения.

## <a name="how-to-stop-and-remediate-an-illicit-consent-grant--attack"></a>Как прекратить и устранение атака grant незаконных согласия
После определения приложения с незаконных разрешения у вас есть несколько способов для удаления доступа.
- Можно отозвать разрешение приложения на портале Azure Active Directory с:
    - Перейдите к затронутым пользователем blade **Azure Active Directory пользователя** .
    - Выберите **приложения**.
    - Выберите незаконных приложение.
    - Нажмите кнопку **Удалить** в детализации вниз.
- Предоставление разрешения OAuth с помощью PowerShell можно отозвать, выполнив действия, описанные в [Remove AzureADOAuth2PermissionGrant](https://docs.microsoft.com/powershell/module/azuread/Remove-AzureADOAuth2PermissionGrant?view=azureadps-2.0).
- Можно отозвать назначения роли службы приложения с помощью PowerShell, выполнив действия, описанные в [Remove AzureADServiceAppRoleAssignment](https://docs.microsoft.com/powershell/module/azuread/Remove-AzureADServiceAppRoleAssignment?view=azureadps-2.0).
- Также можно отключить вход для полностью затронутых учетной записи, который в свою очередь отключит приложение доступ к данным в этой учетной записи. Это не идеально подходит для производительности конечных пользователей, конечно, но при работе для ограничения воздействия быстро может быть приемлемым краткосрочных исправлению.
- Встроенная приложений можно отключить для аренды. Это радикальным, которое отключает возможность для конечных пользователей предоставить разрешения на уровне клиента. Это не позволяет пользователям случайно предоставления доступа к приложению вредоносных. Это не рекомендуется строго как оно значительно снижает возможности пользователей для эффективной работы с приложениями сторонних производителей.  Это можно сделать, выполнив действия, описанные в [Отсутствию интегрированные приложения включено или отключено](https://support.office.com/article/Turning-Integrated-Apps-on-or-off-7e453a40-66df-44ab-92a1-96786cb7fb34).

## <a name="secure-office-365-like-a-cybersecurity-pro"></a>Безопасность Office 365 как cybersecurity pro
Подписки Office 365, поступающие с набором мощные возможности безопасности, которые можно использовать для защиты данных и вашим пользователям.  Использование [план обеспечения безопасности Office 365: наиболее распространенные приоритеты для первого 30 дней, 90 дней и за ее пределами](https://support.office.com/article/office-365-security-roadmap-top-priorities-for-the-first-30-days-90-days-and-beyond-28c86a1c-e4dd-4aad-a2a6-c768a21cb352) для реализации Майкрософт, рекомендации по обеспечению безопасности клиента Office 365.
- Задачи, для выполнения в течение 30 дней.  Эти интерпретации влияют и низкой воздействия на компьютерах пользователей.
- Задачи, для выполнения в течение 90 дней. Они имеют немного больше времени для планирования и реализации, но значительно повышения уровня безопасности.
- Помимо 90 дней. Эти усовершенствования построения в первом работу 90 дней.

## <a name="see-also"></a>Также можно найти:
- [Непредвиденные приложение в списке приложений](https://docs.microsoft.com/azure/active-directory/application-access-unexpected-application) просматривает администраторов с помощью различных действий, которые они может потребоваться выполнить после осознавать, что непредвиденные приложений с доступом к данным.
- [Интеграция приложений с Azure Active Directory]  (https://docs.microsoft.com/azure/active-directory/active-directory-apps-permissions-consent) — это высокоуровневый обзор разрешения и разрешения.  Обратите особое внимание на раздел [Общие сведения о framework согласия пользователя](https://docs.microsoft.com/azure/active-directory/develop/active-directory-integrating-applications#overview-of-the-consent-framework) .
- [Проблемы разработки приложения](https://docs.microsoft.com/azure/active-directory/active-directory-application-dev-development-content-map) содержатся ссылки на различные соглашаетесь связанных статей.
- [Приложения и объекты службы Azure Active Directory (Azure AD)](https://docs.microsoft.com/azure/active-directory/develop/active-directory-application-objects) предоставляет обзор приложений и службы участника объектов, которые являются основной для модели приложения.
- [Управление доступом к приложениям](https://docs.microsoft.com/azure/active-directory/active-directory-managing-access-to-apps) представлен обзор возможностей, которые администраторы должны управлять доступом пользователей к приложениям.
