---
title: Удаление элементов из папки "элементы с возможностью восстановления" в облачных почтовых ящиках в справке для удержания
ms.author: markjjo
author: markjjo
manager: laurawi
audience: Admin
ms.topic: article
ms.service: O365-seccomp
localization_priority: Normal
ms.collection:
- Strat_O365_IP
- M365-security-compliance
search.appverid:
- MOE150
- MET150
ms.assetid: a85e1c87-a48e-4715-bfa9-d5275cde67b0
description: 'Для администраторов: удаление элементов из папки "элементы с возможностью восстановления" для почтового ящика Exchange Online, даже если этот почтовый ящик размещен на удержании по юридическим причинам. Это эффективный способ удаления данных, которые были случайно перенесены в Office 365.'
ms.openlocfilehash: 9da469af900c2610762338029aa80d31c7f10363
ms.sourcegitcommit: 9d67cb52544321a430343d39eb336112c1a11d35
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/17/2019
ms.locfileid: "34150411"
---
# <a name="delete-items-in-the-recoverable-items-folder-of-cloud-based-mailboxes-on-hold---admin-help"></a>Удаление элементов из папки "элементы с возможностью восстановления" в облачных почтовых ящиках в справке для удержания

Папка "элементы с возможностью восстановления" для почтового ящика Exchange Online существует для защиты от случайных или вредоносных удалений. Он также используется для хранения элементов, которые поддерживаются и доступны в Office 365, например для поиска удержаний и обнаружения электронных данных. Однако в некоторых ситуациях некоторые организации могут иметь непреднамеренно сохраненные данные в папке "элементы с возможностью восстановления", которые необходимо удалить. Например, пользователь может непреднамеренно отправить или переслать сообщение электронной почты, содержащее конфиденциальную информацию или информацию, которая может иметь серьезные последствия для бизнеса. Даже если сообщение окончательно удаляется, оно может храниться в течение неограниченного времени, так как для почтового ящика было включено юридическое удержание. Этот сценарий называется выпустка данных, так как данные были случайно перенесены в Office 365. В этом случае можно удалить элементы из папки "элементы с возможностью восстановления" для почтового ящика Exchange Online, даже если этот почтовый ящик включен в удержание с одной из различных функций хранения в Office 365. Эти типы удержаний включают судебные удержания, удержания на месте, удержания электронных данных и политики хранения Office 365, созданные в центре безопасности и соответствия требованиям в Office 365 или Microsoft 365.
  
 В этой статье объясняется, как удалять элементы из папки "элементы с возможностью восстановления" для почтовых ящиков в облаке, находящихся на удержании. Эта процедура включает в себя отключение доступа к почтовому ящику и отключение восстановления отдельных элементов, отключение помощника по работе с управляемыми папками от обработки почтового ящика, временное удаление удержания, удаление элементов из папки "элементы с возможностью восстановления", а затем возврат почтового ящика в предыдущую конфигурацию. Вот процесс: 
  
[Шаг 1: сбор сведений о почтовом ящике](#step-1-collect-information-about-the-mailbox)

[Шаг 2: подготовка почтового ящика](#step-2-prepare-the-mailbox)

[Шаг 3: удаление всех удержаний из почтового ящика](#step-3-remove-all-holds-from-the-mailbox)

[Шаг 4: удаление задержки хранения из почтового ящика](#step-4-remove-the-delay-hold-from-the-mailbox)

[Шаг 5: удаление элементов из папки "элементы с возможностью восстановления"](#step-5-delete-items-in-the-recoverable-items-folder)

[Шаг 6: возврат к предыдущему состоянию почтового ящика](#step-6-revert-the-mailbox-to-its-previous-state)
  
> [!CAUTION]
> Процедуры, описанные в этой статье, будут приводить к окончательному удалению данных из почтового ящика Exchange Online. Это означает, что сообщения, которые вы удаляете из папки "элементы с возможностью восстановления", невозможно восстановить, и они не будут доступны для судебного обнаружения или других целей обеспечения соответствия требованиям. Если вы хотите удалить сообщения из почтового ящика, включенного в удержание в рамках хранения для судебного разбирательства, хранения на месте, удержания электронных данных или политики хранения Office 365, созданной в центре безопасности и соответствия требованиям, обратитесь к управлению записями или юридическим подразделениям. перед удалением удержания. У вашей организации может быть политика, определяющая, имеет ли почтовые ящики на удержании или при проведении на них приоритет. 
  
## <a name="before-you-begin"></a>Перед началом работы

- Для поиска и удаления сообщений из папки "элементы с возможностью восстановления" в действии 5 необходимо назначить обе указанные ниже роли управления в Exchange Online.
    
  - **Поиск** в почтовом ящике — эта роль позволяет выполнять поиск в почтовых ящиках в Организации. Администраторы Exchange не назначают эту роль по умолчанию. Чтобы назначить себе эту роль, добавьте себя в качестве члена группы ролей Управление обнаружением в Exchange Online. 
    
  - **Экспорт импорта** почтовых ящиков — Эта роль позволяет удалять сообщения из почтового ящика пользователя. По умолчанию эта роль группе ролей не назначена. Чтобы удалить сообщения из почтовых ящиков пользователей, можно добавить роль импорта почтовых ящиков в группу ролей Управление организацией в Exchange Online. 
    
- Процедуры, описанные в этой статье, не поддерживаются для неактивных почтовых ящиков. Это связано с тем, что после удаления неактивного почтового ящика невозможно повторно применить удержание (или политику хранения Office 365) к неактивному почтовому ящику. При удалении удержания из неактивного почтового ящика он заменяется обычным обратимо удаленным почтовым ящиком и будет окончательно удален из Организации после его обработки помощником для управляемых папок.
    
- Эту процедуру невозможно выполнить для почтового ящика, назначенного политике хранения Office 365, заблокированной с блокировкой сохранения. Это связано с тем, что блокировка сохранения предотвращает удаление или исключение почтового ящика из политики хранения Office 365 и отключение помощника для управляемых папок в почтовом ящике. Дополнительные сведения о блокировке политик хранения приведены в разделе [Блокировка политики хранения](retention-policies.md#locking-a-retention-policy).
    
- Если почтовый ящик не полагается на удержание (или не включено восстановление отдельных элементов), можно просто удалить элементы из папки "элементы с возможностью восстановления". Дополнительные сведения о том, как это сделать, можно найти в статье [Поиск и удаление сообщений ](https://go.microsoft.com/fwlink/?linkid=852453).
  
## <a name="step-1-collect-information-about-the-mailbox"></a>Шаг 1: сбор сведений о почтовом ящике

Сначала необходимо собрать выбранные свойства из целевого почтового ящика, которые будут влиять на эту процедуру. Обязательно запишите эти параметры или сохраните их в текстовом файле, так как вы измените некоторые из этих свойств, а затем вернитесь к исходным значениям на шаге 6, после того как вы удалите элементы из папки "элементы с возможностью восстановления". Ниже приведен список свойств почтовых ящиков, которые необходимо собрать.
  
-  *Синглеитемрековеренаблед* и *RetainDeletedItemsFor* ; При необходимости вы отключите одно восстановление и увеличьте срок хранения удаленных элементов на шаге 3. 
    
-  *LitigationHoldEnabled* и *InPlaceHolds* ; необходимо определить все удержания, размещенные в почтовом ящике, чтобы их можно было временно удалить на шаге 3. В разделе [Дополнительные сведения](#more-information) приведены советы по определению типа удержания, который может быть включен в почтовый ящик. 
    
Кроме того, необходимо получить параметры клиентского доступа почтовых ящиков, чтобы их можно было временно отключить, чтобы владелец (или другие пользователи) не мог получить доступ к этому почтовому ящику во время выполнения этой процедуры. Наконец, вы можете получить текущий размер и количество элементов в папке "элементы с возможностью восстановления". После удаления элементов из папки "элементы с возможностью восстановления" в действии 5 эти сведения будут использоваться для проверки фактического удаления элементов.
  
1. [Подключитесь к Exchange Online PowerShell](https://go.microsoft.com/fwlink/?linkid=396554). Обязательно используйте имя пользователя и пароль для учетной записи администратора, которой назначены соответствующие роли управления в Exchange Online. 
    
2. Выполните следующую команду, чтобы получить сведения об использовании восстановления отдельных элементов и периода хранения удаленных элементов.

    ```
    Get-Mailbox <username> | FL SingleItemRecoveryEnabled,RetainDeletedItemsFor
    ```

   Если включено восстановление отдельных элементов, необходимо отключить его на шаге 2. Если срок хранения удаленных элементов не задан в течение 30 дней (максимальное значение в Exchange Online), его можно увеличить на шаге 2. 
    
3. Выполните следующую команду, чтобы получить параметры доступа к почтовому ящику для почтового ящика. 
    
    ```
    Get-CASMailbox <username> | FL EwsEnabled,ActiveSyncEnabled,MAPIEnabled,OWAEnabled,ImapEnabled,PopEnabled
    ```

   Все эти способы доступа будут отключены на шаге 2.
    
4. Выполните следующую команду, чтобы получить сведения о удержаниях и политиках хранения Office 365, применяемых к почтовому ящику.
    
    ```
    Get-Mailbox <username> | FL LitigationHoldEnabled,InPlaceHolds
    ```


   > [!TIP]
    > Если в свойстве *InPlaceHolds* слишком много значений, а не все они отображаются, можно выполнить `Get-Mailbox <username> | Select-Object -ExpandProperty InPlaceHolds` команду, чтобы отобразить каждое значение в отдельной строке. 
  
5. Выполните следующую команду, чтобы получить сведения о политиках хранения Office 365 для всей Организации. 

    ```
    Get-OrganizationConfig | FL InPlaceHolds
    ```
   Если в Организации есть политики хранения Office 365 на уровне Организации, необходимо исключить почтовый ящик из этих политик на шаге 3.

   > [!TIP]
    > Если в свойстве *InPlaceHolds* слишком много значений, а не все они отображаются, можно выполнить `Get-OrganizationConfig | Select-Object -ExpandProperty InPlaceHolds` команду, чтобы отобразить каждое значение в отдельной строке. 
  
6. Выполните следующую команду, чтобы получить текущий размер и общее количество элементов в папках и вложенных папках в папке "элементы с возможностью восстановления" в основном почтовом ящике пользователя. 

    ```
    Get-MailboxFolderStatistics <username> -FolderScope RecoverableItems | FL Name,FolderAndSubfolderSize,ItemsInFolderAndSubfolders
    ```

   Если архивный почтовый ящик пользователя включен, выполните следующую команду, чтобы получить размер и общее количество элементов в папках и подпапках в папке "элементы с возможностью восстановления" в своем архивном почтовом ящике. 

    ```s
    Get-MailboxFolderStatistics <username> -FolderScope RecoverableItems -Archive | FL Name,FolderAndSubfolderSize,ItemsInFolderAndSubfolders
    ```

   При удалении элементов на шаге 5 можно удалить или не удалять элементы из папки "элементы с возможностью восстановления" в основном архивном почтовом ящике пользователя. Обратите внимание, что если включено автоматическое расширение архивации для почтового ящика, элементы в вспомогательном архивном почтовом ящике не будут удалены.
  
## <a name="step-2-prepare-the-mailbox"></a>Шаг 2: подготовка почтового ящика

После сбора и сохранения сведений о почтовом ящике следующим шагом является подготовка почтового ящика путем выполнения следующих задач. 
  
- **Отключить клиентский доступ к почтовому ящику** , чтобы владелец почтового ящика не получил доступ к своему почтовому ящику и вносить в него изменения данных почтового ящика. 
    
- **Увеличьте срок хранения удаленных элементов** до 30 дней (максимальное значение в Exchange Online), чтобы элементы не удалялись из папки "элементы с возможностью восстановления", прежде чем их можно будет удалить на шаге 5. 
    
- **Отключите восстановление отдельных элементов** , чтобы элементы не сохранялись (срок хранения удаленных элементов) после удаления их из папки "элементы с возможностью восстановления" на шаге 5. 
    
- **Отключите помощник по работе с управляемыми папками** , чтобы он не обпомнил почтовый ящик и сохранял элементы, которые вы удалили на шаге 5. 
    
Выполните следующие действия в Exchange Online PowerShell.
  
1. Выполните следующую команду, чтобы отключить все клиентские права на доступ к почтовому ящику. Синтаксис команды предполагает, что все методы клиентского доступа были включены для почтового ящика.

    ```   
    Set-CASMailbox <username> -EwsEnabled $false -ActiveSyncEnabled $false -MAPIEnabled $false -OWAEnabled $false -ImapEnabled $false -PopEnabled $false
    ```
   
   > [!NOTE]
    > Отключение всех методов клиентского доступа к почтовому ящику может занять до 60 минут. Обратите внимание, что отключение этих методов доступа не отключит владельца почтового ящика, в котором они вошли в систему. Если владелец не вошел в систему, он не сможет получить доступ к своему почтовому ящику после отключения этих методов доступа. 
  
2. Выполните следующую команду, чтобы увеличить срок хранения удаленных элементов максимум 30 дней. Предполагается, что текущее значение меньше 30 дней. 

    ```
    Set-Mailbox <username> -RetainDeletedItemsFor 30
    ```

3. Выполните следующую команду, чтобы отключить восстановление отдельных элементов.
    
    ```
    Set-Mailbox <username> -SingleItemRecoveryEnabled $false
    ```

   > [!NOTE]
    > Отключение восстановления отдельных элементов может занять до 60 минут. Не удаляйте элементы в папке "элементы с возможностью восстановления" до истечения этого периода. 
  
4. Выполните следующую команду, чтобы предотвратить обработку почтового ящика помощником для управляемых папок. Как было сказано ранее, помощник для управляемых папок можно отключить только в том случае, если к почтовому ящику не применяется политика хранения Office 365 с блокировкой сохранения. 

    ```
    Set-Mailbox <username> -ElcProcessingDisabled $true
    ```

## <a name="step-3-remove-all-holds-from-the-mailbox"></a>Шаг 3: удаление всех удержаний из почтового ящика

Последний шаг перед удалением элементов из папки "элементы с возможностью восстановления" состоит в том, чтобы удалить все удержания (определенные на шаге 1), размещенные в почтовом ящике. Все удержания необходимо удалить, чтобы элементы не сохранялись после удаления их из папки "элементы с возможностью восстановления". В следующих разделах содержатся сведения об удалении различных типов удержаний для почтового ящика. В разделе [Дополнительные сведения](#more-information) приведены советы по определению типа удержания, который может быть включен в почтовый ящик. Для получения дополнительных сведений Узнайте, [как определить тип удержания, размещенного в почтовом ящике Exchange Online](identify-a-hold-on-an-exchange-online-mailbox.md).
  
> [!CAUTION]
> Как было сказано ранее, прежде чем удалять удержание из почтового ящика, проверяйте управление записями или юридическими отделами. 
  
 ### <a name="litigation-hold"></a>Хранение для судебного разбирательства
  
Выполните следующую команду в Exchange Online PowerShell, чтобы удалить удержание для судебного разбирательства из почтового ящика.

```
Set-Mailbox <username> -LitigationHoldEnabled $false
```

   
> [!NOTE]
> Аналогично отключению методов клиентского доступа и восстановления отдельных элементов может потребоваться до 60 минут, чтобы удалить удержание для судебного разбирательства. Не удаляйте элементы из папки "элементы с возможностью восстановления" до истечения этого периода. 
  
 ### <a name="in-place-hold"></a>Хранение на месте
  
Выполните следующую команду в Exchange Online PowerShell, чтобы определить удержание на месте, которое размещено в почтовом ящике. Используйте GUID для хранения на месте, определенного в действии 1. 

```
Get-MailboxSearch -InPlaceHoldIdentity <hold GUID> | FL Name
```
   
Определив удержание на месте, вы можете удалить почтовый ящик из удержания с помощью центра администрирования Exchange или Exchange Online PowerShell. Дополнительные сведения см. [в статье Создание или удаление удержания на месте](https://go.microsoft.com/fwlink/?linkid=852668).
  
 ### <a name="office-365-retention-policies-applied-to-specific-mailboxes"></a>Политики хранения Office 365, применяемые к определенным почтовым ящикам
  
Выполните следующую команду в [_Амп_ безопасности центра соответствия требованиям PowerShell](https://go.microsoft.com/fwlink/?linkid=627084) , чтобы определить политику хранения Office 365, применяемую к почтовому ящику. Используйте GUID (не включая `mbx` `skp` префикс) для политики хранения, определенной на шаге 1. 

```
Get-RetentionCompliancePolicy <retention policy GUID without prefix> | FL Name
```
   
Определив политику хранения, перейдите на страницу **хранения** управления **датой** \> в центре безопасности _амп_ соответствие требованиям, измените политику хранения, определенную на предыдущем шаге, и удалите почтовый ящик из списка получателей, включенных в политику хранения. 
  
 ### <a name="organization-wide-office-365-retention-policies"></a>Политики хранения Office 365 на уровне Организации
  
Политики хранения Office 365 на уровне Организации и Exchange применяются ко всем почтовым ящикам в Организации. Они применяются на уровне Организации (не на уровне почтового ящика) и возвращаются при выполнении командлета **Get-OrganizationConfig** на этапе 1. Выполните следующую команду в [_Амп_ безопасности центра соответствия требованиям PowerShell](https://go.microsoft.com/fwlink/?linkid=627084) , чтобы определить политики хранения Office 365 для всей Организации. Используйте идентификатор GUID (не включая `mbx` префикс) для политик хранения на уровне Организации, определенных на этапе 1. 

```
Get-RetentionCompliancePolicy <retention policy GUID without prefix> | FL Name
```

Определив политики хранения Office 365 на уровне Организации, перейдите на страницу " **Хранение** управления **датой** \> " в центре безопасности _амп_ соответствие требованиям, отредактируйте каждую политику хранения на уровне Организации, определенную в разделе предыдущий шаг и добавьте почтовый ящик в список исключенных получателей. Это приведет к удалению почтового ящика пользователя из политики хранения. 

### <a name="office-365-retention-labels"></a>Метки хранения Office 365

Когда пользователь применяет метку, настроенную для сохранения контента или сохранения и удаления контента в любой папке или элементе почтового ящика, свойство Mailbox *комплианцетагхолдапплиед* имеет значение **true**. В этом случае почтовый ящик считается заблокированным, как если бы он был включен в удержание для судебного разбирательства или назначено политике хранения Office 365.

Чтобы просмотреть значение свойства *комплианцетагхолдапплиед* , выполните следующую команду в Exchange Online PowerShell:

```
Get-Mailbox <username> |FL ComplianceTagHoldApplied
```

После определения того, что почтовый ящик находится на удержании, так как метка хранения применяется к папке или элементу, можно использовать средство поиска контента в центре безопасности и соответствия требованиям для поиска помеченных элементов с помощью условия поиска ComplianceTag. Дополнительные сведения можно найти в разделе условия поиска в [запросах ключевых слов и условиях поиска для поиска контента](keyword-queries-and-search-conditions.md#conditions-for-common-properties).

Дополнительные сведения о метках можно найти в статье [Обзор меток Office 365](labels.md).

 ### <a name="ediscovery-case-holds"></a>футляр для обнаружения электронных данных
  
Выполните следующие команды в [_Амп_ безопасности центра соответствия требованиям PowerShell](https://go.microsoft.com/fwlink/?linkid=627084) , чтобы определить удержание, связанное с вариантом обнаружения электронных данных, который применяется к почтовому ящику. Используйте GUID (не включая `UniH` префикс) для удержания обнаружения электронных данных, определенного в действии 1. Обратите внимание, что во второй команде отображается имя случая обнаружения электронных данных, с которым связана удержание. Третья команда отображает имя удержания. 
  
```
$CaseHold = Get-CaseHoldPolicy <hold GUID without prefix>
```

```
Get-ComplianceCase $CaseHold.CaseId | FL Name
```

```
$CaseHold.Name
```

Определив имя варианта обнаружения электронных данных и удержания, перейдите на **** \> страницу **Обнаружение** электронных данных в центре соответствия требованиям, откройте обращение и удалите почтовый ящик из удержания. Более подробную информацию можно узнать в статье [case eDiscovery](ediscovery-cases.md).
  
## <a name="step-4-remove-the-delay-hold-from-the-mailbox"></a>Шаг 4: удаление задержки хранения из почтового ящика

После удаления любого типа удержания из почтового ящика значение свойства Mailbox *делайхолдапплиед* задается равным **true**. Это происходит в следующий раз, когда помощник для управляемых папок обрабатывает почтовый ящик и обнаруживает, что удержание было удалено. Это называется *Задержка хранения* и означает, что фактическое удаление удержания задерживается в течение 30 дней, чтобы предотвратить окончательное удаление данных из почтового ящика. (Цель задержки хранения заключается в предоставлении администраторам возможности поиска и восстановления элементов почтовых ящиков, которые удаляются после удаления удержания.)  Если задержка отложена, почтовый ящик по-прежнему считается на хранение неограниченной длительности, как если бы почтовый ящик находился на удержании судебного разбирательства. По истечении 30 дней задержка задержки и Office 365 автоматически попытаются удалить задержку (задав для свойства *Делайхолдапплиед* **значение false**), чтобы удержание фактически было удалено. 

Прежде чем удалять элементы на шаге 5, необходимо удалить их из почтового ящика. Сначала определите, применяется ли задержка хранения к почтовому ящику, выполнив следующую команду в Exchange Online PowerShell:

```
Get-Mailbox <username> | FL DelayHoldApplied
```

Если для свойства *делайхолдапплиед* задано значение **false**, для почтового ящика не было включено удержание задержки. Вы можете перейти к шагу 5 и удалять элементы в папке "элементы с возможностью восстановления".

Если для свойства *делайхолдапплиед* задано значение **true**, выполните следующую команду, чтобы удалить отложенную блокировку:

```
Set-Mailbox <username> -RemoveDelayHoldApplied
```
Обратите внимание, что для использования параметра *ремоведелайхолдапплиед* необходимо назначить роль юридического удержания в Exchange Online.

## <a name="step-5-delete-items-in-the-recoverable-items-folder"></a>Шаг 5: удаление элементов из папки "элементы с возможностью восстановления"

Теперь вы готовы удалить элементы в папке "элементы с возможностью восстановления" с помощью командлета [Search-Mailbox](https://go.microsoft.com/fwlink/?linkid=852595) в Exchange Online PowerShell. При запуске командлета **Search — Mailbox** можно выбрать три варианта. 
  
- Скопируйте элементы в целевой почтовый ящик, прежде чем удалять их, чтобы при необходимости можно было просматривать элементы, прежде чем удалять их.
    
- Скопируйте элементы в целевой почтовый ящик и удалите их в одной команде.
    
- Удаление элементов без их копирования в целевой почтовый ящик. 
    
Обратите внимание, что элементы в папке "элементы с возможностью восстановления" в основном архивном почтовом ящике пользователя также будут удалены при запуске командлета **Search — Mailbox** . Чтобы этого не произошло, можно включить параметр  *DoNotIncludeArchive*  . Как было сказано ранее, если для почтового ящика включено автоматическое расширение архивации, командлет * * Search-Mailbox * * не удаляет элементы в вспомогательном архивном почтовом ящике. Дополнительные сведения об автоматическом развертывании архивов приведены [в статье Обзор неограниченного архивирования в Office 365](unlimited-archiving.md).
  
> [!NOTE]
> Если вы включите поисковый запрос (используя параметр  *SearchQuery*  ), командлет **Search-Mailbox** вернет максимум 10 000 элементов. Поэтому, чтобы удалить более 10 000 элементов, может потребоваться выполнить команду **Search-Mailbox** несколько раз. 
  
В приведенных ниже примерах показан синтаксис команд для каждого из этих параметров. В этих примерах `-SearchQuery size>0` используется значение параметра, которое удаляет все элементы из всех вложенных папок в папке "элементы с возможностью восстановления". Если необходимо удалить только элементы, которые отвечают определенным условиям, можно также использовать параметр *SearchQuery* для указания других условий, например темы сообщения или диапазона дат. Ниже приведены [другие примеры использования параметра SearchQuery](#other-examples-of-using-the-searchquery-parameter) ниже. 
  
### <a name="example-1"></a>Пример 1

В этом примере показано, как скопировать все элементы из папки "элементы с возможностью восстановления" пользователя в папку почтового ящика поиска обнаружения в Организации. Это позволяет просматривать элементы перед их окончательным удалением.

```
Search-Mailbox <username> -SearchQuery size>0 -SearchDumpsterOnly -TargetMailbox "Discovery Search Mailbox" -TargetFolder "<foldername>"
```

В предыдущем примере не требуется копировать элементы в почтовый ящик поиска обнаружения. Вы можете копировать сообщения в любой целевой почтовый ящик. Тем не менее, чтобы запретить доступ к потенциально конфиденциальным данным почтовых ящиков, рекомендуется копировать сообщения в почтовый ящик, доступ к которому ограничен уполномоченным сотрудникам. По умолчанию доступ к почтовому ящику поиска обнаружения по умолчанию ограничен только членами группы ролей "Управление обнаружением" в Exchange Online. 
  
### <a name="example-2"></a>Пример 2

В этом примере показано, как скопировать все элементы из папки "элементы с возможностью восстановления" пользователя в папку почтового ящика поиска обнаружения и затем удалить их из папки "элементы с возможностью восстановления" пользователя.

```
Search-Mailbox <username> -SearchQuery size>0 -SearchDumpsterOnly -TargetMailbox "Discovery Search Mailbox" -TargetFolder "<foldername>" -DeleteContent
```
 
### <a name="example-3"></a>Пример 3

В этом примере удаляются все элементы в папке "элементы с возможностью восстановления", не копируя их в целевой почтовый ящик. 

```
Search-Mailbox <username> -SearchQuery size>0 -SearchDumpsterOnly -DeleteContent
```

### <a name="other-examples-of-using-the-searchquery-parameter"></a>Другие примеры использования параметра SearchQuery

Ниже приведено несколько примеров использования параметра *SearchQuery* для поиска определенных сообщений. Если для поиска определенных элементов используется параметр *SearchQuery* , рассмотрите возможность копирования результатов поиска в целевой почтовый ящик, чтобы можно было просмотреть результаты поиска, а затем изменить запрос, если это необходимо, прежде чем удалять результаты поиска. 
  
В этом примере возвращаются сообщения, содержащие определенную фразу в поле Subject.
  
```
SearchQuery 'subject:"MAIL_BOX VALIDATION/UPGRADE!!!"' 
```

В этом примере возвращаются сообщения, отправленные в указанный диапазон дат.
  
```
SearchQuery 'sent>=06/01/2016 AND sent<=09/01/2016'
```
 
В этом примере возвращаются сообщения, отправленные указанному пользователю.

```
SearchQuery 'to:garthf@alpinehouse.com'
```
   
### <a name="verify-that-items-were-deleted"></a>Проверка того, что элементы были удалены

Чтобы убедиться, что вы успешно удалили элементы из папки "элементы с возможностью восстановления" почтового ящика, используйте командлет **Get-MailboxFolderStatistics** в Exchange Online PowerShell, чтобы проверить размер и количество элементов в папке "элементы с возможностью восстановления". Вы можете сравнить статистику с теми, которые были собраны на шаге 1. 
  
Выполните следующую команду, чтобы получить текущий размер и общее количество элементов в папках и вложенных папках в папке "элементы с возможностью восстановления" в основном почтовом ящике пользователя. 
  
```
Get-MailboxFolderStatistics <username> -FolderScope RecoverableItems | FL Name,FolderAndSubfolderSize,ItemsInFolderAndSubfolders
```
   
Выполните следующую команду, чтобы получить размер и общее количество элементов в папках и вложенных папках в папке "элементы с возможностью восстановления" в архивном почтовом ящике пользователя. 

```
Get-MailboxFolderStatistics <username> -FolderScope RecoverableItems -Archive | FL Name,FolderAndSubfolderSize,ItemsInFolderAndSubfolders
```
  
## <a name="step-6-revert-the-mailbox-to-its-previous-state"></a>Шаг 6: возврат к предыдущему состоянию почтового ящика

Последним шагом будет возврат к предыдущей конфигурации почтового ящика. Это означает, что вы переопределяете свойства, измененные в шаге 2, и повторно примените удержания, которые вы удалили на шаге 3. Это включает:
  
- Возврат к предыдущему значению срока хранения удаленного элемента. Кроме того, можно просто оставить это значение 30 дней, максимальное значение в Exchange Online.
    
- Повторное включение восстановления отдельных элементов.
    
- Повторное включение клиентских методов доступа, чтобы владелец мог получать доступ к своему почтовому ящику.
    
- Повторное применение удаленных политик хранения и Office 365.
    
- Повторное включение помощника для управляемых папок для обработки почтового ящика.
    
> [!IMPORTANT]
> Рекомендуем подождать 24 часа после повторного применения политики хранения или политики хранения Office 365 (и подтвердить, что она находится на месте) перед повторным включением обработки почтового ящика помощником для управляемых папок. 
  
Выполните следующие действия (в указанной последовательности) в Exchange Online PowerShell.
  
1. Выполните следующую команду, чтобы вернуться к исходному значению срока хранения удаленного элемента. Предполагается, что предыдущее значение меньше 30 дней; Например, 14 дней. 
    
    ```
    Set-Mailbox <username> -RetainDeletedItemsFor 14
    ```
   
2. Выполните следующую команду, чтобы снова включить восстановление отдельных элементов.
   
    ```
    Set-Mailbox <username> -SingleItemRecoveryEnabled $true
    ```

3. Выполните следующую команду, чтобы снова включить все методы клиентского доступа к почтовому ящику.
    
    ```
    Set-CASMailbox <username> -EwsEnabled $true -ActiveSyncEnabled $true -MAPIEnabled $true -OWAEnabled $true -ImapEnabled $true -PopEnabled $true
    ```
   
4. Повторно примените удержания, которые вы удалили на шаге 3. В зависимости от типа удержания используйте одну из следующих процедур.
    
    **Судебное удержание**
    
    Выполните следующую команду, чтобы снова включить удержание для судебного разбирательства для почтового ящика.
    
    ```
    Set-Mailbox <username> -LitigationHoldEnabled $true
    ```

    **In-Place Hold**
    
    Используйте центр администрирования Exchange (или Exchange Online PowerShell), чтобы добавить почтовый ящик обратно в режим удержания на месте. 
    
    **Политики хранения Office 365, применяемые к определенным почтовым ящикам**
    
    Используйте центр соответствия требованиям по безопасности _Амп_, чтобы добавить почтовый ящик обратно в политику хранения. Перейдите на страницу " **Управление** \> **сроком хранения** " в центре безопасности _амп_ соответствие требованиям, измените политику хранения и добавьте почтовый ящик обратно в список получателей, к которым применяется политика хранения. 
    
    **Политики хранения Office 365 на уровне Организации**
    
    Если вы удалили политику хранения на уровне Организации или на уровне Exchange, исключив ее из политики, используйте центр безопасности _Амп_ соответствие требованиям, чтобы удалить почтовый ящик из списка исключенных пользователей. Перейдите на страницу " **Хранение** управления **датой** \> " в центре безопасности _амп_ соответствие требованиям, измените политику хранения на уровне Организации и удалите почтовый ящик из списка исключенных получателей. Это приведет к повторному применению политики хранения к почтовому ящику пользователя. 
    
    **футляр для обнаружения электронных данных**
    
    Используйте центр соответствия требованиям по безопасности _Амп_, чтобы добавить почтовый ящик обратно к удержанию, связанному с вариантом обнаружения электронных данных. Перейдите на **** \> страницу **Обнаружение** электронных данных, откройте обращение и снова добавьте почтовый ящик в удержание. 
    
5. Выполните следующую команду, чтобы разрешить помощнику для управляемых папок повторно обработать почтовый ящик. Как было сказано ранее, мы рекомендуем подождать 24 часа после повторного применения политики хранения или политики хранения Office 365 (и проверить, что она находится на месте) до повторного включения помощника для управляемых папок. 

    ```
    Set-Mailbox <username> -ElcProcessingDisabled $false
    ```
   
6. Чтобы убедиться, что почтовый ящик возвращен в предыдущую конфигурацию, можно выполнить следующие команды, а затем сравнить параметры с теми, которые были собраны на шаге 1.

    ```
    Get-Mailbox <username> | FL ElcProcessingDisabled,InPlaceHolds,LitigationHoldEnabled,RetainDeletedItemsFor,SingleItemRecoveryEnabled
    ```

    ```
    Get-CASMailbox <username> | FL EwsEnabled,ActiveSyncEnabled,MAPIEnabled,OWAEnabled,ImapEnabled,PopEnabled
    ```
  
## <a name="more-information"></a>Дополнительные сведения

Ниже приведена таблица, в которой описывается, как определить различные типы удержаний на основе значений в свойстве *InPlaceHolds* при запуске командлетов **Get-Mailbox** или **Get-OrganizationConfig** . Более подробную информацию можно узнать в статье [как определить тип удержания, размещенного в почтовом ящике Exchange Online](identify-a-hold-on-an-exchange-online-mailbox.md).

Как описывалось ранее, необходимо удалить все удержания и политики хранения Office 365 из почтового ящика, прежде чем вы сможете успешно удалить элементы из папки "элементы с возможностью восстановления". 
  
|**Тип удержания**|**Пример значения**|**Определение удержания**|
|:-----|:-----|:-----|
|Хранение для судебного разбирательства  <br/> | `True` <br/> |Свойство  *LitigationHoldEnabled*  имеет значение  `True`.  <br/> |
|Хранение на месте  <br/> | `c0ba3ce811b6432a8751430937152491` <br/> |Свойство *InPlaceHolds* содержит GUID хранения на месте, который размещается в почтовом ящике. Вы можете указать, что это удержание на месте, так как идентификатор GUID не начинается с префикса.  <br/> Вы можете использовать `Get-MailboxSearch -InPlaceHoldIdentity <hold GUID> | FL` команду в Exchange Online PowerShell, чтобы получить сведения об удержании на месте для почтового ящика.  <br/> |
| Политики хранения Office 365 в центре безопасности _Амп_ соответствие требованиям, применяемые к определенным почтовым ящикам  <br/> | `mbxcdbbb86ce60342489bff371876e7f224` <br/> или  <br/>  `skp127d7cf1076947929bf136b7a2a8c36f` <br/> |При запуске командлета **Get – Mailbox** свойство *InPlaceHolds* также содержит идентификаторы GUID для политик хранения Office 365, применяемых к почтовому ящику. Вы можете определить политики хранения, так как идентификатор GUID начинается `mbx` с префикса. Обратите внимание, что если GUID политики хранения начинается с `skp` префикса, то это означает, что политика хранения применяется к беседам Skype для бизнеса.  <br/> Чтобы определить политику хранения Office 365, применяемую к почтовому ящику, выполните следующую команду в _Амп_ безопасности: <br/> <br/>`Get-RetentionCompliancePolicy <retention policy GUID without prefix> | FL Name`<br/><br/>Не забудьте удалить префикс  `mbx` или  `skp` при выполнении этой команды.  <br/> |
|Политики хранения Office 365 для всей Организации в центре безопасности _Амп_ соответствие требованиям  <br/> |Нет значения  <br/> или  <br/>  `-mbxe9b52bf7ab3b46a286308ecb29624696`(указывает, что почтовый ящик исключен из политики на уровне Организации)  <br/> |Даже если при запуске командлета **Get-Mailbox** свойство *InPlaceHolds* не задано, в почтовом ящике могут применятся одна или несколько политик хранения Office 365 для всей Организации.  <br/> Чтобы убедиться в этом, можно выполнить `Get-OrganizationConfig | FL InPlaceHolds` команду в Exchange Online PowerShell, чтобы получить список идентификаторов GUID для политик хранения Office 365 на уровне Организации. GUID политик хранения на уровне Организации, применяемых к почтовым ящикам Exchange, `mbx` начинаются с префикса; например `mbxa3056bb15562480fadb46ce523ff7b02`:.  <br/> Чтобы определить политику хранения Office 365 для всей Организации, которая применяется к почтовому ящику, выполните следующую команду в PowerShell центра безопасности _Амп_: <br/><br/> `Get-RetentionCompliancePolicy <retention policy GUID without prefix> | FL Name`<br/><br/>Обратите внимание, что если почтовый ящик исключен из политики хранения Office 365 на уровне Организации, идентификатор GUID политики хранения отображается в свойстве *InPlaceHolds* почтового ящика пользователя при запуске командлета **Get-Mailbox** . Он определяется по префиксу `-mbx`; Например`-mbxe9b52bf7ab3b46a286308ecb29624696` <br/> |
|удержание для обнаружения электронных данных в центре безопасности _Амп_ соответствие требованиям  <br/> | `UniH7d895d48-7e23-4a8d-8346-533c3beac15d` <br/> |Свойство *InPlaceHolds* также содержит GUID всех удержаний, связанных с вариантом обнаружения электронных данных в центре безопасности _амп_, который может быть размещен в почтовом ящике. То, что это удержание по делу обнаружения электронных данных, можно понять по префиксу GUID  `UniH`.  <br/> Вы можете использовать `Get-CaseHoldPolicy` командлет в PowerShell Security _Амп_ Security Center, чтобы получить сведения о том случае обнаружения электронных данных, с которым связано удержание в почтовом ящике. Например, вы можете выполнить команду `Get-CaseHoldPolicy <hold GUID without prefix> | FL Name` , чтобы отобразить имя удержания в почтовом ящике. Be sure to remove the  `UniH` при выполнении этой команды.  <br/><br/> Для идентификации случая обнаружения электронных данных, с которым связано удержание, выполните следующие команды:<br/><br/>`$CaseHold = Get-CaseHoldPolicy <hold GUID without prefix>`<br/><br/>`Get-ComplianceCase $CaseHold.CaseId | FL Name`


