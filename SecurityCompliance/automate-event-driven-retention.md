---
title: Хранение, зависящее от возникновения события
ms.author: stephow
author: stephow-MSFT
manager: laurawi
ms.date: ''
ms.audience: Admin
ms.topic: article
ms.service: o365-administration
localization_priority: Priority
ms.collection: Strat_O365_IP
search.appverid:
- MOE150
- MET150
description: В этой статье описывается, как настроить операции бизнес-процесса, чтобы автоматизировать хранение с помощью событий, используя REST API Microsoft 365.
ms.openlocfilehash: 4b4f310950f25e2a72dffa83de39b13c0b34cd97
ms.sourcegitcommit: 7e2a0185cadea7f3a6afc5ddc445eac2e1ce22eb
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/11/2019
ms.locfileid: "29740871"
---
# <a name="automate-event-based-retention"></a>Автоматизация хранения на основе событий

Процессы развертывания содержимого в организации, а также обнаружения избыточных, устаревших и тривиальных данных играют важную роль. Чтобы продолжать соответствовать юридическим, нормативным и бизнес-требованиям, компания должна обеспечить хранение и защиту важной информации, а также быстрый поиск необходимых данных. Хранение только важной и подходящей информации является ключевым фактором успеха.

Поэтому организации могут использовать преимущества решений для хранения в Центре безопасности и соответствия требованиям Office 365. Связанные с хранением операции можно активировать с помощью [меток хранения](labels.md). У метки хранения есть параметр для [определения периода хранения на основе конкретного события](event-driven-retention.md). Обычно период хранения зависит от известной даты, например даты создания или последнего изменения содержимого. Однако у организаций также есть требования по удалению содержимого на основе возникновения событий, например через 7 лет после того, как сотрудник уволился из организации.

Чтобы обеспечить удаление содержимого в соответствии с требованиями, важно знать, когда происходят события. Из-за стремительного роста объема содержимого становится сложно хранить и удалять данные своевременно и в соответствии с требованиями.

Хранения на основе событий решает эту проблему. В этой статье описывается, как настроить операции бизнес-процесса, чтобы автоматизировать хранение с помощью событий, используя REST API Microsoft 365.

## <a name="about-event-based-retention"></a>О хранении на основе событий

Независимо от размера организации количество деловых документов, юридических документов, файлов сотрудников, договоров и документов о продукции, которые ежедневно создаются и которыми необходимо управлять, стремительно растет.

Например, каждый день десятки и сотни сотрудников устраиваются на работу в организации или увольняются. Отдел кадров постоянно создает, обновляет или удаляет связанные с сотрудниками документы в соответствии с бизнес-требованиями. Этот процесс регулируется различными политиками, определяемыми для компании:

- **Период хранения содержимого может зависеть от известной даты**, например даты создания, последнего изменения содержимого или присвоения ему метки. Пример: вы можете хранить документы в течение семи лет после создания, а затем удалить их.

- **Период хранения содержимого может зависеть от неизвестной даты**. Например, с помощью меток хранения можно определять зависимость периода хранения от возникновения определенного типа события, такого как увольнение сотрудника из организации.

Событие активирует начало периода хранения, и ко всему содержимому с меткой, относящейся к событию данного типа, применяются действия хранения. Этот процесс называется хранением на основе событий. Дополнительные сведения о нем см. в статье [Общие сведения о хранении, зависящем от возникновения события](event-driven-retention.md).

## <a name="set-up-event-based-retention"></a>Настройка хранении на основе событий

В этом разделе описываются действия, необходимые для подготовки хранения содержимого.

### <a name="identify-roles"></a>Определение ролей

Определите различные роли в организации, которые будут выполнять задачи управления записями, обеспечивающие эффективное хранение деловых документов.

  | **Роль**| **Описание**|
  | - | - |
  | Администратор Центра безопасности и соответствия требованиям | Создает типы событий хранения, метки хранения и репозитории записей в SharePoint |
  | Управляющий записями                                  | Предоставляет указания по политикам и расписанию хранения, а также сведения о соответствии требованиям   |
  | Системный администратор (компания)                          | Настраивает внешние системы для работы с Microsoft 365 и управляет ими                       |
  | Информационный работник                               | Управляет жизненным циклом своих бизнес-процессов (отдела кадров, финансового отдела, ИТ-отдела и т. д.)                 |

### <a name="set-up-the-security--compliance-center"></a>Настройка Центра безопасности и соответствия требованиям
  
1. Администратор соответствия требованиям создает тип события, например увольнение сотрудника, завершение действия договора или прекращение производства продукта (описание пошагового процесса см. в [статье о событиях хранения](https://docs.microsoft.com/ru-RU/office365/securitycompliance/event-driven-retention)).
    
1. Администратор соответствия требованиям создает метку хранения на основе события и связывает метку с типом события.
    
1. Существует 4 типа триггеров меток хранения:
            
    1. Дата создания
                
    1. Дата последнего изменения
                
    1. Дата метки (когда содержимому была присвоена метка)
                
    1. На основе события
    
1. Администратор соответствия требованиям публикует метку.

### <a name="set-up-sharepoint"></a>Настройка SharePoint
   
Чтобы создать репозиторий записей, администратор соответствия требованиям выполняет следующие действия:

1. Создает сайт SharePoint.

1. Выполняет одно из указанных ниже действий:
        
    - Создает библиотеку SharePoint: задает метку на основе события на уровне библиотеки. Дополнительные сведения см. в разделе "Применение метки хранения по умолчанию ко всему контенту в библиотеке SharePoint, папке или набору документов" [этой статьи](labels.md#applying-a-default-retention-label-to-all-content-in-a-sharepoint-library-folder-or-document-set).
          
    - Настраивает набор документов в SharePoint. Дополнительные сведения см. в статье [Общие сведения о наборах документов](https://support.office.com/ru-RU/article/Introduction-to-Document-Sets-3DBCD93E-0BED-46B7-B1BA-B31DE2BCD234).
      
1. Назначает идентификатор ресурса (то есть название продукта или код, используемые в организации, например в роли идентификатора ресурса может выступать код сотрудника) каждому набору документов сотрудника. (При назначении идентификатора ресурса папке каждый элемент в папке автоматически наследует тот же идентификатор ресурса. То есть период хранения всех элементов запускается одним событием.)

## <a name="ways-to-trigger-event-based-retention"></a>Способы запуска хранения на основе события

Существует два способа запуска хранения на основе события:

- **С помощью пользовательского интерфейса Центра безопасности и соответствия требованиям**. Этот процесс можно использовать для хранения содержимого небольшого объема или в случае, когда активация хранения происходит редко (один раз в месяц или год). Дополнительные сведения об этом методе см. в статье [Общие сведения о хранении, зависящем от возникновения события](event-driven-retention.md). Однако этот способ запуска хранения может занимать много времени и уязвим для ошибок, что ограничивает масштабируемость. Поэтому автоматизированное и простое решение для активации хранения может повысить безопасность данных и улучшить их соответствие требованиям.

- **С помощью REST API M365.** Этот процесс можно использовать для хранения большого объема данных и/или в случае частой активации хранения (каждый день или каждую неделю). Этот процесс определяет, когда событие возникает в вашей бизнес-системе, и автоматически создает связанное событие в Центре безопасности и соответствия требованиям. Вам не нужно вручную создавать связанное событие в пользовательском интерфейсе каждый раз, когда происходит исходное событие.

Существует два способа использования REST API:

- **Microsoft Flow или аналогичное приложение** можно использовать для автоматического запуска события. Microsoft Flow — это оркестратор для подключения к другим системам. Для использования Microsoft Flow не требуется пользовательское решение.

- **PowerShell или HTTP-клиент для вызова REST API**. Используйте PowerShell (версии 6 или выше) для вызова REST API Microsoft 365, чтобы создать события. 

REST API — это конечная точка службы, поддерживающая операции (методы) HTTP, которая предоставляет права на создание, получение, обновление или удаление ресурсов службы. Дополнительные сведения см. в разделе "Компоненты запроса/ответа REST API" [этой статьи](https://docs.microsoft.com/ru-RU/rest/api/gettingstarted/#components-of-a-rest-api-requestresponse). В этом случае используя REST API Microsoft 365, можно создавать или получать события с помощью операций (методов) POST и GET.

## <a name="example-scenarios"></a>Примеры сценариев

Давайте рассмотрим следующие сценарии.

### <a name="scenario-1-employees-leaving-the-organization"></a>Сценарий 1. Сотрудники увольняются из организации 

Организация создает и хранит множество документов для каждого сотрудника. Эти документы управляются и хранятся в ходе трудовых отношений с сотрудником. Однако, когда сотрудник увольняется, организация в соответствии с законом и бизнес-требованиями обязана хранить документы об этом сотруднике в течение указанного периода.

Если из организации ежедневно увольняется несколько сотрудников, необходимо запускать счетчики хранения сотен или даже тысяч документов каждый день.

Кроме того, для каждого сотрудника период хранения рассчитывается на основе типа записи сотрудника (дата увольнения сотрудника + количество дней, месяцев или лет). Например, у документов о зарплате и документов о премии одного и того же сотрудника могут быть разные периоды хранения.

На схеме ниже показано, как с одним событием может быть связано несколько меток. Здесь все файлы с меткой зарплаты сотрудника и файлы с меткой премии сотрудника связаны с одним событием — увольнением сотрудника из организации. У каждого из этих файлов разные счетчики хранения. Поэтому, когда сотрудник увольняется из организации, у этих файлов с метками разный период хранения. Запуск всех этих разных счетчиков хранения для каждого типа файла или метки для каждого сотрудника является очень сложной задачей. А теперь представьте, что это нужно делать для нескольких сотрудников.

![Схема типов событий, событий и меток](media/automate-event-driven-retention-event-diagram-employee-leaving.png)

Поэтому автоматизированный процесс запуска всех этих различных счетчиков хранения для нескольких сотрудников должен работать быстро, быть безошибочным и очень эффективным.

**Настройка автоматизированного хранения на основе событий для этого сценария:**

![Схема ролей и действий для сценария, когда сотрудник увольняется из организации](media/automate-event-driven-retention-employee-termination-diagram.png)

  - Администратор создает папки сотрудников в наборе документов, например "Марта Артемьева", "Артем Кузнецов".

  - Администратор добавляет в каждую папку файлы сотрудников, например с данными о премиях и зарплате.

  - Администратор назначает идентификатор ресурса для каждой папки сотрудников. 

  - Администратор Центра безопасности и соответствия требованиям

  - выполняет вход в Центр безопасности и соответствия требованиям.

  - Администратор Центра безопасности и соответствия требованиям создает связанные с сотрудниками типы событий, например события "Увольнение сотрудника", "Прием сотрудника на работу" в Центре безопасности и соответствия требованиям.

  - Администратор Центра безопасности и соответствия требованиям создает метку "Хранение для сотрудника" в Центре безопасности и соответствия требованиям.

  - Эта метка "Хранение для сотрудника" публикуется и вручную или автоматически применяется к файлам сотрудника в SharePoint

  - Система управления отдела кадров, например Workday, может работать совместно с Microsoft Flow для периодического управления файлами сотрудников

  - Если сотрудник увольняется из организации, Flow активирует REST API хранения на основе событий M365, который запустит счетчик хранения для файлов определенного сотрудника.

#### <a name="using-microsoft-flow"></a>Использование Microsoft Flow

Шаг 1. Создайте процесс создания события с помощью REST API Microsoft 365

![Использование Flow для создания события](media/automate-event-driven-retention-flow-1.png)

![Использование Flow для вызова REST API](media/automate-event-driven-retention-flow-2.png)

##### <a name="create-an-event"></a>Создание события

Пример кода для вызова REST API

<table>
<thead>
<tr class="header">
<th>Метод</th>
<th>POST</th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>URL-адрес</td>
<td>https://ps.compliance.protection.outlook.com/psws/service.svc/ComplianceRetentionEvent)</td>
<td></td>
</tr>
<tr class="even">
<td>Заголовки</td>
<td>Content-Type</td>
<td>приложение/atom+xml</td>
</tr>
<tr class="odd">
<td>Основной текст</td>
<td><p>&lt;?xml version='1.0' encoding='utf-8' standalone='yes'?&gt;</p>
<p>&lt;entry xmlns:d='http://schemas.microsoft.com/ado/2007/08/dataservices'</p>
<p>xmlns:m='http://schemas.microsoft.com/ado/2007/08/dataservices/metadata'</p>
<p>xmlns='http://www.w3.org/2005/Atom'&gt;</p>
<p>&lt;category scheme='http://schemas.microsoft.com/ado/2007/08/dataservices/scheme' term='Exchange.ComplianceRetentionEvent' /&gt;</p>
<p>&lt;updated&gt;9/9/2017 10:50:00 PM&lt;/updated&gt;</p>
<p>&lt;content type='application/xml'&gt;</p>
<p>&lt;m:properties&gt;</p>
<p>&lt;d:Name&gt;Employee Termination &lt;/d:Name&gt;</p>
<p>&lt;d:EventType&gt;99e0ae64-a4b8-40bb-82ed-645895610f56&lt;/d:EventType&gt;</p>
<p>&lt;d:SharePointAssetIdQuery&gt;1234&lt;/d:SharePointAssetIdQuery&gt;</p>
<p>&lt;d:EventDateTime&gt;2018-12-01T00:00:00Z &lt;/d:EventDateTime&gt;</p>
<p>&lt;/m:properties&gt;</p>
<p>&lt;/content&gt;</p>
<p>&lt;/entry&gt;</p></td>
<td></td>
</tr>
<tr class="even">
<td>Проверка подлинности</td>
<td>Базовая</td>
<td></td>
</tr>
<tr class="odd">
<td>Имя пользователя</td>
<td>"Complianceuser"</td>
<td></td>
</tr>
<tr class="even">
<td>Пароль</td>
<td>"Compliancepassword"</td>
<td></td>
</tr>
</tbody>
</table>

##### <a name="available-parameters"></a>Доступные параметры

<table>
<thead>
<tr class="header">
<th><strong>Параметры</strong></th>
<th><strong>Описание</strong></th>
<th><strong>Примечания</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>&lt;d:Name&gt;&lt;/d:Name&gt;</td>
<td>Указание уникального имени события.</td>
<td>Не может содержать начальные и конечные пробелы и следующие символы: % * \ &amp; &lt; &gt; | # ? , : ;</td>
</tr>
<tr class="even">
<td>&lt;d:EventType&gt;&lt;/d:EventType&gt;</td>
<td>Введите название типа события (или Guid).</td>
<td>Пример: "Увольнение сотрудника". Тип события должен быть связан с меткой хранения.</td>
</tr>
<tr class="odd">
<td>&lt;d:SharePointAssetIdQuery&gt;&lt;/d:SharePointAssetIdQuery&gt;</td>
<td>Введите "ComplianceAssetId:" + код сотрудника</td>
<td>Пример: &quot;ComplianceAssetId:12345&quot;</td>
</tr>
<tr class="even">
<td>&lt;d:EventDateTime&gt;&lt;/d:EventDateTime&gt;</td>
<td>Дата и время события</td>
<td><p>Формат: ГГГГ-ММ-ДДTчч:мм:ссZ. Пример:</p>
<p>2018-12-01T00:00:00Z</p></td>
</tr>
</tbody>
</table>

##### <a name="response-codes"></a>Коды ответа

| **Код ответа** | **Описание**       |
| ----------------- | --------------------- |
| 302               | Перенаправление              |
| 201               | Создано               |
| 403               | Сбой авторизации  |
| 401               | Сбой проверки подлинности |

##### <a name="get-events-based-on-time-range"></a>Получение событий на основе диапазона времени

<table>
<thead>
<tr class="header">
<th>Метод</th>
<th>GET</th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>URL-адрес</td>
<td><ol start="4" type="1">
<li><p>https://ps.compliance.protection.outlook.com/psws/service.svc/ComplianceRetentionEvent?BeginDateTime=2019-01-11&amp;EndDateTime=2019-01-16</p></li>
</ol></td>
<td></td>
</tr>
<tr class="even">
<td>Заголовки</td>
<td>Content-Type</td>
<td>приложение/atom+xml</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>Проверка подлинности</td>
<td>Базовая</td>
<td></td>
</tr>
<tr class="odd">
<td>Имя пользователя</td>
<td>"Complianceuser"</td>
<td></td>
</tr>
<tr class="even">
<td>Пароль</td>
<td>"Compliancepassword"</td>
<td></td>
</tr>
</tbody>
</table>

##### <a name="response-codes"></a>Коды ответа

| **Код ответа** | **Описание**                   |
| ----------------- | --------------------------------- |
| 200               | Все в порядке, список событий в формате atom+xml |
| 404               | Не найдено                         |
| 302               | Перенаправление                          |
| 401               | Сбой авторизации              |
| 403               | Сбой проверки подлинности             |

##### <a name="get-an-event-by-id"></a>Получение события по идентификатору

| Метод         | GET   |                      |
| -------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | -------------------- |
| URL-адрес            | [https://ps.compliance.protection.outlook.com/psws/service.svc/ComplianceRetentionEvent(‘174e9a86-74ff-4450-8666-7c11f7730f66’)](https://ps.compliance.protection.outlook.com/psws/service.svc/ComplianceRetentionEvent\('174e9a86-74ff-4450-8666-7c11f7730f66'\)) |                      |
| Заголовок         | Content-Type                                                                                                                                                                                                                                                       | приложение/atom+xml |
| Проверка подлинности | Базовая                                                                                                                                                                                                                                                              |                      |
| Имя пользователя       | "Complianceuser"                                                                                                                                                                                                                                                   |                      |
| Пароль       | "Compliancepassword"                                                                                                                                                                                                                                               |                      |

##### <a name="response-codes"></a>Коды ответа

| **Код ответа** | **Описание**                                      |
| ----------------- | ---------------------------------------------------- |
| 200               | Все в порядке, текст ответа содержит событие в формате atom+xml |
| 404               | Не найдено                                            |
| 302               | Перенаправление                                             |
| 401               | Сбой авторизации                                 |
| 403               | Сбой проверки подлинности                                |

##### <a name="get-an-event-by-name"></a>Получение события по имени

| Метод         | GET       |                      |
| -------------- | -------------------------------------------------------------------------------------------------------------------------------------------- | -------------------- |
| URL-адрес            | <https://ps.compliance.protection.outlook.com/psws/service.svc/ComplianceRetentionEvent('EventByRESTPost-2226bfebcc2841a8968ba71f9516b763')> |                      |
| Заголовки        | Content-Type                                                                                                                                 | приложение/atom+xml |
| Проверка подлинности | Базовая                                                                                                                                        |                      |
| Имя пользователя       | "Complianceuser"                                                                                                                             |                      |
| Пароль       | "Compliancepassword"                                                                                                                         |                      |

##### <a name="response-codes"></a>Коды ответа

| **Код ответа** | **Описание**                                      |
| ----------------- | ---------------------------------------------------- |
| 200               | Все в порядке, текст ответа содержит событие в формате atom+xml |
| 404               | Не найдено                                            |
| 302               | Перенаправление                                             |
| 401               | Сбой авторизации                                 |
| 403               | Сбой проверки подлинности                                |

#### <a name="using-powershell-ver6-or-higher-or-any-http-client"></a>Использование PowerShell (версии 6 или выше) или любого HTTP-клиента

Шаг 1. Подключитесь к PowerShell.

Шаг 2. Запустите указанный ниже сценарий.

<table>
<tbody>
<tr class="odd">
<td><p>param([string]$baseUri)</p>
<p>$userName = &quot;UserName&quot;</p>
<p>$password = &quot;Password&quot;</p>
<p>$securePassword = ConvertTo-SecureString $password -AsPlainText -Force</p>
<p>$credentials = New-Object System.Management.Automation.PSCredential($userName, $securePassword)</p>
<p>$EventName=&quot;EventByRESTPost-$(([Guid]::NewGuid()).ToString('N'))&quot;</p>
<p>Write-Host &quot;Start to create an event with name: $EventName&quot;</p>
<p>$body = &quot;&lt;?xml version='1.0' encoding='utf-8' standalone='yes'?&gt;</p>
<p>&lt;entry xmlns:d='http://schemas.microsoft.com/ado/2007/08/dataservices'</p>
<p>xmlns:m='http://schemas.microsoft.com/ado/2007/08/dataservices/metadata'</p>
<p>xmlns='http://www.w3.org/2005/Atom'&gt;</p>
<p>&lt;category scheme='http://schemas.microsoft.com/ado/2007/08/dataservices/scheme' term='Exchange.ComplianceRetentionEvent' /&gt;</p>
<p>&lt;updated&gt;7/14/2017 2:03:36 PM&lt;/updated&gt;</p>
<p>&lt;content type='application/xml'&gt;</p>
<p>&lt;m:properties&gt;</p>
<p>&lt;d:Name&gt;$EventName&lt;/d:Name&gt;</p>
<p>&lt;d:EventType&gt;e823b782-9a07-4e30-8091-034fc01f9347&lt;/d:EventType&gt;</p>
<p>&lt;d:SharePointAssetIdQuery&gt;'ComplianceAssetId:123'&lt;/d:SharePointAssetIdQuery&gt;</p>
<p>&lt;/m:properties&gt;</p>
<p>&lt;/content&gt;</p>
<p>&lt;/entry&gt;&quot;</p>
<p>$event = $null</p>
<p>try</p>
<p>{</p>
<p>$event = Invoke-RestMethod -Body $body -Method 'POST' -Uri &quot;$baseUri/ComplianceRetentionEvent&quot; -ContentType &quot;application/atom+xml&quot; -Authentication Basic -Credential $credentials -MaximumRedirection 0</p>
<p>}</p>
<p>catch</p>
<p>{</p>
<p>$response = $_.Exception.Response</p>
<p>if($response.StatusCode -eq &quot;Redirect&quot;)</p>
<p>{</p>
<p>$url = $response.Headers.Location</p>
<p>Write-Host &quot;redirected to $url&quot;</p>
<p>$event = Invoke-RestMethod -Body $body -Method 'POST' -Uri $url -ContentType &quot;application/atom+xml&quot; -Authentication Basic -Credential $credentials -MaximumRedirection 0</p>
<p>}</p>
<p>}</p>
<p>$event | fl *</p></td>
</tr>
</tbody>
</table>

#### <a name="verify-the-outcome-in-both-options"></a>Проверка результатов обоих вариантов

Шаг 1. Перейдите в Центр безопасности и соответствия требованиям.

Шаг 2: Щелкните пункт "Управление данными" и выберите "События".

Шаг 3. Убедитесь, что событие создано.

Аналогичным образом описанные выше варианты автоматизации хранения на основе событий можно использовать и для следующих сценариев.

### <a name="scenario-2-contracts-expiring"></a>Сценарий 2. Окончание действия договоров

Организация может вести несколько записей для одного договора с клиентами, поставщиками и партнерами. Эти документы могут хранится в библиотеке документов, например SharePoint. Окончание действия договора определяет начало периода хранения документов, связанных с договором. Пример: все записи, связанные с договорами, следует хранить в течение пяти лет с момента завершения действия договора. Событием, которое активирует пятилетний период хранения, является завершение действия договора.

Система управления отношениями с клиентами может работать совместно с Microsoft 365 и активировать хранение документов договора.

**Настройка автоматизированного хранения на основе событий для этого сценария:**

![Схема ролей и задач для сценария окончания действия договора](media/automate-event-driven-retention-contract-expiration.png)

  - Администратор создает библиотеку SharePoint с различными папками для каждого типа договора.

  - Администратор добавляет файлы договора, например лицензионные соглашения, договоры о разработке, в папку каждого договора.

  - Администратор назначает идентификатор ресурса для каждой папки договора.

  - Администратор Центра безопасности и соответствия требованиям выполняет вход в Центр безопасности и соответствия требованиям.

  - Администратор Центра безопасности и соответствия требованиям создает связанные с договорами типы событий, например события "Создание договора", "Завершение действия договора", в Центре безопасности и соответствия требованиям.

  - Администратор Центра безопасности и соответствия требованиям создает метку "Завершение действия договора" в Центре безопасности и соответствия требованиям.

  - Эта метка "Завершение действия договора" публикуется и вручную или автоматически применяется к файлам договора в SharePoint

  - Система управления договорами может работать совместно с Microsoft Flow или аналогичным приложением для периодического управления файлами договоров.

  - Если срок действия договора завершается, Microsoft Flow активирует REST API хранения на основе событий M365, который запустит счетчик хранения для файлов определенного договора.

### <a name="scenario-3-end-of-product-manufacturing"></a>Сценарий 3. Прекращение производства продукта

Производственная компания, которая изготавливает различные линейки продуктов, создает множество документов с техническими характеристиками производства и ценами. Если продукт перестает производится, все технические характеристики и документы, связанные с этим продуктом, следует хранить в течение определенного периода времени после окончания существования продукта.

Система планирования ресурсов предприятия (ERP) может работать совместно с Microsoft 365 и Microsoft Flow для активации хранения.

**Настройка автоматизированного хранения на основе событий для этого сценария:**

![Схема ролей и задач для сценария жизненного цикла продукта](media/automate-event-driven-retention-product-lifecycle-expiration.png)

  - Администратор создает папки продуктов в наборе документов, например "Продукт 1", "Продукт 2" и т. д.

  - Администратор добавляет файлы продуктов, например технические характеристики производства, цены продуктов и лицензирование продуктов, в каждую папку продукта.

  - Администратор назначает идентификатор ресурса для каждой папки продукта.

  - Администратор Центра безопасности и соответствия требованиям выполняет вход в Центр безопасности и соответствия требованиям.

  - Администратор Центра безопасности и соответствия требованиям создает связанные с сотрудниками типы событий, например события "Начало изготовления продукта", "Завершение изготовление продукта", в Центре безопасности и соответствия требованиям.

  - Администратор Центра безопасности и соответствия требованиям создает метку "Завершение изготовление продукта" в Центре безопасности и соответствия требованиям.

  - Эта метка "Завершение изготовление продукта" публикуется и вручную или автоматически применяется к файлам продукта в SharePoint

  - Система ERP может работать совместно с Microsoft Flow или аналогичным приложением для периодического управления файлами продуктов.

  - Если изготовление продукта завершается, Microsoft Flow активирует REST API хранения на основе событий M365, который запустит счетчик хранения для файлов определенного продукта.

## <a name="appendix"></a>Приложение

### <a name="using-redirect-302-response-results-to-call-the-rest-api"></a>Использование результатов ответа 302 (перенаправление) для вызова REST API

1.  Вызовите событие хранения POST с помощью URL-адреса REST API <https://ps.compliance.protection.outlook.com/psws/service.svc/ComplianceRetentionEvent> (требуются разрешения глобального администратора)

2.  Проверьте код ответа. Если получен код 302, получите URL-адрес перенаправления из свойства Location (Расположение) заголовка ответа

3.  Вызовите событие хранения POST еще раз с помощью URL-адреса перенаправления

## <a name="credits"></a>Сведения об авторах

Редактор статьи:

Antonio Maio</br>MVP в сфере приложений и служб Microsoft Office</br> Antonio.Maio@Protiviti.com
