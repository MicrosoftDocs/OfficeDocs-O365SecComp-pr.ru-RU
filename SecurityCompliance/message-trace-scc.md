---
title: Трассировка сообщений в Центре безопасности и соответствия требованиям
ms.author: chrisda
author: chrisda
manager: dansimp
audience: ITPro
ms.topic: article
ms.service: O365-seccomp
localization_priority: Normal
ms.assetid: 3e64f99d-ac33-4aba-91c5-9cb4ca476803
description: Администраторы могут использовать трассировку сообщений в центре безопасности & соответствия требованиям, чтобы узнать, что произошло с сообщениями.
ms.openlocfilehash: af3739174203d7c8d81086a5bf7d036bc2bdd76f
ms.sourcegitcommit: 73dcdafb15b462223d1a670c781db260eb73c2f5
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/01/2019
ms.locfileid: "36048221"
---
# <a name="message-trace-in-the-security--compliance-center"></a>Трассировка сообщений в Центре безопасности и соответствия требованиям

## <a name="overview"></a>Обзор

Трассировка сообщений в центре безопасности & соответствия требованиям следует сообщениям электронной почты по мере их прохождения через организацию Exchange Online. Вы можете определить, было ли сообщение получено, отклонено, задержано или доставлено службой. Кроме того, здесь показано, какие действия были выполнены над сообщением до достижения его последнего состояния.

Трассировка сообщений в центре безопасности & соответствия требованиям повышается при трассировке сообщений, доступной в центре администрирования Exchange. Сведения из трассировки сообщений можно использовать для эффективного ответа на вопросы пользователей о том, что случилось с сообщениями, устранять проблемы с потоками обработки почты и проверять изменения политики.

> [!NOTE]
> Предельное количество возвращаемых сообщений равно 50 000. В консоли при выполнении очень большого запроса число сообщений отчета о командлетах Get – HistoricalSearch превышает 240 000.

## <a name="open-message-trace"></a>Открыть трассировку сообщений

1. [Войдите в Office 365](https://support.office.com/article/e9eb7d51-5430-4929-91ab-6157c5a050b4) с помощью рабочая или учебная учетная запись.

2. Слева вверху щелкните значок средства запуска приложений ![Значок средства запуска приложения Office 365](media/0aaa6945-f9a4-4b13-bf5f-d5c5dbe978fb.png) и выберите **Администратор**.

3. В нижней левой панели навигации разверните узел **центры администрирования** и выберите **Безопасность & соответствия требованиям**.

4. На открывшейся странице **соответствие & безопасности** разверните пункт **почтовый ящик**и выберите Трассировка **сообщений**.

## <a name="message-trace-page"></a>Страница отслеживания сообщений

Отсюда можно запустить новую трассировку по умолчанию, нажав кнопку **Начать трассировку** . Это приведет к поиску всех сообщений для всех отправителей и получателей за последние два дня. Вы также можете использовать один из сохраненных запросов из доступных категорий запроса и либо запускать их от имени, либо использовать их в качестве начальных точек для собственных запросов:

- **Запросы по умолчанию**: встроенные запросы, предоставляемые Office 365.

- **Пользовательские запросы**: запросы, сохраненные администраторами в Организации для последующего использования.

- **Автоматически сохраняемые запросы**: последние десять наиболее часто выполняемых запросов. Этот список упрощает работу с места, с которого вы остановились.

Кроме того, на этой странице представлен раздел **загружаемых отчетов** для отправленных вами запросов, а также отчеты, доступные для загрузки.

## <a name="options-for-a-new-message-trace"></a>Параметры для новой трассировки сообщений

### <a name="filter-by-senders-and-recipients"></a>Фильтрация отправителей и получателей

Значения по умолчанию — **все отправители** и **все получатели**, но для фильтрации результатов можно использовать следующие поля:

- Для **следующих людей**: щелкните это поле, чтобы выбрать одного или нескольких отправителей из вашей организации. Кроме того, можно ввести имя, а элементы списка будут фильтроваться по введенным данным, во многих случаях, как на странице поиска.

- **Для следующих людей**: щелкните это поле, чтобы выбрать одного или нескольких получателей в Организации.

> [!NOTE]
> Вы также можете ввести адреса электронной почты внешних отправителей и получателей. Поддерживаются подстановочные знаки`*@contoso.com` ( `scot?@contoso.com`или), но нельзя одновременно использовать несколько подстановочных знаков в одном и том же поле.<br/>Можно вставить несколько отправителей или список получателей, разделенных точкой с`;`запятой (). Допускается использование`\s`пробелов (),`\r`символов возврата каретки (`\n`) и последующих строк ().

### <a name="time-range"></a>Диапазон времени

Значение по умолчанию — **2 дня**, но вы можете указать диапазоны дат и времени до 90 дней. При использовании диапазонов дат и времени учитывайте следующие моменты.

- По умолчанию диапазон времени выбирается в **ползунке** с использованием строки времени. Можно выбрать только отображаемые параметры дня или времени. При попытке выбрать входящее значение будет привязано подпузырькову "начало/конец" к ближайшему отображаемому параметру.

   ![Временной диапазон в новой трассировке сообщений в центре безопасности & соответствия требованиям](media/55a9e9c1-f7d5-4047-b217-824e8b976bcb.png)

   Кроме того, можно переключиться **** на настраиваемое представление, в котором можно указать значения **даты начала** и **окончания** (в том числе время), а также выбрать часовой **пояс** для диапазона дат и времени. Обратите внимание на то, что параметр **Часовой пояс** применяется как к входным запросам, так и к результатам запроса.

   ![Настраиваемый диапазон времени в новой трассировке сообщений в центре безопасности & соответствия требованиям](media/ed4c8d50-9ea5-4694-93f9-ee3ab6660b4f.png)

   В течение 10 или меньше дней результаты сразу же доступны в виде **сводного** отчета. Если указать диапазон времени, размер которого еще не превышает 10 дней, результаты будут замедлены, так как они доступны только в виде загружаемого CSV-файла ( **Расширенные сводки** или **Расширенные** отчеты).

   Для получения дополнительных сведений о различных типах отчетов обратитесь к разделу [Выбор типа отчета](#choose-report-type) в этой статье.

   **Note**: расширенные сводные и расширенные отчеты подготавливаются с использованием архивных данных трассировки сообщений и могут занимать до нескольких часов, прежде чем отчет будет доступен для скачивания. В зависимости от того, сколько других администраторов одновременно отправило запросы отчетов, вы также можете заметить задержку перед началом обработки запроса в очереди.

- При сохранении запроса в **** виде ползунка сохраняется относительный диапазон времени (например, 3 дня из текущей даты). Сохранение запроса в **настраиваемом** представлении сохраняет абсолютный диапазон даты и времени (например, 2018-05-06 13:00 – 2018-05-08 18:00).

### <a name="more-search-options"></a>Дополнительные параметры поиска

#### <a name="delivery-status"></a>Состояние доставки.

Можно оставить значение по умолчанию для **всех** выбранных элементов или выбрать одно из следующих значений, чтобы отфильтровать результаты:

- **Доставлено**: сообщение было успешно доставлено в место назначения.

- **Ожидание**: предпринята попытка доставки сообщения или ее повторная попытка.

- **Развернуто**: получатель группы рассылки был расширен до доставки их отдельным участникам группы.

- **Сбой**: сообщение не доставлено.

- **Помещено в карантин**: сообщение помещено в карантин (как нежелательная почта, массовая рассылка или фишинг). Дополнительные сведения см в разделе [карантин сообщений электронной почты в Office 365](https://support.office.com/article/4c234874-015e-4768-8495-98fcccfc639b.aspx).

- **Отфильтровано как нежелательная почта**: сообщение было идентифицировано и отклонено или заблокировано (не помещено в карантин).

- **Идет извлечение состояния:** Сообщение было недавно получено в Office 365, но другие данные о состоянии еще не доступны. Вернитесь в течение нескольких минут.

**Note**: значения **ожидают,** **помещены в карантин**, а фильтр нежелательной **почты** доступен только для поиска менее 10 дней. Кроме того, может быть задержка от 5 до 10 минут между реальным и отчетным состоянием доставки.

#### <a name="message-id"></a>ИД сообщения

Это идентификатор сообщения Интернета (также называемый ИДЕНТИФИКАТОРом клиента), который находится в поле заголовка **Message-ID:** заголовка сообщения. Пользователи могут предоставить это значение для изучения определенных сообщений.

Это значение не изменяется на протяжении всего времени жизни сообщения. Для сообщений, созданных в Office 365 или Exchange, значение задается в `<GUID@ServerFQDN>`формате, включая угловые скобки (\< \>). Например, `<d9683b4c-127b-413a-ae2e-fa7dfb32c69d@DM3NAM06BG401.Eop-nam06.prod.protection.outlook.com>`. Другие системы обмена сообщениями могут использовать различные синтаксис или значения. Это значение должно быть уникальным, но не все системы электронной почты строго соответствуют этому требованию. Если для входящих сообщений из внешних источников не существует или поле заголовка **Message-ID:** отсутствует или пустое, назначается произвольное значение.

При фильтрации результатов с помощью **идентификатора сообщения** обязательно включайте всю строку, включая угловые скобки.

#### <a name="direction"></a>Direction

Можно оставить значение по умолчанию **все** выбранным или выбрать **Входящие** (сообщения, отправленные получателям в организации) или исходящие (сообщения, отправленные от пользователей в организации), чтобы отфильтровать результаты. ****

#### <a name="original-client-ip-address"></a>Исходный IP-адрес клиента.

Вы можете файловый результаты по IP-адресу клиента для изучения взломанных компьютеров, которые отправляют большие объемы нежелательной почты или вредоносных программ. Несмотря на то, что сообщения могут поступать от нескольких отправителей, скорее всего, один и тот же компьютер создает все сообщения.

**Note**: сведения об IP-адресе клиента доступны только в течение 10 дней и доступны только в расширенной **сводке** или **РАСШИРЕНных** отчетах (CSV-файлы, доступные для загрузки).

### <a name="choose-report-type"></a>Выбор типа отчета

Доступны следующие типы отчетов:

- **Сводка**: доступна, если диапазон времени меньше 10 дней и не требует дополнительных параметров фильтрации. Результаты доступны почти сразу после нажатия кнопки **Поиск**.

- **Расширенная сводка** или **Расширенная**: эти отчеты доступны только для загружаемых CSV-файлов, и для них требуется один или несколько из следующих параметров фильтрации независимо от диапазона времени: от **этих людей**, **к этим людям**или ** Идентификатор сообщения**. Можно использовать подстановочные знаки для отправителей или получателей (например, \*@contoso. com).

**Примечания.**

- Расширенные сводные и расширенные отчеты подготавливаются с использованием архивных данных трассировки сообщений и могут занимать до нескольких часов, прежде чем отчет будет доступен для загрузки. В зависимости от того, сколько других администраторов одновременно отправило запросы отчетов, вы также можете заметить задержку перед началом обработки запроса в очереди.

- Вы можете выбрать Расширенный сводный или расширенный отчет для любого диапазона дат и времени, обычно последние четыре часа архивированных данных пока не будут доступны для этих двух типов отчетов.

После нажатия кнопки **Далее**отображается страница сводки со списком выбранных параметров фильтрации, уникального (редактируемого) заголовка для отчета и адреса электронной почты, который получает уведомление при завершении трассировки сообщения (также можно редактировать, и должна находиться в одном из обслуживаемых доменов вашей организации). Щелкните **подготовить отчет** , чтобы отправить трассировку сообщений. На странице основная **Трассировка сообщений** вы можете просмотреть состояние отчета в разделе **Доступные для загрузки отчеты** .

Для получения дополнительных сведений о данных, возвращаемых в различных типах отчетов, ознакомьтесь со статьей в следующем разделе.

## <a name="message-trace-results"></a>Результаты трассировки сообщений

Различные типы отчетов возвращают различные уровни информации. Сведения, доступные в различных отчетах, описаны в следующих разделах.

### <a name="summary-report-output"></a>Выходные данные сводного отчета

После выполнения трассировки сообщений будут отображаться результаты, отсортированные по убыванию даты и времени (самый свежий первый).

![Результаты сводного отчета для трассировки сообщений в центре безопасности & соответствия требованиям](media/0664bafe-0b03-477b-b571-0b046ac8c977.png)

Сводный отчет содержит следующие сведения:

- **Дата**: Дата и время получения сообщения службой с использованием настроенного часового пояса UTC.

- **Отправитель**: адрес электронной почты отправителя (**@*домен*-псевдоним).

- **Получатель**: адрес электронной почты получателя или получателя. Для сообщения, отправленного нескольким получателям, существует одна строка для каждого получателя. Если получателем является группа рассылки, динамическая группа рассылки или группа безопасности с включенной поддержкой почты, то Группа будет первым получателем, а затем каждый участник группы будет находиться в отдельной строке.

- **Тема**: первые 256 символов в поле **subject сообщения: Subject:** .

- **Состояние**: эти значения описаны в разделе [состояние доставки](#delivery-status) .

По умолчанию первые 250 результатов загружаются и легко доступны. При прокрутке вниз существует небольшая пауза при загрузке следующего пакета результатов. Вместо прокрутки можно нажать кнопку **загрузить все** , чтобы загрузить все результаты до максимум в 10 000.

Можно щелкнуть заголовки столбцов, чтобы отсортировать результаты по значениям в этом столбце в возрастающем или убывающем порядке.

Можно щелкнуть **результаты фильтра** , чтобы отфильтровать результаты по одному или нескольким столбцам.

Вы можете экспортировать результаты после того, как вы выберете одну или несколько строк, нажав кнопку **Экспорт результатов** и выбрав **Экспорт всех результатов**, **Экспорт загруженных результатов**или **Экспорт выбранных**.

#### <a name="find-related-records-for-this-message"></a>Поиск связанных записей для этого сообщения

Связанные записи сообщений — это записи, которые совместно применяют один и тот же идентификатор сообщения. Помните, что даже одно сообщение, переданное двумя пользователями, может создавать несколько записей. Число записей увеличивается, если на сообщение влияют расширения группы рассылки, пересылка, правила для обработки почты (также называемые правилами транспорта) и т. д.

После выбора флажка строки можно найти связанные записи для сообщения, щелкнув появившуюся кнопку **найти** или выбрав **Дополнительные параметры** ![](media/1ea52bbf-9d00-48ce-9362-307f7f6fb7fe.png) \> **найти связанные записи для этого сообщения**.

Более подробную информацию об ИДЕНТИФИКАТОРе сообщения можно узнать в разделе "идентификатор сообщения" ранее в этой статье.

#### <a name="message-trace-details"></a>Сведения о трассировке сообщений

В выходных данных сводного отчета можно просмотреть сведения о сообщении одним из следующих способов:

- Выберите строку (щелкните в любом месте строки, кроме флажка).

- Установите флажок строки и нажмите кнопку **Дополнительные параметры** ![](media/1ea52bbf-9d00-48ce-9362-307f7f6fb7fe.png) \> , чтобы **Просмотреть сведения о сообщении**.

   ![Сведения после двойного щелчка строки в отчете сводки результаты трассировки в центре безопасности & соответствия требованиям](media/e50ee7cd-810a-4c06-8b58-e56ffd7028d1.png)

В сведениях о трассировке сообщений содержатся следующие дополнительные сведения, которые не представлены в сводном отчете.

- **События сообщений**: в этом разделе содержатся классификации, помогающие классифицировать действия, которые служба использует в сообщениях. Ниже перечислены некоторые интересные события, которые могут возникнуть.

   - **Receive**: сообщение было получено службой.

   - **Send**: сообщение отправлено службой.

   - **Сбой**: не удалось доставить сообщение.

   - **Доставка**: сообщение доставлено в почтовый ящик.

   - **Expand**: сообщение отправлено в группу рассылки, которая была развернута.

   - **Transfer**: получатели были перемещены в сообщение раздвоенное из-за преобразования контента, ограничения получателей сообщений или агентов.

   - **Отложить**: Доставка сообщения была отложена и может быть повторена позже.

   - **Разрешено**: сообщение было перенаправлено на новый адрес получателя на основе поиска в Active Directory. В этом случае исходный адрес получателя указывается в отдельной строке трассировки сообщений вместе с итоговым состоянием доставки сообщения.

   Обратите внимание, что даже доставленное сообщение о недоставке будет создавать несколько записей **событий** в трассировке сообщений.

- **Дополнительные сведения**: в этом разделе содержатся следующие сведения:

   - **Идентификатор сообщения**: это значение описывается в разделе " [идентификатор сообщения](#message-id) " ранее в этой статье. Например, `<d9683b4c-127b-413a-ae2e-fa7dfb32c69d@DM3NAM06BG401.Eop-nam06.prod.protection.outlook.com>`.

   - **Размер сообщения**.

   - **Из IP**: IP-адрес компьютера, отправившего сообщение. Для исходящих сообщений, отправляемых из Exchange Online, это значение не задано.

   - **К IP**: IP-адрес или адреса, на которые служба пытается доставить сообщение. Если у сообщения несколько получателей, они отображаются. Для входящих сообщений, отправляемых в Exchange Online, это значение не задано.

### <a name="enhanced-summary-reports"></a>Расширенные сводные отчеты

Доступные (выполненные) расширенные сводные отчеты доступны в разделе **загружаемые отчеты** в начале трассировки сообщений. В отчете представлены следующие сведения:

- **оригин_тиместамп**<sup>*</sup>: Дата и время первого получения сообщения службой с использованием настроенного часового пояса UTC.

- **сендер_аддресс**: адрес электронной почты отправителя (**@*домен*псевдонима).

- **РеЦипиент_статус**: состояние доставки сообщения получателю. Если сообщение было отправлено нескольким получателям, он покажет всем получателям и соответствующее состояние каждого из них в \<формате:*состояние*\> *адреса*\>##\<электронной почты. Пример:

   - **# #Receive, Send** означает, что сообщение было получено службой и было отправлено в нужное место.

   - **# #Receive, Fail** означает, что сообщение было получено службой, но не удалось доставить его в предполагаемое место назначения.

   - **# #Receive, Доставка** означает, что сообщение было получено службой и доставлено в почтовый ящик получателя.

- **мессаже_субжект**: первые 256 символов поля **subject** сообщения.

- **тотал_битес**: размер сообщения в байтах, включая вложения.

- **message_id**: это значение описывается в разделе " [идентификатор сообщения](#message-id) " ранее в этой статье. Например, `<d9683b4c-127b-413a-ae2e-fa7dfb32c69d@DM3NAM06BG401.Eop-nam06.prod.protection.outlook.com>`.

- **нетворк_мессаже_ид**: уникальное значение идентификатора сообщения, которое хранится для всех копий сообщения, которое может быть создано из-за развертывание или расширения группы рассылки. Пример значения: `1341ac7b13fb42ab4d4408cf7f55890f`.

- **оригинал_клиент_ип**: IP-адрес клиента отправителя.

- **направленность**: указывает, было ли сообщение отправлено в организацию (1) или отправлено ли оно исходящим (2) из вашей организации.

- **коннектор_ид**: имя исходного или конечного соединителя. Дополнительные сведения о соединителях в Exchange Online приведены в статье [Настройка почтового процесса с помощью соединителей в Office 365](https://docs.microsoft.com/Exchange/mail-flow-best-practices/use-connectors-to-configure-mail-flow/use-connectors-to-configure-mail-flow).

- **деливери_приорити**<sup>*</sup>: было ли сообщение отправлено с **высоким**, **минимальным**или **нормальным** приоритетом.

<sup>*</sup>Эти свойства доступны только в расширенных сводных отчетах.

### <a name="extended-reports"></a>Расширенные отчеты

Доступные (выполненные) Расширенные отчеты доступны в разделе **загружаемые отчеты** в начале трассировки сообщений. Практически все сведения из расширенного сводного отчета доступны в расширенном отчете (за исключением **оригин_тиместамп** и **деливери_приорити**). Следующие дополнительные сведения доступны только в расширенном отчете:

- **клиент_ип**: IP-адрес почтового сервера или клиента обмена сообщениями, отправившего сообщение.

- **клиент_хостнаме**: имя узла или полное доменное имя сервера электронной почты или клиента обмена сообщениями, отправившего сообщение.

- **сервер_ип**: IP-адрес исходного или конечного сервера.

- **сервер_хостнаме**: имя узла или полное доменное имя целевого сервера.

- **саурце_контекст**: Дополнительные сведения, связанные с **исходным** полем. Пример:

   - `Protocol Filter Agent`

   - `3489061114359050000`

- **источник**: компонент Exchange Online, ответственный за событие. Пример:

   - `AGENT`

   - `MAILBOXRULE`

   - `SMTP`

- **евент_ид**: эти значения соответствуют значениям **событий сообщений** , описанным в разделе [найти связанные записи для этого сообщения](#find-related-records-for-this-message) .

- **интернал_мессаже_ид**: идентификатор сообщения, назначенный сервером Exchange Online, который в настоящее время обрабатывает сообщение.

- **реЦипиент_аддресс**: адреса электронной почты получателей сообщения. Если указано несколько адресов, то они отделяются друг от друга точкой с запятой (;).

- **реЦипиент_каунт**: общее количество получателей в сообщении.

- **релатед_реЦипиент_аддресс**: используется с `EXPAND`событиями `REDIRECT`, `RESOLVE` и событиями для отображения других адресов электронной почты получателей, связанных с сообщением.

- **ссылка**: в этом поле содержатся дополнительные сведения о конкретных типах событий. Пример:

   - **DSN**: содержит ссылку на отчет, которая представляет собой значение **message_id** соответствующего уведомления о доставке (также известного как DSN, отчет о недоставке, отчет о недоставке или сообщение о недоставке), если для этого события создается DSN. Если это сообщение DSN, это поле содержит значение **message_id** исходного сообщения, для которого было создано имя источника данных.

   - **Expand**: содержит значение **релатед_реЦипиент_аддресс** связанных сообщений.

   - **Receive**: может содержать значение **message_id** связанного сообщения, если сообщение было создано другими процессами (например, правилами папки "Входящие").

   - **Send**: содержит значение **интернал_мессаже_ид** для любых сообщений DSN.

   - **Transfer**: содержит значение **интернал_мессаже_ид** сообщения, которое размещается (например, по преобразованиям содержимого, ограничениям получателей сообщений или агентам).

   - **Маилбоксруле**: содержит значение **интернал_мессаже_ид** входящего сообщения, которое привело к созданию исходящего сообщения правилом папки "Входящие".

   Для других типов событий это поле обычно пустое.

- **ретурн_пас**: возвращаемый адрес электронной почты, указанный в команде **mail from** , который отправил сообщение. Хотя это поле никогда не будет пустым, оно может иметь значение NULL для адреса отправителя `<>`, представленное как.

- **мессаже_инфо**: Дополнительные сведения о сообщении. Пример:

   - Дата и время происхождения сообщения в формате UTC для `DELIVER` событий и `SEND` событий. Дата и время начала — это время, когда сообщение впервые вошло в организацию Exchange Online. Дата и время в формате UTC представлены в формате даты-времени ISO `yyyy-mm-ddThh:mm:ss.fffZ`8601:, где `yyyy` = год, `mm` = месяц, `dd` = день, `T` обозначает начало компонента времени, `hh` = час, `mm` = минута, `ss` = секунды, = `fff` доли секунды и `Z` обозначает `Zulu`, что еще один способ обозначить время в формате UTC.

   - Ошибки проверки подлинности. Например, вы можете увидеть значение `11a` и тип проверки подлинности, использованной при возникновении ошибки проверки подлинности.

- **тенант_ид**: значение GUID, которое представляет организацию Exchange Online (например, `39238e87-b5ab-4ef6-a559-af54c6b07b42`).

- **оригинал_сервер_ип**: IP-адрес исходного сервера.

- **кустом_дата**: содержит данные, связанные с определенными типами событий. Дополнительные сведения приведены в следующих разделах.

#### <a name="customdata-values"></a>значения кустом_дата

Поле **кустом_дата** для `AGENTINFO` события используется различными агентами Exchange Online для записи сведений об обработке сообщений. Некоторые из более интересных агентов описаны в следующих разделах.

#### <a name="spam-filter-agent"></a>Агент фильтра нежелательной почты

Значение **кустом_дата** , начинающееся с `S:SFA` , находится в агенте фильтрации нежелательной почты. Ключевые сведения описаны в таблице ниже.

|**Значение**|**Описание**|
|:-----|:-----|
|`SFV=NSPM`|Сообщение помечено как не являющееся нежелательным и отправлено указанным получателям.|
|`SFV=SPM`|Сообщение помечено фильтром содержимого как нежелательное.|
|`SFV=BLK`|Фильтрация была пропущена, а сообщение было заблокировано, так как оно исходило от заблокированного отправителя.|
|`SFV=SKS`|Сообщение помечено как нежелательное до обработки фильтром содержимого. Это применяется к сообщениям, в которых сообщение сопоставлено с правилом транспорта автоматически помечать его как нежелательное и обходить любую дополнительную фильтрацию.|
|`SCL=<number>`|Дополнительные сведения о различных значениях вероятности нежелательной почты и их значении см. в разделе [Вероятность нежелательной почты](https://technet.microsoft.com/library/jj200686.aspx).    |
|`PCL=<number>`|Значение вероятности фишинга для сообщения. Эти значения можно интерпретировать так же, как и значения SCL, которые задокументированы в [Вероятность нежелательной почты](https://technet.microsoft.com/library/jj200686.aspx).  |
|`DI=SB`|Отправитель сообщения заблокирован.|
|`DI=SQ`|Сообщение перемещено в карантин.|
|`DI=SD`|Сообщение удалено.|
|`DI=SJ`|Сообщение отправлено в папку нежелательной почты получателя.|
|`DI=SN`|Сообщение перенаправлено через пул высокого риска доставки. Более подробную информацию можно найти в разделе [пул доставки высокого риска для исходящих сообщений](https://technet.microsoft.com/library/jj200746.aspx).|
|`DI=SO`|Сообщение перенаправлено через пул обычной исходящей доставки.|
|`SFS=[a]|SFS=[b]`|Это означает выполнение правил нежелательной почты.|
|`IPV=CAL`|Сообщение пропущено через фильтр нежелательной почты, поскольку IP-адрес указан в списке разрешенных IP-адресов в фильтре подключений.|
|`H=<EHLOstring>`|Строка HELO или EHLO подключающегося почтового сервера.|
|`PTR=<ReverseDNS>`|Запись PTR отправляющего IP-адреса, называемая также обратным DNS-адресом.|

Пример значения **кустом_дата** для сообщения, которое фильтруется для нежелательной почты, как показано ниже.

`S:SFA=SUM|SFV=SPM|IPV=CAL|SRV=BULK|SFS=470454002|SFS=349001|SCL=9|SCORE=-1|LIST=0|DI=SN|RD=ftmail.inc.com|H=ftmail.inc.com|CIP=98.129.140.74|SFP=1501|ASF=1|CTRY=US|CLTCTRY=|LANG=en|LAT=287|LAT=260|LAT=18;`

#### <a name="malware-filter-agent"></a>Агент фильтрации вредоносных программ

Значение **кустом_дата** , начинающееся с `S:AMA` , находится в агенте фильтрации вредоносных программ. Ключевые сведения описаны в таблице ниже.

|**Значение**|**Описание**|
|:-----|:-----|
|`AMA=SUM|v=1|` или `AMA=EV|v=1`|Сообщение помечено как содержащее вредоносные программы. `SUM`Указывает, что вредоносная программа могла быть обнаружена любым числом ядер. `EV`Указывает на наличие вредоносных программ, обнаруженных определенным ядром. Если обработчиком обнаружены вредоносные программы, это вызывает последующие действия.|
|`Action=r`|Сообщение заменено.|
|`Action=p`|Сообщение не проходило фильтрацию.|
|`Action=d`|Сообщение отложено.|
|`Action=s`|Сообщение удалено.|
|`Action=st`|Сообщение не проходило фильтрацию.|
|`Action=sy`|Сообщение не проходило фильтрацию.|
|`Action=ni`|Сообщение отклонено.|
|`Action=ne`|Сообщение отклонено.|
|`Action=b`|Сообщение заблокировано.|
|`Name=<malware>`|Имя обнаруженной вредоносной программы.|
|`File=<filename>`|Имя файла, содержащего вредоносные программы.|

Пример значения **кустом_дата** для сообщения, содержащего вредоносную программу, выглядит следующим образом:

`S:AMA=SUM|v=1|action=b|error=|atch=1;S:AMA=EV|engine=M|v=1|sig=1.155.974.0|name=DOS/Test_File|file=filename;S:AMA=EV|engine=A|v=1|sig=201707282038|name=Test_File|file=filename`

#### <a name="transport-rule-agent"></a>Агент правил транспорта

Значение **кустом_дата** , начинающееся с`S:TRA` , находится в агенте правил транспорта для правил для почтового процесса (также называемых правилами транспорта). Ключевые сведения описаны в таблице ниже.

|**Значение**|**Описание**|
|:-----|:-----|
|`ETR|ruleId=<guid>`|Выполнено правило идентификатора.|
|`St=<datetime>`|Дата и время в формате UTC, когда произошло соответствующее правило.|
|`Action=<ActionDefinition>`|Примененное действие. Список доступных действий представлен [в статье действие правил обработки почты в Exchange Online](https://technet.microsoft.com/library/jj919237.aspx).|
|`Mode=<Mode>`|Режим правила. Допустимые значения: <br/>• **Принудительное**применение: все действия, выполняемые с правилом, будут применены. <br/>• **Тест с подсказками политик:**: все действия с подсказками политики будут отправлены, но другие действия по обеспечению безопасности не будут обрабатываться. <br/>• **Тест без советов политики**: действия будут перечислены в файле журнала, но отправители не будут получать никаких уведомлений, и принудительные действия не будут выполняться.|

Пример значения **кустом_дата** для сообщений, которые соответствуют условиям правила обработки почты, выглядит следующим образом:

`S:TRA=ETR|ruleId=19a25eb2-3e43-4896-ad9e-47b6c359779d|st=7/17/2017 12:31:25 AM|action=ApplyHtmlDisclaimer|sev=1|mode=Enforce`
