---
title: Обнаружение и устранение Outlook правил и пользовательских форм Injections атаки в Office 365
ms.author: chrfox
author: chrfox
manager: laurawi
ms.date: 04/23/2018
ms.audience: ITPro
ms.topic: article
ms.collection:
- o365_security_incident_response
- Strat_O365_IP
ms.service: o365-solutions
localization_priority: Normal
search.appverid:
- MET150
description: Узнайте, как выявлять и исправлять правила Outlook и атак injections настраиваемых форм в Office 365
ms.openlocfilehash: 1067d7c791217c146fedea839754e45f76ef5d8e
ms.sourcegitcommit: 7e2a0185cadea7f3a6afc5ddc445eac2e1ce22eb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/11/2019
ms.locfileid: "29603760"
---
# <a name="detect-and-remediate-outlook-rules-and-custom-forms-injections-attacks-in-office-365"></a>Обнаружение атак с внедрением правил и пользовательских форм Outlook и устранение их последствий в Office 365

**Сводка** Узнайте, как выявлять и исправлять правила Outlook и настраиваемых форм injections атак в Office 365.

## <a name="what-is-the-outlook-rules-and-custom-forms-injection-attack"></a>Что такое атак правила Outlook и настраиваемых форм?
После того как он нарушенным учетной записи в вашем клиенте и получает в, будут попробуйте и установить способ поддерживать или способ получить обратно после их обнаружения и удалены. Этот процесс называется установление механизм сохранения. Два способа, что они являются путем использования описанной правила Outlook или Добавление настраиваемых форм в Outlook. В обоих случаях правила или формы синхронизируется в облачной службе вниз до настольных компьютеров клиента, полный формат и повторно установить программное обеспечение не ликвидировать механизм ввод данных. Это, так как при повторном подключении клиентского программного обеспечения Outlook в почтовый ящик в облаке она будет повторно загрузить правила и формы из облака. После установки правила и формы на месте, он использует их выполнение удаленного или пользовательского кода, обычно для установки вредоносных программ на локальном компьютере. Вредоносная программа затем повторно захватывает учетных данных или других незаконных действия. Хорошо то, что если клиенты до последней версии, вы не подвержена угроз как текущие значения по умолчанию клиента Outlook заблокировать оба механизма. 

Как правило, атаки выполните эти шаблоны.

Использование правил
1. Он захватывает имя пользователя и пароль одного из пользователей.
2. Он затем входит в этот почтовый ящик пользователей Exchange. Почтовый ящик может быть в Exchange online или Exchange в локальной.
3. Он создает правило переадресации в почтовый ящик, который запускается, когда почтовый ящик получает сообщение электронной почты, которая соответствует условиям правила. Условия правила и содержимого сообщений электронной почты триггер — это специальный для друг с другом.
4. Он отправляет сообщение электронной почты триггер для пользователя, который обычно используется свой почтовый ящик.
5. Правило вызывается при получении сообщения электронной почты. Запуск приложения на удаленном сервере (WebDAV) обычно является то действие правила.
6. Приложение обычно устанавливает вредоносных программ, таких как [Powershell Empire](https://www.powershellempire.com/)локально на компьютере пользователя.
7. Вредоносная программа позволяет злоумышленнику повторно похитить имя пользователя и пароль или другие учетные данные с локального компьютера и выполнять другие вредоносные действия.

Использование форм
1. Он захватывает имя пользователя и пароль одного из пользователей.
2. Злоумышленник нажмите войти в этот почтовый ящик пользователей Exchange. Почтовый ящик может быть в Exchange online или Exchange в локальной.
3. Затем злоумышленник создает шаблона формы пользовательских почтовых и вставляет его в почтовом ящике пользователя.  Настраиваемая форма запускается, когда почтовый ящик получает сообщение электронной почты, который требует почтового ящика для загрузки пользовательской формы. Настраиваемая форма и формат сообщений электронной почты — это специальный для друг с другом.
4. Он отправляет сообщение электронной почты триггер для пользователя, который обычно использует свой почтовый ящик.
5. Если получено сообщение электронной почты, загрузки формы. Форма запускает приложение на удаленном сервере (WebDAV).
6. Приложение обычно устанавливает вредоносных программ, таких как [Powershell Empire](https://www.powershellempire.com/)локально на компьютере пользователя.
7. Вредоносная программа позволяет злоумышленнику повторно похитить имя пользователя и пароль или другие учетные данные с локального компьютера и выполнять другие вредоносные действия.


## <a name="what-a-rules-and-custom-forms-injection-attack-might-look-like-office-365"></a>Какие правила и настраиваемых форм атак может иметь вид Office 365?

Эти механизмы сохранения, скорее всего заметить пользователями и в некоторых случаях даже возможно невидимой им.  В этой статье приводятся сведения о ищите любое из семи знаков (индикаторы компромиссов) из списка ниже. Если любая из этих, необходимо выполнить действия по исправлению.

- Индикаторы раскрытия правил
    - Правила действие — запустить приложение.
    - Правило ссылается exe-ФАЙЛ, ZIP или URL-адрес.
    - На локальном компьютере найдите новые начинается процесс, полученные из Outlook PID.
- Индикаторы настраиваемые формы безопасности 
    - Настраиваемая форма присутствует сохраняются как собственные класс сообщения.
    - Класс сообщения содержит исполняемый код.
    - Обычно хранятся в папках Библиотека личных форм или папки «Входящие».
    - Форма называется IPM. Примечание. [псевдоним].

## <a name="steps-for-finding-signs-of-this-attack-and-confirming-it"></a>Действия для поиска следов атак и его подтверждение
Можно использовать один из этих методов для подтверждения атаки.
- Вручную проверьте правила и формы для каждого почтового ящика с помощью клиента Outlook.  Этот метод является полная, но можно указать только почтовый ящик пользователя во время, который может быть много времени при наличии нескольких пользователей для проверки.  Также это может привести в связи с нарушением условий компьютера, на котором выполняется проверка из.
- Используйте сценарий PowerShell [Get-AllTenantRulesAndForms.ps1](https://github.com/OfficeDev/O365-InvestigationTooling/blob/master/Get-AllTenantRulesAndForms.ps1) для автоматической записи всех пересылки правил и настраиваемых форм для всех пользователей в вашем клиенте сообщений. Это самый безопасный и быстрый метод с наименьшими объем нагрузки.


### <a name="confirm-the-rules-attack-using-the-outlook-client"></a>Подтверждение правил атаки с помощью клиента Outlook
1. Откройте клиент Outlook пользователи под учетной записью пользователя.  Пользователь может потребоваться помощь при проверке правил на их почтовом ящике.
2. Обратитесь к статье [Управление сообщения с помощью правил электронной почты](https://support.office.com/article/manage-email-messages-by-using-rules-c24f5dea-9465-4df4-ad17-a50704d66c59#ID0EAABAAA=2010) для процедур на открытие интерфейса правил в 2007, 2010 или 2013 версиях Outlook.
3. Найдите правила, которые пользователь не была создана, или любые непредвиденные правила или правил с именами подозрительные.
4. Найдите в поле Описание правила для действия правил, start и приложения или обратитесь к. EXE-ФАЙЛ. ZIP-файл, или для запуска на URL-адрес.
5. Внешнего вида для всех новых процессов, начать использовать идентификатор процесса Outlook.  Обратитесь к [найдите идентификатор процесса](https://docs.microsoft.com/windows-hardware/drivers/debugger/finding-the-process-id).

### <a name="steps-to-confirm-the-forms-attack-using-the-outlook-client"></a>Действия, чтобы подтвердить атаки форм, с помощью клиента Outlook
1. Откройте клиент Outlook пользователя, под учетной записью пользователя.
2. Следуйте указаниям, [Отображение вкладки "Разработчик"](https://support.office.com/article/show-the-developer-tab-e1192344-5e56-4d45-931b-e5fd9bea2d45) для пользователей версии Outlook.
3. Откройте вкладку теперь видимым для разработчиков в Outlook и щелкните **Конструктор форм**.
4. Выберите **папку "Входящие"** в **Поле Поиск в** списке. Внешнего вида для всех настраиваемых форм.  Настраиваемые формы, достаточно редко, что если имеется на всех настраиваемых форм, очень важно также более подробно.
5. Изучите настраиваемых форм, особенно тех, которые помечены как скрытые.
6. Откройте настраиваемых форм и в группе **формы** нажмите кнопку **Просмотреть код** , чтобы увидеть, что запускает при загрузке формы.

### <a name="steps-to-confirm-the-rules-and-forms-attack-using-powershell"></a>Действия, чтобы подтвердить атаки правил и форм, с помощью PowerShell
Самый простой способ проверка правил или настраиваемые формы атаки — выполнить сценарий PowerShell [Get-AllTenantRulesAndForms.ps1](https://github.com/OfficeDev/O365-InvestigationTooling/blob/master/Get-AllTenantRulesAndForms.ps1) .  Этот скрипт подключается к всех почтовых ящиков в вашего клиента и выводит все правила и форм в двух CSV-файлов.

#### <a name="pre-requisites"></a>Предварительные действия
Необходимо иметь права глобального администратора для запуска сценария, так как сценарий подключается к всех почтовых ящиков в аренде, чтобы ознакомиться с правилами и форм.

1. Войдите в компьютер, на котором будет запущен скрипт из с правами локального администратора.
2. Загрузите или скопируйте сценарий Get-AllTenantRulesAndForms.ps1 из репозиториев в папку, из которого будут выполняться его.  Сценарий создадим два файла Отметка даты для этой папки, MailboxFormsExport гггг мм dd.csv и MailboxRulesExport гггг мм dd.csv.
3. Откройте экземпляр PowerShell с правами администратора и откройте папку, которую вы сохранили скрипт, чтобы.
4. Запустите этот PowerShell командной строки, как указано ниже `.\Get-AllTenantRulesAndForms.ps1`.\Get-AllTenantRulesAndForms.ps1

#### <a name="interpreting-the-output"></a>Интерпретация выходных данных

MailboxRulesExport -*гггг мм дд*.csv – проверки правил (по одному для каждой строки) для действие условий, включая приложения или исполняемых файлов.
- Тип действия (столбец A) — Если отображается значение «ID_ACTION_CUSTOM» правило скорее всего, вредоносных.
- IsPotentiallyMalicious (столбец D) — Если это значение равно «TRUE», скорее всего правило вредоносных.
- ActionCommand (столбец G) — Если список приложения или любого файла с .exe, расширение ZIP или запись, на который ссылается на URL-адрес, не должен быть существует, скорее всего правило вредоносных.

MailboxFormsExport -*гггг мм дд*.csv – как правило, использование пользовательских форм встречаются очень редко.  Если какие-либо в этой книге, можно открыть почтовый ящик пользователя и просмотрите форму самого.  Если ваша организация были не поместить его существует намеренно, вероятнее всего вредоносных.



## <a name="how-to-stop-and-remediate-the-outlook-rules-and-forms-attack"></a>Как прекратить и устранение атак правила Outlook и форм
Если любой из этих атак признаков, исправлению простой, просто удалите правила или формы из почтового ящика. Это можно сделать с помощью клиента Outlook или с помощью удаленной оболочки PowerShell для удаления правил.

### <a name="using-outlook"></a>С помощью Outlook
1. Определение всех устройств, которые пользователь использовал с помощью Outlook.  Они все необходимо очистить потенциальных вредоносных программ.  Позволяет пользователю войти и использование электронной почты, пока не удаляются все устройства.
2. Выполните действия, описанные в [Удаление правила](https://support.office.com/article/Delete-a-rule-2F0E7139-F696-4422-8498-44846DB9067F) для каждого устройства.
3. Если вы не знаете о присутствии других вредоносных программ, можно отформатировать и повторно установить все программное обеспечение на устройстве.  Для мобильных устройств можно выполните действия производителям сброс устройства фабрики изображения.
4. Установка последних версий Outlook.  Имейте в виду, что текущая версия Outlook блокирует обоих типов атак по умолчанию.
5. После удаления всех автономные копии почтового ящика сбросить пароль пользователя (используйте высокое качество один) и выполните действия, описанные в [многофакторной проверки подлинности программы установки для пользователей Office 365](https://support.office.com/article/Set-up-multi-factor-authentication-for-Office-365-users-8f0454b2-f51a-4d9c-bcde-2c48e41621c6) , если многофакторной проверкой Подлинности еще не включен. Это гарантирует, что учетные данные пользователя не представленные в другие средства (например, повторное использование фишинга или пароль).

### <a name="using-powershell"></a>С помощью PowerShell
Существует два удаленных командлеты PowerShell, которые можно использовать для удаления или отключения опасные правил. Следуя инструкциям.
 
Действия для почтовых ящиков, которые находятся на сервере Exchange

1. Подключение к серверу Exchange с помощью удаленной оболочки PowerShell. Выполните действия, описанные в [подключиться к серверам Exchange с помощью удаленной оболочки PowerShell](https://docs.microsoft.com/powershell/exchange/exchange-server/connect-to-exchange-servers-using-remote-powershell?view=exchange-ps).
2. Чтобы полностью удалить одно правило, несколько правил или всех правил от почтовых ящиков используйте [командлет Remove-папка "Входящие" ](https://docs.microsoft.com/powershell/module/exchange/mailboxes/Remove-InboxRule?view=exchange-ps)- используйте Чтобы полностью удалить один, несколько или все правила из почтового ящика.
3. Если необходимо сохранить правило и его содержимого для дальнейшего изучения используйте [командлет Disable-InboxRule](https://technet.microsoft.com/en-us/library/dd298120(v=exchg.160).aspx). 

Действия для почтовых ящиков в Exchange Online
1. Следуйте указаниям в разделе [подключение к Exchange Online с помощью PowerShell](https://docs.microsoft.com/powershell/exchange/exchange-online/connect-to-exchange-online-powershell/connect-to-exchange-online-powershell?view=exchange-ps).
2.  Если необходимо полностью удалить одно правило, несколько правил, или все правила из почтового ящика используйте [командлет Remove-папка «Входящие»](https://docs.microsoft.com/powershell/module/exchange/mailboxes/Remove-InboxRule?view=exchange-ps).
3.  Если необходимо сохранить правило и его содержимого для дальнейшего изучения используйте [командлет Disable-InboxRule](https://technet.microsoft.com/en-us/library/dd298120(v=exchg.160).aspx). 

## <a name="how-to-minimize-future-attacks"></a>Минимизация атак в будущем

### <a name="first-protect-your-accounts"></a>Первый: защита учетные записи

Уязвимостей правил и форм используются только злоумышленником после их кражи или нарушенным одна из учетных записей пользователя. Таким образом в первую очередь, чтобы предотвратить применение этих атаки вашей организации — агрессивное защита учетные записи пользователей.  Некоторые наиболее распространенные способы, что учетные записи являются механизмами, через фишинга или [пароль spraying](http://www.dabcc.com/microsoft-defending-against-password-spray-attacks/) атаки.



Чтобы защитить учетные записи пользователей и особенно учетные записи администратора, рекомендуется [настроить многофакторной проверки подлинности для пользователей Office 365](https://support.office.com/article/set-up-multi-factor-authentication-for-office-365-users-8f0454b2-f51a-4d9c-bcde-2c48e41621c6).  Можно также выполнить следующие действия:
<ol>
    <li>Мониторинг, как учетные записи пользователей, <a href="https://docs.microsoft.com/azure/active-directory/active-directory-view-access-usage-reports">доступ и использование</a>. Не может запретить начального нарушения, но сократит во время выполнения и влияние нарушения обнаруживает быстрее. Можно использовать эти: <a href="https://support.office.com/article/overview-of-office-365-cloud-app-security-81f0ee9a-9645-45ab-ba56-de9cbccab475">политик безопасности Office 365 облаке приложения</a> для наблюдения за, учетных записей и предупреждения при необычных мероприятий.<ol type="a">
            <li><b>Нескольких неудачных попыток входа</b> Эта политика профили среды и триггеров оповещения при выполнении пользователем несколько действий входа в систему в одном сеансе по отношению к известных базового плана, который может указывать попытка связи с нарушением условий.</li>
            <li><b>Командировочные невозможно</b> - Эта политика профилей среды и отправляет оповещения при обнаружении действия из того же пользователя в другие расположения в течение периода времени, который меньше, чем время ожидается поездки из одного места. Это может указывать, что другого пользователя используется один набор учетных данных. Обнаружение это непредвиденных требуется открытое от начального обучения период семь дней, во время которых подразделения шаблона активности нового пользователя.</li>
            <li><b>Неправильное олицетворяется активности (пользователем)</b> - Эта политика профилей среды и отправляет оповещения при выполнении пользователем несколько олицетворенным действий в одном сеансе относительно базового узнали, указывающие попытка связи с нарушением условий.</li>
        </ol>
    </li>
    <li>Используйте средство как <a href="https://securescore.office.com/">Показатель безопасного Office 365</a> для управления конфигурации учетной записи системы безопасности и модели поведения. 
    </li>
</ol> 

### <a name="second-keep-your-outlook-clients-current"></a>Второй: Модернизации клиентов Outlook
Полностью переработана и программного обеспечения, установленного версий Outlook 2013 и 2016 отключить «Запуск приложения» действие правила/формы по умолчанию.  Это гарантирует, что даже в том случае, если он breaches учетную запись, будут блокироваться действия правила и формы.  Последние обновления и исправления безопасности можно установить, выполнив действия, описанные в [обновлений установки Office](https://support.office.com/article/Install-Office-updates-2ab296f3-7f03-43a2-8e50-46de917611c5).

Ниже приведены версии исправлений для Outlook 2013 и 2016 клиентов.
- Outlook 2013: 15.0.4937.1000 или выше
- Outlook 2016: 16.0.4534.1001 или выше

Дополнительные сведения об отдельных исправлений см.

- [Обновление безопасности для Outlook 2013](https://support.microsoft.com/en-us/help/3191938) 
- [Обновления для системы безопасности Outlook 2016](https://support.microsoft.com/en-us/help/3191883)

### <a name="third-monitor-your-outlook-clients"></a>Третий: Мониторинга клиентов Outlook
Обратите внимание, что с помощью исправления и обновления, злоумышленник изменений конфигурации локального компьютера, чтобы повторно включить поведение «Запуск приложения». [Расширенное управление групповыми политиками](https://docs.microsoft.com/microsoft-desktop-optimization-pack/agpm/) можно использовать для мониторинга и принудительное применение политики локального компьютера на клиентах.  
Можно увидеть, если «Запуск приложения» повторно включен через переопределение в реестре с использованием данных в [Просмотр системного реестра с помощью 64-разрядных версиях Windows](https://support.microsoft.com/en-us/help/305097/how-to-view-the-system-registry-by-using-64-bit-versions-of-windows).  Проверьте следующие разделы: 

- Outlook 2016: HKEY_CURRENT_USER\Software\Microsoft\Office\16.0\Outlook\Security\
- Outlook 2013: HKEY_CURRENT_USER\Software\Microsoft\Office\15.0\Outlook\Security\

Найдите ключ EnableUnsafeClientMailRules. Если он существует и имеет значение 1, переопределил исправления безопасности для Outlook, и компьютер уязвим для атаки формы/правил. Если значение равно 0, отключено «Запуск приложения» действие.  Если установлен программного обеспечения и обновленные версии Outlook, этот параметр реестра не задан, система не уязвимые для этих атак.

Клиенты с локальных установок Exchange должны рассмотрите возможность блокировки старых версиях Outlook, у которых нет пакетов обновлений. Сведения об этом процессе можно найти в статье [клиента настроить Outlook на блокировку](https://technet.microsoft.com/en-us/library/dd335207(v=exchg.150).aspx).

## <a name="secure-office-365-like-a-cybersecurity-pro"></a>Безопасность Office 365 как cybersecurity pro
Подписки Office 365, поступающие с набором мощные возможности безопасности, которые можно использовать для защиты данных и вашим пользователям.  Использование [план обеспечения безопасности Office 365: наиболее распространенные приоритеты для первого 30 дней, 90 дней и за ее пределами](https://support.office.com/article/Office-365-security-roadmap-Top-priorities-for-the-first-30-days-90-days-and-beyond-28c86a1c-e4dd-4aad-a2a6-c768a21cb352) для реализации Майкрософт, рекомендации по обеспечению безопасности клиента Office 365.
- Задачи, для выполнения в течение 30 дней.  Эти интерпретации влияют и низкой воздействия на компьютерах пользователей.
- Задачи, для выполнения в течение 90 дней. Они имеют немного больше времени для планирования и реализации, но значительно повышения уровня безопасности.
- Помимо 90 дней. Эти усовершенствования построения в первом работу 90 дней.

## <a name="see-also"></a>Также можно найти:
- [Сообщение о нежелательном правила Outlook](https://silentbreaksecurity.com/malicious-outlook-rules/) по безопасности Post SilentBreak о правилах вектор предоставляет подробный обзор того, как правила Outlook. 
- [Протокол MAPI over HTTP и Mailrule Pwnage](https://sensepost.com/blog/2016/mapi-over-http-and-mailrule-pwnage/) в блоге Sensepost о Mailrule Pwnage рассматривается средство под названием линейке, который позволяет воспользоваться почтовых ящиков с помощью правил Outlook.
- [Формы outlook и оболочек](https://sensepost.com/blog/2017/outlook-forms-and-shells/) в блоге Sensepost о вектор Threat форм. 
- [Линейки базы кода](https://github.com/sensepost/ruler)
- [Индикаторы линейки раскрытия](https://github.com/sensepost/notruler/blob/master/iocs.md)