---
title: Заголовки сообщений по защите от нежелательной почты
ms.author: krowley
author: kccross
manager: laurawi
ms.date: 2/9/2018
ms.audience: ITPro
ms.topic: article
ms.service: O365-seccomp
ms.custom: TN2DMC
localization_priority: Normal
search.appverid:
- MET150
ms.assetid: 2e3fcfc5-5604-4b88-ac0a-c5c45c03f1db
description: Когда служба Exchange Online Protection сканирует входящие электронные сообщения, она вставляет заголовок **X-Forefront-Antispam-Report** в каждое из них.
ms.openlocfilehash: 192a1d3e3331256819ddd68fbe0aa0c1fa16c9a7
ms.sourcegitcommit: e9dca2d6a7838f98bb7eca127fdda2372cda402c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/21/2018
ms.locfileid: "23003148"
---
# <a name="anti-spam-message-headers"></a>Заголовки сообщений по защите от нежелательной почты

Когда служба Exchange Online Protection сканирует входящие электронные сообщения, она вставляет заголовок **X-Forefront-Antispam-Report** в каждое из них. Поля в этом заголовке могут предоставить администраторам информацию о сообщении и его обработке. Поля заголовка **X-Microsoft-Antispam** предоставляют дополнительные сведения о массовой рассылке и фишинге. В дополнение к этим двум заголовкам служба Exchange Online Protection также вставляет в каждое сообщение, которое она обрабатывает, заголовок **Authentication-results** с результатами проверки подлинности сообщения. 
  
> [!TIP]
> Сведения о том, как просматривать заголовки электронных сообщений в различных почтовых клиентах, см. в статье [Приложение Message Header Analyzer](https://go.microsoft.com/fwlink/p/?LinkId=306583). Вы можете скопировать и вставить содержимое заголовка сообщения в средство [Message Header Analyzer](https://testconnectivity.microsoft.com/?tabid=mha). Если выбрать сообщение в карантине в Центре администрирования Exchange, ссылка **Просмотр заголовка сообщения** позволит легко скопировать и вставить текст заголовка сообщения в это средство. Открыв Message Header Analyzer, нажмите кнопку **Analyze headers** (Анализировать заголовки), чтобы получить сведения о заголовке. 
  
## <a name="x-forefront-antispam-report-message-header-fields"></a>Поля заголовка сообщения X-Forefront-Antispam-Report
<a name="sectionSection0"> </a>

Получив доступ к сведениям о заголовках сообщения, найдите заголовок **X-Forefront-Antispam-Report** и поищите в нем поля, указанные ниже. Другие поля в этом заголовке нужны для диагностики и используются исключительно группой специалистов Майкрософт, ответственной за защиту от нежелательной почты. 
  
|||
|:-----|:-----|
|**Поле заголовка** <br/> |**Описание** <br/> |
|CIP: [IP-адрес]  <br/> |IP-адрес для подключения. Этот IP-адрес может вам понадобиться в процессе формирования списков разрешенных и заблокированных IP-адресов в фильтре подключений. Дополнительные сведения см. в разделе [Настройка политики фильтров подключений](configure-the-connection-filter-policy.md).  <br/> |
|CTRY  <br/> |Страна, из которой произошло подключение сообщения к службе. Это определяется по подключенному IP-адресу, который может отличаться от IP-адреса источника отправки.  <br/> |
|LANG  <br/> |Язык, на котором написано сообщение, как это указано в коде страны (например, ru_RU для русского).  <br/> |
|SCL  <br/> |Значение вероятности нежелательной почты сообщения. Дополнительные сведения об интерпретации этих значений см. в статье [Вероятность нежелательной почты](spam-confidence-levels.md).  <br/> |
|PCL  <br/> |Значение вероятности фишинга для сообщения. Дополнительные сведения об этом значении приведены [здесь](anti-spam-message-headers.md#PCL).  <br/> |
|SRV:BULK  <br/> |Это сообщение идентифицировано как сообщение массовой рассылки. Если включен параметр расширенной фильтрации спама **Блокировать все сообщения массовой рассылки**, оно будет помечено как спам. Если он не включен, сообщение будет помечено как спам, если на это указывают остальные правила фильтрации.  <br/> |
|SFV:SFE  <br/> |Сообщение пропущено с обходом фильтрации, поскольку его отправили с адреса, который входит в список надежных отправителей отдельного пользователя.  <br/> |
|SFV:BLK  <br/> |Сообщение заблокировано с обходом фильтрации, поскольку его отправили с адреса, который входит в список заблокированных отправителей отдельного пользователя.  <br/> **Совет.** Дополнительные сведения о том, как пользователи могут создавать списки надежных и заблокированных отправителей, см. в статьях [Блокирование и разрешение (параметры нежелательной почты)](https://go.microsoft.com/fwlink/p/?LinkId=294862) (OWA) и [Общие сведения о фильтре нежелательной почты](https://go.microsoft.com/fwlink/p/?LinkId=270065) (Outlook).    <br/> |
|IPV:CAL  <br/> |Сообщение пропущено через фильтр нежелательной почты, поскольку IP-адрес указан в списке разрешенных IP-адресов в фильтре подключений.  <br/> |
|IPV:NLI  <br/> |IP-адрес отсутствовал в списке репутации IP-адресов.  <br/> |
|SFV:SPM  <br/> |Сообщение помечено фильтром содержимого как нежелательное.  <br/> |
|SFV:SKS  <br/> |Сообщение помечено как нежелательное до обработки фильтром содержимого. Это применяется к сообщениям, в которых сообщение сопоставлено с правилом транспорта автоматически помечать его как нежелательное и обходить любую дополнительную фильтрацию.  <br/> |
|SFV:SKA  <br/> |Сообщение не обрабатывалось фильтром и было доставлено в папку "Входящие", так как оно соответствует параметрам списка разрешений в политике фильтрации нежелательной почты, например списка **Разрешенные отправители**.  <br/> |
|SFV:SKB  <br/> |Сообщение помечено как спам, так как оно соотнесено со списком блокировок в политике фильтрации нежелательной почты (например, обнаружены совпадения со значениями параметра **Список блокировок отправителя**).  <br/> |
|SFV:SKN  <br/> |Сообщение помечено как желательное до обработки фильтром содержимого. Возможная причина: это сообщение сопоставлено с правилом транспорта, автоматически пометившим его как желательное, чтобы оно обошло любую дополнительную фильтрацию.  <br/> |
|SFV:SKI  <br/> |Подобно SFV:SKN, фильтрация сообщения пропущена по иной причине, например оно отправляется внутри организации клиента.  <br/> |
|SFV:SKQ  <br/> |Сообщение было извлечено из почтового ящика карантина и отправлено указанным получателям.  <br/> |
|SFV:NSPM  <br/> |Сообщение помечено как не являющееся нежелательным и отправлено указанным получателям.  <br/> |
|H: [helostring]  <br/> |Строка HELO или EHLO подключающегося почтового сервера.  <br/> |
|PTR: [ReverseDNS]  <br/> |Запись типа PTR (запись-указатель) для IP-адреса отправителя, называемого также обратным DNS-адресом.  <br/> |
|SFTY  <br/> | Сообщение был распознан как фишинга и также помечается с одним из следующих значений:  <br/>  9.1 — значение по умолчанию. Сообщение содержит URL-адрес фишинга, фишинг других или может помечены как фишинга с другого фильтра почты, например в локальной версии Exchange Server перед ретрансляцию сообщений в Office 365.  <br/>  9.11 - сообщение не удалось спуфинг anti проверок где отправляющий домен в поле от: заголовков аналогично, или коммерческим или является частью одной организации как получение домена.  <br/>  9.21 - сообщение не удалось спуфинг anti проверки и отправляющий домен в поле от: заголовок не выполнять проверку подлинности. Используется в сочетании с CompAuth (Просмотр результатов проверки подлинности).  <br/>  9.22 - то же, что 9.21, за исключением того, что у пользователя есть надежных отправителей, который был переопределен.  <br/>  9.23 - то же, что 9.22, за исключением того, что в организации уже разрешенных отправителя или домен, который был переопределен.  <br/>  9,24 - то же, что 9.23, за исключением того, что у пользователя есть поток почты Exchange правила, который был переопределен.  <br/> |
|X-CustomSpam: [ASFOption]  <br/> |Сообщение соответствовало правилу расширенной фильтрации параметр нежелательной почты. Например **X-CustomSpam: ссылки на удаленных сайтов "изображение"** обозначает, что соответствует параметр ASF **ссылки на рисунки удаленных сайтов** . Чтобы узнать, какой текст заголовка X добавляется для каждого конкретного варианта ASF, обратитесь к разделу [параметры фильтрации расширенной нежелательной почты](advanced-spam-filtering-asf-options.md).<br/> |
   
## <a name="x-microsoft-antispam-message-header-fields"></a>Поля заголовка сообщения X-Microsoft-Antispam
<a name="sectionSection1"> </a>

В таблице ниже описаны нужные поля в заголовке сообщения **X-Microsoft-Antispam**. Другие поля в этом заголовке нужны для диагностики и используются исключительно группой специалистов Майкрософт, ответственной за защиту от нежелательной почты. 
  
|||
|:-----|:-----|
|**Поле заголовка** <br/> |**Описание** <br/> |
|BCL  <br/> |Количество жалоб на массовую рассылку (BCL) сообщения. Дополнительные сведения см. в разделе [Уровни жалоб на массовые сообщения](bulk-complaint-level-values.md).  <br/> |
|PCL  <br/> | Уровень вероятности фишинга сообщения, показывающий, является ли сообщение мошенническим.  <br/>  Это состояние может принимать одно из следующих числовых значений:  <br/> **0-3**. Маловероятно, что содержимое этого сообщения связано с фишингом.    <br/> **4-8**. Скорее всего, содержимое этого сообщения связано с фишингом.    <br/> **-9990** (только для Exchange Online Protection). Содержимое этого сообщения, скорее всего, связано с фишингом.    <br/>  Эти значения позволяют определить действие, которое почтовый клиент выполняет для сообщений. Например, Microsoft Office Outlook использует метку вероятности фишинга для блокирования содержимого подозрительных сообщений. Дополнительные сведения о фишинге и обработке фишинговых сообщений в Outlook см. в статье [Включение и отключение ссылок в электронных сообщениях](https://support.office.com/article/2D79B907-93B6-4774-82E6-1F0385CF20F8).  <br/> |
   
## <a name="authentication-results-message-header"></a>Заголовок сообщения Authentication-results
<a name="sectionSection2"> </a>

Когда на почтовый сервер приходит сообщение, оно проверяется с помощью инфраструктуры политики отправителей, DKIM и DMARC. Результаты этой проверки служба Office 365 записывает в заголовке сообщения **Authentication-results** (добавляет к нему метку). 
  
### <a name="check-stamp-syntax-and-examples"></a>Ознакомьтесь с примерами и синтаксисом добавления меток
<a name="referenceSPFstamp"> </a>

В приведенных ниже примерах синтаксиса показана текстовая метка, которую Office 365 добавляет к заголовку каждого сообщения, проходящего проверку подлинности при доставке на почтовый сервер. Такая метка добавляется в заголовок **Authentication-Results**. 
  
 **Синтаксис: метка при проверке с помощью инфраструктуры политики отправителей**
  
В случае инфраструктуры политики отправителей применяется указанный ниже синтаксис.
  
```
spf=<pass (IP address)|fail (IP address)|softfail (reason)|neutral|none|temperror|permerror> smtp.mailfrom=<domain>
```

 **Примеры: метка при проверке с помощью инфраструктуры политики отправителей**
  
```
spf=pass (sender IP is 192.168.0.1) smtp.mailfrom=contoso.com
spf=fail (sender IP is 127.0.0.1) smtp.mailfrom=contoso.com

```

 **Синтаксис: метка при проверке с помощью DKIM**
  
В случае DKIM применяется указанный ниже синтаксис.
  
```
dkim=<pass|fail (reason)|none> header.d=<domain>
```

 **Примеры: метка при проверке с помощью DKIM**
  
```
dkim=pass (signature was verified) header.d=contoso.com
dkim=fail (body hash did not verify) header.d=contoso.com
```

 **Синтаксис: метка при проверке с помощью DMARC**
  
В случае DMARC применяется указанный ниже синтаксис.
  
```
dmarc=<pass|fail|bestguesspass|none> action=<permerror|temperror|oreject|pct.quarantine|pct.reject> header.from=<domain>
```

 **Примеры: метка при проверке с помощью DMARC**
  
```
dmarc=pass action=none header.from=contoso.com
dmarc=bestguesspass action=none header.from=contoso.com
dmarc=fail action=none header.from=contoso.com
dmarc=fail action=oreject header.from=contoso.com
```

### <a name="authentication-results-message-header-fields-used-by-office-365-email-authentication"></a>Поля заголовка Authentication-results, которые используются Office 365 при проверке подлинности почты
<a name="referenceSPFstamp"> </a>

В этой таблице описаны поля и возможные значения для каждой проверки подлинности сообщений.
  
|**Поле заголовка**|**Описание**|
|:-----|:-----|
|spf  <br/> | Описывает результаты проверки сообщения с использованием инфраструктуры политики отправителей. Возможные значения:  <br/> **pass (<IP-адрес>)**. Указывает, что выполнена проверка сообщения с помощью инфраструктуры политики отправителей, и показывает IP-адрес отправителя. Клиент уполномочен отправлять или ретранслировать сообщение от имени домена отправителя.<br/> **fail (<IP-адрес>)**. Указывает, что не удалось выполнить проверку сообщения с использованием инфраструктуры политики отправителей, и показывает IP-адрес отправителя. Это еще иногда называется серьезным сбоем.<br/> **softfail (<причина>)**. Указывает, что запись инфраструктуры политики отправителей определила узел как такой, отправка сообщений для которого не разрешена, но находится в процессе.  <br/> **neutral**. Указывает, что запись инфраструктуры политики отправителей не может точно определить, авторизован ли IP-адрес.    <br/> **none**. Указывает, что для домена не задана запись инфраструктуры политики отправителей (или что эта запись не приводит к результату).    <br/> **temperror**. Указывает, что произошла ошибка, которая может быть временной (например, ошибка DNS). Повторите попытку позже. Вмешательство администратора, возможно, не понадобится.  <br/> **permerror**. Указывает на то, что произошла постоянная ошибка. Причиной может быть ошибочно созданная запись инфраструктуры политики отправителей для домена.  <br/> |
|SMTP.MailFrom  <br/> |Содержит название исходного домена, с которого было отправлено сообщение. Сведения об ошибках, связанных с этим сообщением, будут отправлены администратору почты или другому лицу, ответственному за домен. Такое поле еще иногда зовется адресом 5321.MailFrom или адресом reverse-path в конверте сообщения.  <br/> |
|dkim  <br/> | Описывает результаты проверки сообщения с использованием DKIM. Возможные значения:  <br/> **pass**. Указывает на то, что проверка сообщения с помощью DKIM пройдена успешно.    <br/> **fail (<причина>)**. Указывает, что не удалось проверить сообщение с помощью DKIM, а также причину этого. Например, когда сообщение не подписано или подпись не проверена.<br/> **none**. Указывает на то, что сообщение не подписано. Это может быть связано с тем, что для домена задана запись DKIM, которая не приводит к результату.  <br/> |
|Header.d  <br/> |Определяет домен, указанный в подписи DKIM, если такая есть. Это домен, у которого запрашивается открытый ключ.  <br/> |
|dmarc  <br/> | Описывает результаты проверки сообщения с использованием DMARC. Возможные значения:  <br/> **pass** указывает на то, что проверка DMARC пройдена успешно.  <br/> **fail** указывает на то, что проверка DMARC не пройдена.  <br/> **bestguesspass** указывает на то, что для домена отсутствует запись DMARC TXT, однако, если бы такая запись существовала, проверка DMARC была бы пройдена успешно. Это произошло бы потому, что домен в адресе 5321.MailFrom совпадает с доменом в адресе 5322.From.  <br/> **none** указывает на то, что для отправляющего домена в DNS отсутствует запись DKIM TXT.  <br/> |
|action  <br/> | Указывает действие, выполняемое фильтром спама на основании результатов проверки с помощью DMARC. Например:  <br/> **permerror**. Указывает на то, что во время проверки с помощью DMARC произошла постоянная ошибка, такая как обнаружение неправильно созданной записи DMARC типа TXT в DNS. Попытка отправить такое сообщение повторно вряд ли завершится другим результатом. Вместо этого может потребоваться обратиться к владельцу домена с просьбой устранить проблему.  <br/> **temperror**. Указывает на то, что во время проверки с помощью DMARC произошла временная ошибка. Можно обратиться к отправителю с просьбой отправить сообщение повторно немного позже, чтобы почта была обработана должным образом.  <br/> **oreject** или **o.reject**. Указывает на то, что было выполнено переопределение отклонения. В этом случае Office 365 применяет это действие при получении сообщений, не прошедших проверки DMARC, из доменов, в записях DMARC типа TXT которых задана политика отклонения (p=reject). Вместо удаления или отклонения такого сообщения служба Office 365 помечает его как спам. Дополнительные сведения о том, почему Office 365 поступает именно так, см. в разделе [Как Office 365 обрабатывает входящую почту, не прошедшую проверки DMARC](use-dmarc-to-validate-email.md#inbounddmarcfail).  <br/> **pct.quarantine**. Указывает на то, что менее 100 % сообщений, не прошедших проверку DMARC, все равно будут доставлены. Это означает, что сообщение не прошло проверку DMARC и согласно политике должно быть отправлено в карантин, но для поля "pct" не задано значение 100 %, и система случайно определила, что действие DMARC применять не следует.  <br/> **pct.reject**. Указывает на то, что менее 100 % сообщений, не прошедших проверку DMARC, все равно будут доставлены. Это означает, что сообщение не прошло проверку DMARC и согласно политике должно быть отклонено, но для поля "pct" не задано значение 100 %, и система случайно определила, что действие DMARC применять не следует.  <br/> |
|Header.FROM  <br/> |Определяет домен, который указан в адресе отправителя в заголовке сообщения. Это поле иногда зовется адресом 5322.From.  <br/> |
|compauth  <br/> |Результат составного проверки подлинности. Используется с Office 365 для объединения нескольких типов проверки подлинности, такие как SPF, ПРОВЕРКУ, DMARC или любой другой части сообщение, чтобы определить, является ли проверка подлинности сообщения. Использует From: домен в качестве основы для оценки.  <br/> |
|Причина  <br/> | Причина составного проверки подлинности передается или завершен с ошибкой. Значение по причине состоит из трех цифр.  <br/>  000 - сообщение явно не прошел проверку подлинности. Например сообщение получено сбой DMARC с действием из карантина или отклонить.  <br/>  001 - сообщение неявно произошел сбой проверки подлинности, и отправляющий домен не был опубликован политики проверки подлинности. Например, политику DMARC p = нет.  <br/>  1xx — сообщения передаются проверки подлинности. Во-вторых две цифры, внутренние коды, используемые Office 365.  <br/>  2xx — проверка подлинности передается обратимо сообщений. Во-вторых две цифры, внутренние коды, используемые Office 365.  <br/>  для проверки подлинности на составные не проверяется 3xx - сообщение.  <br/>  4xx - сообщение обход сервера-посредника составного проверки подлинности. Во-вторых две цифры, внутренние коды, используемые Office 365.  <br/> |
  