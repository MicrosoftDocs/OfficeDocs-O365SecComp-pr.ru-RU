---
title: Заголовки сообщений по защите от нежелательной почты
ms.author: tracyp
author: MSFTTracyP
manager: dansimp
audience: ITPro
ms.topic: article
ms.service: O365-seccomp
localization_priority: Priority
search.appverid:
- MET150
ms.assetid: 2e3fcfc5-5604-4b88-ac0a-c5c45c03f1db
ms.collection:
- M365-security-compliance
description: Когда служба Exchange Online Protection сканирует входящие электронные сообщения, она вставляет заголовок **X-Forefront-Antispam-Report** в каждое из них.
ms.openlocfilehash: 973339a852bddb06fd7dfba4166e9e0917082725
ms.sourcegitcommit: 73f1db241c0686020167d43442e7b07a2199ea3a
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/28/2019
ms.locfileid: "36658105"
---
# <a name="anti-spam-message-headers"></a>Заголовки сообщений по защите от нежелательной почты

Когда служба Exchange Online Protection сканирует входящие электронные сообщения, она вставляет заголовок **X-Forefront-Antispam-Report** в каждое из них. Поля в этом заголовке могут предоставить администраторам информацию о сообщении и его обработке. Поля заголовка **X-Microsoft-Antispam** предоставляют дополнительные сведения о массовой рассылке и фишинге. В дополнение к этим двум заголовкам служба Exchange Online Protection также вставляет в каждое сообщение, которое она обрабатывает, заголовок **Authentication-results** с результатами проверки подлинности сообщения.

Сведения о том, как просматривать заголовки электронных сообщений в различных почтовых клиентах, см. в статье [Приложение Message Header Analyzer](https://go.microsoft.com/fwlink/p/?LinkId=306583). 
  
> [!TIP]
>  Вы можете скопировать и вставить содержимое заголовка сообщения в средство [Анализатор сообщений](https://testconnectivity.microsoft.com/?tabid=mha). Это средство помогает анализировать заголовки и преобразовывать их в более удобный для чтения формат.
  
## <a name="x-forefront-antispam-report-message-header-fields"></a>Поля заголовка сообщения X-Forefront-Antispam-Report

Получив доступ к сведениям о заголовках сообщения, найдите заголовок **X-Forefront-Antispam-Report** и поищите в нем поля, указанные ниже. Другие поля в этом заголовке нужны для диагностики и используются исключительно группой специалистов Майкрософт, ответственной за защиту от нежелательной почты.

|**Поле заголовка**|**Описание**|
|:-----|:-----|
|CIP: [IP-адрес]|IP-адрес для подключения. Этот IP-адрес может вам понадобиться в процессе формирования списков разрешенных и заблокированных IP-адресов в фильтре подключений. Дополнительные сведения см. в разделе [Настройка политики фильтров подключений](configure-the-connection-filter-policy.md).  |
|CTRY|Страна, из которой произошло подключение сообщения к службе. Это определяется по подключенному IP-адресу, который может отличаться от IP-адреса источника отправки.|
|LANG|Язык, на котором написано сообщение, как это указано в коде страны (например, ru_RU для русского).|
|SCL|Значение вероятности нежелательной почты сообщения. Дополнительные сведения об интерпретации этих значений см. в статье [Вероятность нежелательной почты](spam-confidence-levels.md).  |
|PCL|Значение вероятности фишинга для сообщения.|
|SRV:BULK|Это сообщение идентифицировано как сообщение массовой рассылки. Если включен параметр расширенной фильтрации спама **Блокировать все сообщения массовой рассылки**, оно будет помечено как спам. Если он не включен, сообщение будет помечено как спам, если на это указывают остальные правила фильтрации.|
|SFV:SFE|Сообщение пропущено с обходом фильтрации, поскольку его отправили с адреса, который входит в список надежных отправителей отдельного пользователя.|
|SFV:BLK|Сообщение заблокировано с обходом фильтрации, поскольку его отправили с адреса, который входит в список заблокированных отправителей отдельного пользователя.  <br/> **Совет.** Дополнительные сведения о том, как пользователи могут создавать списки надежных и заблокированных отправителей, см. в статьях [Блокирование и разрешение (параметры нежелательной почты)](https://go.microsoft.com/fwlink/p/?LinkId=294862) (Outlook в Интернете) и [Общие сведения о фильтре нежелательной почты](https://go.microsoft.com/fwlink/p/?LinkId=270065) (Outlook).|
|IPV:CAL|Сообщение пропущено через фильтр нежелательной почты, поскольку IP-адрес указан в списке разрешенных IP-адресов в фильтре подключений.|
|IPV:NLI|IP-адрес отсутствовал в списке репутации IP-адресов.|
|SFV:SPM|Сообщение помечено фильтром содержимого как нежелательное.|
|SFV:SKS|Сообщение помечено как нежелательное до обработки фильтром содержимого. Это применяется к сообщениям, сопоставленным с правилом потока обработки почты (другое название — правило транспорта), требующим автоматически помечать их как нежелательные и обходить любую дополнительную фильтрацию.|
|SFV:SKA|Сообщение не обрабатывалось фильтром и было доставлено в папку "Входящие", так как оно соответствует параметрам списка разрешений в политике фильтрации нежелательной почты, например списка **Разрешенные отправители**.|
|SFV:SKB|Сообщение помечено как спам, так как оно соотнесено со списком блокировок в политике фильтрации нежелательной почты (например, обнаружены совпадения со значениями параметра **Список блокировок отправителя**).|
|SFV:SKN|Сообщение помечено как желательное до обработки фильтром содержимого. Это применяется к сообщениям, сопоставленным с правилом потока обработки почты, требующим автоматически помечать их как желательные и обходить любую дополнительную фильтрацию.|
|SFV:SKI|Подобно SFV:SKN, фильтрация сообщения пропущена по иной причине, например оно отправляется внутри организации клиента.|
|SFV:SKQ|Сообщение было извлечено из почтового ящика карантина и отправлено указанным получателям.|
|SFV:NSPM|Сообщение помечено как не являющееся нежелательным и отправлено указанным получателям.|
|H: [helostring]|Строка HELO или EHLO подключающегося почтового сервера.|
|PTR: [ReverseDNS]|Запись типа PTR (запись-указатель) для IP-адреса отправителя, называемого также обратным DNS-адресом.|
|CAT:|Категория политики защиты, применяемая для сообщения: <br/>MALW. Вредоносная программа <br/>PHSH. Фишинг <br/>HSPM. Нежелательное сообщение с высокой степенью уверенности <br/>SPOOF. Спуфинг <br/>SPM. Нежелательное сообщение <br/>BULK. Массовая рассылка <br/>DIMP. Подмена домена <br/>UIMP. Подмена пользователя <br/>Входящее сообщение может помечаться несколькими формами защиты и несколькими сканерами обнаружения. Политики имеют разные приоритеты, и применяется политика с наивысшим приоритетом. См. статью [Какая политика применяется, когда для электронной почты запускается несколько методов защиты и сканеров обнаружения](https://docs.microsoft.com/office365/securitycompliance/how-policies-and-protections-are-combined).|
|SFTY|Сообщение определено как фишинговое и помечается с помощью одного из следующих значений: <br/>9.1. Значение по умолчанию. Сообщение содержит фишинговый URL-адрес, может содержать другой фишинговый контент или могло быть помечено как фишинг другим фильтром почты, например локальной версией Exchange Server, перед пересылкой сообщения в Office 365. <br/>9.11. Сообщение не прошло проверку защиты от спуфинга, когда отправляющий домен в заголовке "От:" совпадает или соответствует принимающему домену или является частью его организации. Эта указывает на добавление в сообщение совета по безопасности в отношении спуфинга внутри организации. <br/>9.19. Сообщение не прошло проверку на подмену домена, когда отправляющий домен пытается олицетворить домен получателя или личный домен, защищенный с помощью политики защиты от фишинга. Эта указывает на добавление в сообщение совета по безопасности в отношении подмены, если функция включена с помощью политики защиты от фишинга. <br/>9.20. Сообщение не прошло проверку на подмену пользователя, когда отправляющий пользователь пытается олицетворить пользователя из организации получателя или настраиваемого пользователя, защищенного с помощью политики защиты от фишинга. Эта указывает на добавление в сообщение совета по безопасности в отношении подмены, если функция включена с помощью политики защиты от фишинга. <br/>9.21. Сообщение не прошло проверку защиты от спуфинга, и отправляющий домен в заголовке "От:" не прошел проверку подлинности и является внешним доменом. Используется в сочетании с CompAuth (см. раздел Authentication-Results). <br/>9.22. Аналогично 9.21, но у пользователя есть надежный отправитель, который был переопределен. <br/>9.23. Аналогично 9.22, но у организации есть разрешенный отправитель или домен, который был переопределен. <br/>9.24. Аналогично 9.23, но у пользователя есть правило потока обработки почты Exchange, которое было переопределено.|
|X-CustomSpam: [ASFOption]|Сообщение имеет параметр, соответствующий одному из расширенных параметров фильтрации нежелательной почты. Например, **X-CustomSpam: графические ссылки на удаленные сайты** указывает, что сообщение содержит параметр ASF **Графические ссылки на удаленные сайты**. Чтобы узнать, какой заголовок имеет определенные параметры ASF, см. статью [Расширенные параметры фильтрации нежелательной почты](advanced-spam-filtering-asf-options.md).|
|

## <a name="x-microsoft-antispam-message-header-fields"></a>Поля заголовка сообщения X-Microsoft-Antispam

В таблице ниже описаны нужные поля в заголовке сообщения **X-Microsoft-Antispam**. Другие поля в этом заголовке нужны для диагностики и используются исключительно группой специалистов Майкрософт, ответственной за защиту от нежелательной почты.
  
|**Поле заголовка**|**Описание**|
|:-----|:-----|
|BCL|Количество жалоб на массовую рассылку (BCL) сообщения. Дополнительные сведения см. в разделе [Уровни жалоб на массовые сообщения](bulk-complaint-level-values.md).  |
|PCL|Уровень вероятности фишинга сообщения, показывающий, является ли сообщение мошенническим. Это состояние может принимать одно из следующих числовых значений: <br/>**0–3**. Маловероятно, что содержимое этого сообщения связано с фишингом. <br/>**4–8**. Скорее всего, содержимое этого сообщения связано с фишингом. <br/>**–9990** (только для Exchange Online Protection). Содержимое этого сообщения, скорее всего, связано с фишингом.  <br/>  Эти значения используются для определения действия, которое клиент электронной почты выполняет для сообщений. Например, Outlook использует метку PCL для блокирования содержимого подозрительных сообщений.  Дополнительные сведения о фишинге и обработке фишинговых сообщений в Outlook см. в статье [Включение и отключение ссылок в электронных сообщениях](https://support.office.com/article/2D79B907-93B6-4774-82E6-1F0385CF20F8).|
|

## <a name="authentication-results-message-header"></a>Заголовок сообщения Authentication-results

Когда на почтовый сервер приходит сообщение, оно проверяется с помощью инфраструктуры политики отправителей, DKIM и DMARC. Результаты этой проверки служба Office 365 записывает в заголовке сообщения **Authentication-results** (добавляет к нему метку).
  
### <a name="check-stamp-syntax-and-examples"></a>Ознакомьтесь с примерами и синтаксисом добавления меток

В приведенных ниже примерах синтаксиса показана текстовая метка, которую Office 365 добавляет к заголовку каждого сообщения, проходящего проверку подлинности при доставке на почтовый сервер. Такая метка добавляется в заголовок **Authentication-Results**.
  
**Синтаксис: метка при проверке с помощью инфраструктуры политики отправителей**
  
В случае инфраструктуры политики отправителей применяется указанный ниже синтаксис.
  
```text
spf=<pass (IP address)|fail (IP address)|softfail (reason)|neutral|none|temperror|permerror> smtp.mailfrom=<domain>
```

**Примеры: метка при проверке с помощью инфраструктуры политики отправителей**
  
```text
spf=pass (sender IP is 192.168.0.1) smtp.mailfrom=contoso.com
spf=fail (sender IP is 127.0.0.1) smtp.mailfrom=contoso.com
```

**Синтаксис: метка при проверке с помощью DKIM**
  
В случае DKIM применяется указанный ниже синтаксис.
  
```text
dkim=<pass|fail (reason)|none> header.d=<domain>
```

**Примеры: метка при проверке с помощью DKIM**
  
```text
dkim=pass (signature was verified) header.d=contoso.com
dkim=fail (body hash did not verify) header.d=contoso.com
```

**Синтаксис: метка при проверке с помощью DMARC**
  
В случае DMARC применяется указанный ниже синтаксис.
  
```text
dmarc=<pass|fail|bestguesspass|none> action=<permerror|temperror|oreject|pct.quarantine|pct.reject> header.from=<domain>
```

**Примеры: метка при проверке с помощью DMARC**
  
```text
dmarc=pass action=none header.from=contoso.com
dmarc=bestguesspass action=none header.from=contoso.com
dmarc=fail action=none header.from=contoso.com
dmarc=fail action=oreject header.from=contoso.com
```

### <a name="authentication-results-message-header-fields-used-by-office-365-email-authentication"></a>Поля заголовка Authentication-results, которые используются Office 365 при проверке подлинности почты

В этой таблице описаны поля и возможные значения для каждой проверки подлинности сообщений.
  
|**Поле заголовка**|**Описание**|
|:-----|:-----|
|spf|Описывает результаты проверки сообщения с использованием инфраструктуры политики отправителей. Возможные значения: <br/>**pass (IP-адрес)**. Указывает, что выполнена проверка сообщения с помощью инфраструктуры политики отправителей, и показывает IP-адрес отправителя. Клиент уполномочен отправлять или пересылать сообщение от имени домена отправителя. <br/>**fail (IP-адрес)**. Указывает, что не удалось выполнить проверку сообщения с использованием инфраструктуры политики отправителей, и показывает IP-адрес отправителя. Это еще иногда называется _серьезным сбоем_. <br/>**softfail (причина)**. Указывает, что запись инфраструктуры политики отправителей определила узел как такой, отправка сообщений для которого не разрешена, но находится в процессе. <br/>**neutral**. Указывает, что запись инфраструктуры политики отправителей не может точно определить, авторизован ли IP-адрес. <br/>**none**. Указывает, что для домена не задана запись инфраструктуры политики отправителей (или что эта запись не приводит к результату). <br/>**temperror**. Указывает, что произошла ошибка, которая может быть временной (например, ошибка DNS). Повторите попытку позже. Вмешательство администратора, возможно, не понадобится.   <br/>**permerror**. Указывает, что произошла постоянная ошибка. Причиной может быть ошибочно созданная запись инфраструктуры политики отправителей для домена.|
|smtp.mailfrom|Содержит название исходного домена, с которого было отправлено сообщение. Сведения об ошибках, связанных с этим сообщением, будут отправлены администратору почты или другому лицу, ответственному за домен. Такое поле еще иногда зовется адресом 5321.MailFrom или адресом reverse-path в конверте сообщения.|
|dkim|Описывает результаты проверки сообщения с использованием DKIM. Возможные значения: <br/>**pass**. Указывает, что проверка сообщения с помощью DKIM пройдена успешно. <br/>**fail (причина)**. Указывает, что не удалось проверить сообщение с помощью DKIM, а также причину этого. Например, когда сообщение не подписано или подпись не проверена. <br/>**none**. Указывает, что сообщение не подписано. Это может быть связано с тем, что для домена задана запись DKIM, которая не приводит к результату.|
|header.d|Определяет домен, указанный в подписи DKIM, если такая есть. Это домен, у которого запрашивается открытый ключ.|
|dmarc|Описывает результаты проверки сообщения с использованием DMARC. Возможные значения: <br/>**pass**. Указывает, что проверка сообщения с помощью DMARC пройдена успешно. <br/>**fail**. Указывает, что проверка сообщения с помощью DMARC не пройдена. <br/>**bestguesspass**. Указывает, что для домена отсутствует запись DMARC TXT, однако если бы такая запись существовала, проверка DMARC была бы пройдена успешно. Это связано с тем, что домен в адресе 5321.MailFrom совпадает с доменом в адресе 5322.From. <br/>**none**. Указывает, что для отправляющего домена в DNS отсутствует запись DKIM TXT.|
|action|Указывает действие, выполняемое фильтром спама на основании результатов проверки с помощью DMARC. Например: <br/>**permerror**. Указывает, что во время проверки с помощью DMARC произошла постоянная ошибка, такая как обнаружение неправильно созданной записи DMARC TXT в DNS. Попытка отправить такое сообщение повторно вряд ли завершится другим результатом. Вместо этого может потребоваться обратиться к владельцу домена с просьбой устранить проблему. <br/>**temperror**. Указывает, что во время проверки с помощью DMARC произошла временная ошибка. Можно обратиться к отправителю с просьбой повторно отправить сообщение позже, чтобы почта была обработана должным образом. <br/>**oreject** или **o.reject**. Указывает, что было выполнено переопределение отклонения. В этом случае Office 365 использует это действие при получении сообщения, не прошедшего проверку DMARC, из доменов, в записях DMARC TXT которых применена политика отклонения (p=reject). Вместо удаления или отклонения такого сообщения служба Office 365 отмечает его как спам. Дополнительные сведения о том, почему Office 365 поступает именно так, см. в разделе [Как Office 365 обрабатывает входящую почту, не прошедшую проверки DMARC](use-dmarc-to-validate-email.md#inbounddmarcfail). <br/>**pct.quarantine**. Указывает, что менее 100 % сообщений, не прошедших проверку DMARC, все равно будут доставлены. Это означает, что сообщение не прошло проверку DMARC и согласно политике должно быть отправлено в карантин, но для поля "pct" не задано значение 100 %, и система случайно определила, что действие DMARC применять не следует. <br/>**pct.reject**. Указывает, что менее 100 % сообщений, не прошедших проверку DMARC, все равно будут доставлены. Это означает, что сообщение не прошло проверку DMARC и согласно политике должно быть отклонено, но для поля "pct" не задано значение 100 %, и система случайно определила, что действие DMARC применять не следует.|
|header.from|Определяет домен, который указан в адресе отправителя в заголовке сообщения. Это поле иногда называется адресом _5322.From_.|
|compauth|Результат многофакторной проверки подлинности. Используется в Office 365 для сочетания различных типов проверки подлинности, например SPF, DKIM, DMARC или другой части сообщения, чтобы определить, прошло ли сообщение проверку подлинности. В качестве основы для оценки используется домен "От:".|
|reason|Причина удачного или неудачного выполнения многофакторной проверки подлинности. Значение причины состоит из трех цифр: <br/>**000**. Сообщение явным образом не прошло проверку подлинности. Например, сообщение получило ошибку DMARC с действием отправки на карантин или отклонения. <br/>**001**. Сообщение не прошло проверку подлинности неявным образом, и отправляющий домен не опубликовал политики проверки подлинности. Например, для политики DMARC установлено значение p=none. <br/>**1xx**. Сообщение прошло проверку подлинности. Вторые две цифры — это внутренние коды, используемые в Office 365. <br/>**2xx**. Сообщение прошло нестрогую проверку подлинности. Вторые две цифры — это внутренние коды, используемые в Office 365. <br/>**3xx**. Сообщение не подвергалось многофакторной проверке подлинности. <br/>**4xx**. Сообщение обошло многофакторную проверку подлинности. Вторые две цифры — это внутренние коды, используемые в Office 365.|
|
