---
title: Удаление данных в Office 365 Exchange Online
ms.author: robmazz
author: robmazz
manager: laurawi
ms.date: 8/21/2018
audience: ITPro
ms.topic: article
ms.service: Office 365 Administration
localization_priority: None
search.appverid:
- MET150
ms.collection:
- Strat_O365_IP
- M365-security-compliance
description: Как мягкое и жесткое удаление данных обрабатывается в Exchange Online.
ms.openlocfilehash: 879d4a0351720780667333502c6caa30dffc8996
ms.sourcegitcommit: c94cb88a9ce5bcc2d3c558f0fcc648519cc264a2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/20/2019
ms.locfileid: "30090741"
---
# <a name="exchange-online-data-deletion-in-office-365"></a>Удаление данных Exchange Online в Office 365
В Exchange Online существует два типа удалений: "обратимое удаление" и "окончательное удаление". Это относится как к почтовым ящикам, так и к элементам в почтовом ящике.

## <a name="soft-deleted-and-hard-deleted-mailboxes"></a>Обратимо удаленные и обратимо удаленные поЧтовые ящики
Обратимо удаленный почтовый ящик пользователя — это почтовый ящик, который был удален с помощью центра администрирования Office 365 или командлета reCycle-Mailbox и по-прежнему находится в корзине Azure Active Directory в течение менее 30 дней. Почтовые ящики могут быть обратимо удалены одним из следующих способов:
- Учетная запись пользователя Azure Active Directory, сопоставленная с почтовым ящиком пользователя, удалена с возможностью восстановления (объект пользователя находится вне области или в контейнере корзины).
- Учетная запись пользователя Azure Active Directory, сопоставленная с почтовым ящиком пользователя, была окончательно удалена, но почтовый ящик Exchange Online находится в режиме хранения для судебного разбирательства или удержания электронных данных.
- Учетная запись пользователя Azure Active Directory, сопоставленная с почтовым ящиком пользователя, была удалена в течение последних 30 дней; Максимальная длина хранения в Exchange Online будет храниться в обратимо удаленном состоянии, прежде чем оно будет необратимо очищено.

Обратимо удаленный почтовый ящик пользователя — это почтовый ящик, который был удален одним из указанных ниже способов.
- Почтовый ящик пользователя был обратимо удален в течение более 30 дней, а связанный с ним пользователь Azure Active Directory был окончательно удален. Все содержимое почтового ящика, например сообщения электронной почты, контакты и файлы, удаляются без возможности восстановления.
- Учетная запись пользователя, связанная с почтовым ящиком пользователя, была окончательно удалена из Azure Active Directory. Почтовый ящик пользователя теперь является обратимым удалением в Exchange Online и остается в обратимо удаленном состоянии в течение 30 дней. Если в течение 30 дней новый пользователь Azure Active Directory синхронизируется с исходной учетной записью получателя с тем же **ExchangeGuid** или **свойств archiveguid**и что новая учетная запись лицензируется для Exchange Online, это приведет к удаленному удалению исходный почтовый ящик пользователя. Все содержимое почтового ящика, например сообщения электронной почты, контакты и файлы, удаляются без возможности восстановления.
- Обратимо удаленный почтовый ящик удаляется с помощью **Remove-Mailbox-PermanentlyDelete**.

В приведенных выше сценариях удаления предполагается, что почтовый ящик пользователя не находится в состоянии удержания, например в случае хранения для судебного разбирательства или удержания электронных данных. Если почтовый ящик имеет любой тип удержания, почтовый ящик удалить невозможно. Для всех типов получателей почты все параметры [хранения](https://support.office.com/article/manage-legal-investigations-in-office-365-2e5fbe9f-ee4d-4178-8ff8-4356bc1b168e?ui=en-US&rs=en-US&ad=US) игнорируются и не оказывают влияния на принудительное удаление или обратимое удаление.

## <a name="soft-deleted-and-hard-deleted-items"></a>Обратимо удаленные и обратимо удаленные элементы
При удалении пользователем элемента почтового ящика (например, сообщения электронной почты, контакта, встречи календаря или задачи) элемент перемещается в папку "элементы с возможностью восстановления" и в вложенную папку с именем "deletes" (удалить). Это называется обратимым удалением. Срок хранения удаленных элементов в папке "удаления" зависит от срока хранения удаленных элементов, настроенного для почтового ящика. Почтовый ящик Exchange Online по умолчанию сохраняет удаленные элементы в течение 14 дней, но администраторы Exchange Online могут изменить этот параметр, чтобы увеличить период до 30 дней. (Подробное описание действий по увеличению срока хранения удаленных элементов для почтового ящика Exchange Online показано в разделе [изменение срока хранения безвозвратно удаленных элементов для почтового ящика Exchange Online](https://docs.microsoft.com/exchange/recipients-in-exchange-online/manage-user-mailboxes/change-deleted-item-retention).) Пользователи могут восстанавливать или очищать удаленные элементы до истечения срока хранения для удаленного элемента. Для этого они используют функцию восстановления удаленных элементов в Microsoft Outlook или Outlook в Интернете.

Если пользователь удаляет удаленный элемент с помощью функции восстановления удаленных элементов в Outlook или Outlook в Интернете, это называется окончательным удалением. В Exchange Online восстановление отдельных элементов включается по умолчанию при создании нового почтового ящика, поэтому администратор по-прежнему может [восстанавливать](https://docs.microsoft.com/Exchange/recipients/user-mailboxes/recover-deleted-messages) удаленные элементы до истечения срока хранения удаленных элементов. Кроме того, если сообщение изменяется пользователем или процессом, копии исходного элемента также сохраняются при включении восстановления отдельных элементов.

## <a name="page-zeroing"></a>Обнуление страниц
*Обнуление* — это механизм обеспечения безопасности, который записывает нулевые или двоичные шаблоны по отношению к удаленным данным, чтобы восстановить удаленные данные более сложно. В Exchange Online базы данных почтовых ящиков используют *страницы* в качестве единиц хранения и реализуют процесс перезаписи, называемый *обнулением страниц*. Обнуление страниц включено по умолчанию и не может быть отключено клиентами или корпорацией Майкрософт. Операции обнуления страниц записываются в файлы журнала транзакций, поэтому все копии этой базы данных будут обнулены одинаковым образом. Обнуление страницы в активной копии базы данных приводит к обнулению страницы в пассивных копиях базы данных.

Обнуление страниц записывает двоичный шаблон по сравнению с жестко удаленными записями. Шаблон обнуления страниц относится к операциям расширенного обработчика хранилищ (ESE) (имя внутреннего ядра СУБД, используемое серверами в Exchange Online), и оно отличается для операций времени выполнения и фоновых операций обслуживания базы данных. (Фоновое обслуживание базы данных — это процесс, который непрерывно выполняет проверку контрольных сумм и сканирует каждую базу данных. Основной функцией является контрольная сумма страниц базы данных, но она также обрабатывает очистку пространства и обнуление записей и страниц, которые не были обнулены из-за сбоя хранилища.)

В следующей таблице перечислены шаблоны заполнения, соответствующие определенным операциям среды выполнения.

| Операция среды выполнения ESE   | Шаблон заполнения |
|--------------------------|--------------|
| Заменить                  | R            |
| Удалить запись или длинное значение | D            |
| Освобожденное место страницы         | H            |


В следующей таблице перечислены шаблоны заполнения, соответствующие определенным операциям, выполняемым во время фонового обслуживания базы данных ESE.

| Операция фонового обслуживания базы данных ESE | Шаблон заполнения |
|-----------------------------------------------|--------------|
| Удалить запись                                 | D            |
| Удалить длинное значение                             | L            |
| Освобожденное место частично используемой страницы       | Z            |
| Освобожденное место неиспользуемой страницы               | U            |


### <a name="page-zeroing-process"></a>Процесс обнуления страниц
Процесс обнуления страниц зависит от сценария удаления. В следующей таблице описываются сценарии удаления баз данных, а также случаи, когда возникают функции обнуления страниц.

| Сценарий удаления базы данных | Процесс ESE и временные рамки обнуления данных в базе данных |
|-----------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Срок хранения элемента истечет на основе срока хранения удаленных элементов. | В асинхронном потоке двоичный шаблон записывается поверх удаленных данных. Это действие выполняется за те миллисекунды, в течение которых происходит удаление записи. Если процесс хранилища завершается сбоем во время ожидания выполнения асинхронного обнуления (или очистка хранилища версий отменяется из-за его роста), обнуление завершается при обработке этого раздела базы данных во время фонового обслуживания базы данных. |
| Сценарий представления: исТечение срока действия элементов из Outlook/Outlook в представлении веб-папки (например, представление беседы) | Обнуление данных выполняется при обработке этого раздела базы данных во время фонового обслуживания базы данных. |
| Сценарий перемещения почтового ящика/удаление почтового ящика: удален исходный почтовый ящик (срок действия удаленного почтового ящика удален) | Обнуление данных выполняется при обработке этого раздела базы данных во время фонового обслуживания базы данных. |

### <a name="mailbox-data-types-without-page-zeroing"></a>Типы данных почтового ящика без обнуления страниц
Следующие типы данных почтовых ящиков не имеют подположений для обнуления страниц:
- **Журналы транзакций базы данных** поЧтовых ящиков — при удалении журналов транзакций в рамках обычных операций нет процесса для обнуления блоков в файловой системе, в которых хранятся удаленные файлы журналов. Скорее всего, файловая система быстро воссоздаст свободное пространство для вновь созданных журналов, но не гарантируется, что это произойдет.
- **Файлы каталога индекса контента** — Exchange Online использует для поиска функции индексирования поиска (также называемый быстрым). Каталог индексов поиска состоит из нескольких десятков файлов, хранящихся на том же томе, что и файл базы данных почтовых ящиков. При окончательном удалении сообщения из базы данных почтовых ящиков связанное с ним содержимое каталога поиска не удаляется сразу. Удаление контента происходит, когда выполняется теневое (или объединение с главным объединением) нескольких небольших файлов каталога в один большой файл. После завершения объединения с главной копией файлы каталога меньшего размера удаляются. Нет процесса для нулевого блока, в котором хранятся удаленные файлы каталога.

## <a name="continuous-replication"></a>Непрерывная репликация
Непрерывная репликация (также называемая доставкой журналов и повтором) — технология в Exchange Online, которая создает и поддерживает копии каждой базы данных почтовых ящиков для обеспечения высокой доступности, устойчивости сайтов и аварийного восстановления. Непрерывная репликация использует поддержку восстановления после сбоя базы данных Exchange Server для предоставления технологии, которая выполняет асинхронное обновление одной или нескольких копий базы данных почтовых ящиков. Каждый сервер почтовых ящиков записывает обновления баз данных, внесенные в активную базу данных (например, действия электронной почты пользователя), в виде записей журнала в последовательный набор файлов журнала транзакций размером 1 МБ. Этот набор файлов называется потоком журнала. В непрерывной репликации поток журнала также используется для асинхронного обновления одной или нескольких копий базы данных. Это достигается путем передачи журналов в расположение, содержащее пассивную копию активной базы данных, а затем воспроизводящее их в пассивную копию базы данных. Если все журналы из активной базы данных воспринимаются по пассивной копии базы данных, то эти две базы данных эквивалентны, а все физические изменения, внесенные в активную базу данных, реплицируются на все пассивные копии этой базы данных.

Удаление из базы данных почтовых ящиков, независимо от того, является ли элемент почтового ящика или весь почтовый ящик, а также возможность обратимого удаления или жесткое удаление, представляет физическое изменение активной базы данных. Обнуление страниц также влечет за собой внесение физических изменений в активную базу данных. Эти изменения записываются в файлы журналов с помощью процесса непрерывной репликации, а при воспроизведении этих файлов журналов для пассивных копий базы данных в эти пассивные базы данных вносятся одни и те же физические изменения.