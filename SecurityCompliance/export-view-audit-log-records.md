---
title: Экспорт, Настройка и просмотр записей журнала аудита
ms.author: markjjo
author: markjjo
manager: laurawi
audience: Admin
ms.topic: article
ms.service: O365-seccomp
localization_priority: Normal
ms.collection:
- Strat_O365_IP
- M365-security-compliance
search.appverid:
- MOE150
- MET150
ms.assetid: 0d4d0f35-390b-4518-800e-0c7ec95e946c
description: После экспорта и загрузки результатов поиска в журнал аудита Office 365 в CSV-файл можно использовать функцию преобразования JSON в редакторе Power Query в Excel, чтобы разделить каждое свойство в объекте JSON в столбце Аудитдата на отдельный столбец. Это поможет быстро найти конкретные искомые данные аудита.
ms.openlocfilehash: 7dac373e8f25ead38dddbe2663e521b35b3153ef
ms.sourcegitcommit: b262d40f6daf06be26e7586f37b736e09f8a4511
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/02/2019
ms.locfileid: "35462948"
---
# <a name="export-configure-and-view-audit-log-records"></a>Экспорт, Настройка и просмотр записей журнала аудита

После поиска в журнале аудита Office 365 и загрузки результатов поиска в CSV-файл файл содержит столбец с именем **аудитдата**, который содержит дополнительные сведения о каждом событии. Данные в этом столбце отформатированы как объект JSON, который содержит несколько свойств, которые настроены как пары *свойство: значение* , разделенные запятыми. Можно использовать функцию преобразования JSON в редакторе Power Query в Excel, чтобы разделить каждое свойство в объекте JSON в столбце **аудитдата** на несколько столбцов, чтобы каждое свойство было иметь собственный столбец. Это позволяет сортировать и фильтровать по одному или нескольким из этих свойств, которые могут помочь быстро найти конкретные искомые данные аудита.

## <a name="step-1-export-audit-log-search-results"></a>Шаг 1: экспорт результатов поиска в журнал аудита

Первый шаг — Поиск в журнале аудита, а затем Экспорт результатов в файл с разделителями-запятыми (CSV) на локальный компьютер.
  
1. Выполните [Поиск по журналу аудита](search-the-audit-log-in-security-and-compliance.md#search-the-audit-log) и изменяйте критерии поиска, если это необходимо, до тех пор, пока не получите нужные результаты.
    
2. Нажмите кнопку **Экспорт результатов** и выберите **скачать все результаты**. 
    
   ![Щелкните скачать все результаты](media/ExportAuditSearchResults.png)

   Этот параметр экспортирует все записи аудита из поиска журнала аудита, выполненного на шаге 1, и загружает необработанные данные из журнала аудита в CSV-файл. 

   В нижней части окна отобразится сообщение с предложением открыть или сохранить CSV-файл. 

3. Нажмите кнопку **сохранить > сохранить как** и сохраните CSV-файл на локальном компьютере. Загрузка множества результатов поиска занимает некоторое время. Обычно это относится к поиску всех действий или широкому диапазону дат. Сообщение в нижней части окна отображается после завершения загрузки CSV-файла.
 
   ![Сообщение, отображаемое при завершении скачивания CSV-файла](media/ExportAuditSearchResultsFinish.png)

> [!NOTE]
  > Можно скачать не более 50 000 записей в CSV-файл из одного поиска журнала аудита. Если в CSV-файл загружаются записи 50 000, можно предположить, что существует более 50 000 событий, удовлетворяющих условиям поиска. Чтобы экспортировать больше этого ограничения, попробуйте использовать диапазон дат, чтобы уменьшить количество записей в журнале аудита. Для экспорта более 50 000 записей может потребоваться выполнить несколько операций поиска с меньшими диапазонами дат.

## <a name="step-2-format-the-exported-audit-log-using-the-power-query-editor"></a>Шаг 2: форматирование экспортированного журнала аудита с помощью редактора Power Query

Следующий шаг — использование функции преобразования JSON в редакторе Power Query в Excel, чтобы разделить каждое свойство в объекте JSON в столбце **аудитдата** на отдельный столбец. Затем вы фильтруете столбцы, чтобы просматривать записи на основе значений определенных свойств. Это поможет быстро найти конкретные искомые данные аудита.

1. Откройте пустую книгу в Excel для Office 365, Excel 2019 или Excel 2016.
    
2.  На вкладке **данные** в группе " **Получение & преобразования данных** " щелкните **из текстового/CSV-** файла.

    ![На вкладке Данные щелкните из текста/CSV](media/JSONTransformOpenCSVFile.png)

3. Откройте CSV-файл, скачанный в действии 1.
    
4. В появившемся окне нажмите кнопку **преобразовать данные**.

   ![Нажмите кнопку преобразования данных](media/JSONOpenPowerQuery.png)

CSV-файл открывается в **редакторе запросов**. Существует четыре столбца: **CreationDate**, **UserID**, Operations **** и **аудитдата**. Столбец **аудитдата** — это объект JSON, который содержит несколько свойств. Следующий шаг — создание столбца для каждого свойства в объекте JSON.
    
5. Щелкните правой кнопкой мыши заголовок в столбце **аудитдата** , выберите команду **преобразовать**, а затем — **JSON**. 
 
   ![Щелкните правой кнопкой мыши столбец Аудитдата, выберите команду Преобразовать, а затем выберите пункт JSON.](media/JSONTransform.png)

6. В правом верхнем углу столбца **аудитдата** щелкните значок развернуть.
    
   ![В столбце Аудитдата щелкните значок развертывания](media/JSONTransformExpandIcon.png)

   Отображается неполный список свойств в объектах JSON в столбце **аудитдата** .

7. Нажмите кнопку **загрузить еще** , чтобы отобразить все свойства в объектах JSON в столбце **аудитдата** .

   ![Нажмите кнопку Загрузить еще, чтобы отобразить все свойства в объекте JSON.](media/JSONTransformLoadJSONProperties.png)

   Вы можете снять флажок рядом со свойством, которое вы не хотите включать. Удаление столбцов, которые не подходят для расследования, — это хороший способ уменьшить объем данных, отображаемых в журнале аудита. 

   > [!NOTE]
   > Свойства JSON, отображаемые на предыдущем снимке экрана (после нажатия кнопки **загрузить больше**), основываются на свойствах, найденных в столбце **аудитдата** из первых 1 000 строк в CSV-файле. Если в записях есть различные свойства JSON в записях после первой строки 1 000, эти свойства (и соответствующий столбец) не будут включены при разбиении столбца **аудитдата** на несколько столбцов. Чтобы избежать этого, рассмотрите возможность повторного запуска поиска в журнале аудита и сужения критериев поиска, чтобы возвращалось меньше записей. Другим обходным решением является фильтрация элементов в столбце " **операции** " для сокращения числа строк (перед выполнением шага 5 перед преобразованием объекта JSON в столбец **аудитдата**

8. Выполните одно из следующих действий, чтобы отформатировать название столбцов, добавляемых для каждого выбранного свойства JSON.

    - Снимите флажок **использовать исходное имя столбца в качестве префикса** , чтобы использовать имя свойства JSON в качестве имен столбцов; Например, **RecordType** или **саурцефиленаме**.
    
   - Для добавления префикса Аудитдата в имена столбцов оставьте установленным флажок **использовать исходное имя столбца в качестве префикса** ; Например, **аудитдата. RecordType** или **аудитдата. саурцефиленаме**.

9. Нажмите кнопку **ОК**.
    
    Столбец **аудитдата** разделяется на несколько столбцов. Каждый новый столбец соответствует свойству в объекте Аудитдата JSON. Каждая строка в столбце содержит значение свойства. Если свойство не содержит значение, отображается значение *null* . В Excel ячейки со значениями NULL пусты.
  
10. На вкладке **Главная** нажмите кнопку **Закрыть & загрузить** , чтобы закрыть редактор Power Query, и откройте преобразованный CSV-файл в книгу Excel. 

## <a name="tips-for-exporting-and-viewing-the-audit-log"></a>Советы по экспорту и просмотру журнала аудита

Ниже приведено несколько советов и примеров экспорта и просмотра журнала аудита до и после использования функции преобразования JSON для разделения столбца **аудитдата** на несколько столбцов.

- Отфильтровать столбец **RecordType** , чтобы отображались только записи из определенной службы или функциональной области Office 365. Например, чтобы показать события, связанные с общим доступом к SharePoint, выберите **14** (значение перечисления для записей, инициированных действиями общего доступа к SharePoint). Список служб Office 365, соответствующих значениям перечисления, отображаемым в столбце **RecordType** , приведен в разделе [подробные свойства в журнале аудита Office 365](detailed-properties-in-the-office-365-audit-log.md).

- Фильтрация столбца " **операции** " для отображения записей для определенных действий. Список большинства операций, соответствующих действиям поиска в средстве поиска журнала аудита в центре безопасности & соответствия требованиям, приведен в разделе "аудитные действия" в разделе [Поиск в журнале аудита в центре безопасности &](search-the-audit-log-in-security-and-compliance.md#audited-activities).

- Вместо использования средства поиска журнала аудита в центре безопасности & соответствия требованиям можно использовать командлет [Search-UnifiedAuditLog](https://docs.microsoft.com/powershell/module/exchange/policy-and-compliance-audit/search-unifiedauditlog) в Exchange Online PowerShell, чтобы экспортировать результаты поиска в журнал аудита Office 365 в CSV-файл. Затем вы можете выполнить процедуру, описанную в шаге 2, чтобы отформатировать журнал аудита с помощью редактора Power Query Editor. Одним из преимуществ использования командлета PowerShell является то, что вы можете искать события из определенной службы Office 365 с помощью параметра *RecordType* . Ниже приведено несколько примеров использования PowerShell для экспорта записей аудита в CSV-файл, чтобы можно было использовать редактор Power Query для преобразования объекта JSON в столбец **аудитдата** , как описано в шаге 2.

   В этом примере выполните следующие команды, чтобы возвратить все записи, связанные с операциями общего доступа SharePoint. 
   
   ```
   $auditlog = Search-UnifiedAuditLog -StartDate 06/01/2019 -EndDate 06/30/2019 -RecordType SharePointSharingOperation
   ```

   ```
   $auditlog | Select-Object -Property CreationDate,UserIds,RecordType,AuditData | Export-Csv -Path c:\AuditLogs\PowerShellAuditlog.csv -NoTypeInformation
   ```

   - Результаты поиска экспортируются в CSV-файл с именем *повершеллаудитлог* , содержащий четыре столбца: CreationDate, UserID, RecordType, аудитдата).

   - Можно использовать имя или значение перечисления для типа записи в качестве значения параметра *RecordType* . Список имен типов записей и соответствующих им значений перечисления представлен в таблице *аудитлогрекордтипе* в [схеме API действий управления Office 365](https://docs.microsoft.com/office/office-365-management-api/office-365-management-activity-api-schema#enum-auditlogrecordtype---type-edmint32).
   
   - Для этого параметра можно указать только одно значение. Для поиска записей аудита для других типов записей необходимо повторно выполнить две приведенные выше команды, чтобы указать другой тип записи и добавить эти результаты в исходный CSV-файл. Например, эти две команды можно использовать для добавления действий с файлами SharePoint из одного диапазона дат в файл Повершеллаудитлог. csv.

       ```
      $auditlog = Search-UnifiedAuditLog -StartDate 06/01/2019 -EndDate 06/30/2019 -RecordType SharePointFileOperation
      ```

      ```
      $auditlog | Select-Object -Property CreationDate,UserIds,RecordType,AuditData | Export-Csv -Append -Path c:\AuditLogs\PowerShellAuditlog.csv -NoTypeInformation
      ```
