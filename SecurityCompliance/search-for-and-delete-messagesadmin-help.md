---
title: Поиск и удаление сообщений (справка администратора)
ms.author: markjjo
author: markjjo
manager: laurawi
ms.date: 12/20/2017
ms.audience: ITPro
ms.topic: article
ms.service: O365-seccomp
ms.collection: M365-security-compliance
localization_priority: Normal
search.appverid:
- MET150
ms.assetid: 8c36bb03-e716-4fdd-9958-4aa7a2a1db42
description: Администраторы могут использовать командлет Search-Mailbox для поиска и удаления сообщений в почтовых ящиках пользователей.
ms.openlocfilehash: abf7e7f39fe719ecc6c23565e284c01aed8822ee
ms.sourcegitcommit: 0f93b37c39d807dec91f118aa671a3430c47a9ac
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/20/2019
ms.locfileid: "30693488"
---
# <a name="search-for-and-delete-messages---admin-help"></a>Поиск и удаление сообщений (справка администратора)
  
Администраторы могут использовать командлет **Search-Mailbox** для поиска и удаления сообщений в почтовых ящиках пользователей. 
  
Чтобы найти и одновременно удалить сообщения, выполните командлет **Search-Mailbox** с параметром  _DeleteContent_. Однако при этом вы не сможете предварительно просмотреть результаты поиска или создать журнал сообщений, которые будут возвращены в результатах поиска. Таким образом, вы можете случайно удалить сообщения, которые не хотели удалять. Чтобы просмотреть журнал сообщений в результатах поиска перед их удалением, выполните командлет **Search-Mailbox** с параметром  _LogOnly_. 
  
В целях дополнительной защиты данных можно предварительно скопировать сообщения в другой почтовый ящик с помощью параметров  _TargetMailbox_ и  _TargetFolder_. Благодаря этому сохранится копия удаленных сообщений на случай необходимости доступа к ним в будущем. 
  
## <a name="before-you-begin"></a>Перед началом работы

- Предполагаемое время выполнения: 10 минут. Фактическое время зависит от размера почтового ящика и запроса поиска.
    
- Для выполнения этих процедур нельзя использовать Центр администрирования Exchange. Необходимо использовать командную консоль.
    
- Для поиска и удаления сообщений в почтовых ящиках пользователей необходимы обе указанные ниже роли управления.
    
  - **Поиск**в почтовом ящике — эта роль позволяет искать сообщения в нескольких почтовых ящиках в Организации. Администраторы не назначают эту роль по умолчанию. Чтобы назначить себе эту роль, чтобы можно было выполнять поиск в почтовых ящиках, добавьте себя в качестве участника группы ролей "Управление обнаружением". Ознакомьтесь со статьей [Добавление пользователя в группу ролей Управление обнаружением](http://technet.microsoft.com/library/729e09d8-614b-431f-ae04-ae41fb4c628e.aspx).
    
  - **Экспорт импорта** поЧтовых ящиков — Эта роль позволяет удалять сообщения из почтового ящика пользователя. По умолчанию эта роль группе ролей не назначена. Для удаления сообщений из почтовых ящиков пользователей следует добавить роль "Импорт и экспорт почтовых ящиков" в группу ролей "Управление организацией". Дополнительные сведения можно найти в разделе "Добавление роли в группу ролей" в разделе [Управление группами ролей](http://technet.microsoft.com/library/ab9b7a3b-bf67-4ba1-bde5-8e6ac174b82c.aspx) . 
    
- Если для почтового ящика, из которого необходимо удалить сообщения, включена функция восстановления одного элемента, сначала необходимо отключить ее. Дополнительные сведения см. в статье [Включение или отключение восстановления одного элемента в почтовом ящике](http://technet.microsoft.com/library/2e7f1bcd-8395-45ad-86ce-22868bd46af0.aspx).
    
- Если почтовый ящик, из которого необходимо удалить сообщения, помещен на хранение, рекомендуем обратиться в отдел управления записями или юридический отдел, прежде чем отключать хранение и удалять содержимое почтового ящика. После получения утверждения выполните действия, описанные в разделе [Очистка папки "элементы с возможностью восстановления"](http://technet.microsoft.com/library/82c310f8-de2f-46f2-8e1a-edb6055d6e69.aspx).
    
- С помощью командлета **Search-Mailbox** можно выполнить поиск не более чем в 10 000 почтовых ящиков. Если в вашей организации Exchange Online более 10 000 почтовых ящиков, вы можете использовать функцию поиска соответствия (или связанный с ней командлет **New-ComplianceSearch** ), чтобы выполнять поиск в неограниченном количестве почтовых ящиков. Затем вы можете удалить сообщения, возвращенные поиском соответствия, с помощью командлета **New-ComplianceSearchAction**. Дополнительные сведения см. в статье [Поиск и удаление сообщений электронной почты из организации Office 365](https://go.microsoft.com/fwlink/p/?LinkId=786856).
    
- Если вы включите поисковый запрос (используя параметр  *SearchQuery*  ), командлет **Search-Mailbox** вернет максимум 10 000 элементов. Поэтому, чтобы удалить более 10 000 элементов, может потребоваться выполнить команду **Search-Mailbox** несколько раз. 
    
- При запуске командлета **Search-Mailbox** поиск также выполняется в архивном почтовом ящике пользователя. Аналогично, при использовании командлета **Search-Mailbox** с параметром  _DeleteContent_ удаляются элементы в основном архивном почтовом ящике. Чтобы этого не произошло, можно включить параметр  *DoNotIncludeArchive*  . Кроме того, мы не рекомендуем использовать параметр  _DeleteContent_ для удаления сообщений в почтовых ящиках Exchange Online, для которых включено автоматическое расширение архивов, так как это может привести к непредвиденной потере данных. 
    
## <a name="search-messages-and-log-the-search-results"></a>Поиск сообщений и ведение журнала результатов

В этом примере в почтовом ящике пользователя April Stewart выполняется поиск сообщений, содержащих фразу "Your bank statement" в теме; результаты поиска записываются в журнал в папке SearchAndDeleteLog почтового ящика администратора. Сообщения не копируются в целевой почтовый ящик и не удаляются из него.
  
```
Search-Mailbox -Identity "April Stewart" -SearchQuery 'Subject:"Your bank statement"' -TargetMailbox administrator -TargetFolder "SearchAndDeleteLog" -LogOnly -LogLevel Full
```

В этом примере во всех почтовых ящиках организации выполняется поиск сообщений с любыми типами вложенных файлов, содержащих слово Trojan в имени. При этом сообщение журнала отправляется в почтовый ящик администратора.
  
```
Get-Mailbox -ResultSize unlimited | Search-Mailbox -SearchQuery attachment:trojan* -TargetMailbox administrator -TargetFolder "SearchAndDeleteLog" -LogOnly -LogLevel Full
```

Дополнительные сведения о синтаксисе и параметрах см. в разделе [Search-Mailbox](http://technet.microsoft.com/library/9ee3b02c-d343-4816-a583-a90b1fad4b26.aspx).
  
 
## <a name="search-and-delete-messages"></a>Поиск и удаление сообщений

В этом примере в почтовом ящике пользователя April Stewart выполняется поиск сообщений, содержащих фразу "Your bank statement" в теме; сообщения удаляются из исходного почтового ящика без копирования результатов поиска в другую папку. Как было указано ранее, вам должна быть назначена роль управления "Экспорт и импорт почтового ящика", чтобы удалять сообщения из почтового ящика пользователя.
  
> [!IMPORTANT]
> При использовании командлета **Search-Mailbox** с параметром  _DeleteContent_ сообщения окончательно удаляются из исходного почтового ящика. Перед окончательным удалением сообщений рекомендуется использовать параметр  _LogOnly_ для создания журнала сообщений, найденных в результатах поиска, или скопировать эти сообщения в другой почтовый ящик перед их удалением из исходного почтового ящика. 
  
```
Search-Mailbox -Identity "April Stewart" -SearchQuery 'Subject:"Your bank statement"' -DeleteContent
```

В этом примере в почтовом ящике пользователя April Stewart выполняется поиск сообщений, содержащих фразу "Your bank statement" в теме; результаты поиска копируются в папку AprilStewart-DeletedMessages почтового ящика BackupMailbox, а сообщения удаляются из почтового ящика April.
  
```
Search-Mailbox -Identity "April Stewart" -SearchQuery 'Subject:"Your bank statement"' -TargetMailbox "BackupMailbox" -TargetFolder "AprilStewart-DeletedMessages" -LogLevel Full -DeleteContent
```

В этом примере во всех почтовых ящиках организации выполняется поиск сообщений, содержащих строчку "Download this file" в теме, после чего эти сообщения безвозвратно удаляются. 
  
```
Get-Mailbox -ResultSize unlimited | Search-Mailbox -SearchQuery 'Subject:"Download this file"' -DeleteContent
```

Подробные сведения о синтаксисе и параметрах см. в разделе [Search-Mailbox](http://technet.microsoft.com/library/9ee3b02c-d343-4816-a583-a90b1fad4b26.aspx).

## <a name="using-the--loglevel-full-parameter"></a>Использование параметра -LogLevel Full

В некоторых предыдущих примерах параметр  _LogLevel_ со значением  `Full` используется для записи подробной информации о результатах, возвращаемых командлетом **Search-Mailbox**. Если этот параметр включен, в почтовый ящик, указанный параметром  _TargetMailbox_, отправляется сообщение с файлом журнала (Search Results.csv), который будет находиться в папке, указанной параметром  _TargetFolder_. Файл журнала содержит по одной строке для каждого сообщения, включенного в результаты поиска при выполнении командлета **Search-Mailbox**. 
