---
title: Поиск содержимого при обнаружении электронных данных
ms.author: markjjo
author: markjjo
manager: laurawi
ms.date: 12/30/2016
ms.audience: Admin
ms.topic: article
ms.service: O365-seccomp
localization_priority: Normal
ms.assetid: 55f31488-288a-473a-9b9e-831a11e3711a
description: 'Используйте сценарий PowerShell для создания поискового запроса на обнаружение электронных данных на месте в Exchange Online на основе поиска, созданного в центре &amp; безопасности и соответствия требованиям Office 365. '
ms.openlocfilehash: 03df28094f29ced5a299aeb4f2140c3c3b0eba8c
ms.sourcegitcommit: 54a2cbe5d13f448e0c28655bdf88deb9e5434cac
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2019
ms.locfileid: "30935254"
---
# <a name="use-content-search-in-your-ediscovery-workflow"></a>Поиск содержимого при обнаружении электронных данных

Функция поиска контента в центре безопасности &amp; и соответствия требованиям Office 365 позволяет выполнять поиск во всех почтовых ящиках в Организации. В отличие от обнаружения электронных данных на месте в Exchange Online (где можно выполнить поиск до 10 000 почтовых ящиков), количество целевых почтовых ящиков в одной функции поиска не ограничено. Для сценариев, требующих проведения поиска на уровне Организации, можно использовать поиск контента для поиска во всех почтовых ящиках. В то же время с помощью функций рабочего процесса для обнаружения электронных данных на месте можно выполнять другие задачи, связанные с таким обнаружением, например помещать почтовые ящики на удержание или экспортировать результаты поиска. Предположим, вам нужно выполнить поиск во всех почтовых ящиках, чтобы определить те ящики, в которых хранятся сведения, имеющие отношение к судебному делу. Вы можете использовать поиск контента в центре безопасности &amp; и соответствия требованиям для поиска всех почтовых ящиков в Организации, чтобы определить, какие из них отвечают. Затем вы можете использовать этот список почтовых ящиков хранитель в качестве исходных почтовых ящиков для поиска с обнаружением электронных данных на месте в Exchange Online. С помощью функции обнаружения электронных данных на месте можно также поставить на удержание эти исходные почтовые ящики, скопировать результаты поиска в почтовый ящик найденных сообщений, а затем экспортировать их.
  
В этой статье описывается сценарий, который можно использовать для создания поискового запроса на обнаружение электронных данных на месте в Exchange Online с помощью списка исходных почтовых ящиков и поискового запроса из &amp; поиска, созданного в центре соответствия требованиям безопасности. Ниже приводятся более детальные сведения об этом процессе:
  
[Шаг 1. Создание запроса на поиск содержимого по всем почтовым ящикам в организации](#step-1-create-a-content-search-to-search-all-mailboxes-in-your-organization)

[Шаг 2: подключение к центру безопасности \& и соответствия требованиям Exchange Online в едином удаленном сеансе PowerShell](#step-2-connect-to-the-security--compliance-center-and-exchange-online-in-a-single-remote-powershell-session)
  
[Шаг 3. Запуск сценария для создания запроса на обнаружение электронных данных на месте, в основе которого лежит запрос на поиск содержимого](#step-3-run-the-script-to-create-an-in-place-ediscovery-search-from-the-content-search)

[Step 4: Start the In-Place eDiscovery search](#step-4-start-the-in-place-ediscovery-search)

## <a name="step-1-create-a-content-search-to-search-all-mailboxes-in-your-organization"></a>Шаг 1. Создание запроса на поиск содержимого по всем почтовым ящикам в организации

Первым этапом является использование центра безопасности &amp; (или _Амп_ Security Security Center) для создания поиска контента, который выполняет поиск во всех почтовых ящиках в Организации. Количество почтовых ящиков для одного поиска контента не ограничено. Укажите запрос по соответствующему ключевому слову (или запрос по типам конфиденциальной информации), чтобы поиск возвратил только те исходные почтовые ящики, которые подходят для расследования. При необходимости уточните поисковый запрос, чтобы сузить область результатов поиска и исходных почтовых ящиков, которые будут возвращены.
  
> [!NOTE]
> Если ничего не найдено, операция обнаружения электронных данных на месте не будет создана при выполнении сценария на шаге 3. Возможно, потребуется изменить поисковый запрос, а затем повторить поиск содержимого. 
  
### <a name="use-the-security-amp-compliance-center-to-search-all-mailboxes"></a>Поиск во всех &amp; почтовых ящиках с помощью центра соответствия требованиям безопасности

1. [Перейдите в центр безопасности &amp; и соответствия требованиям Office 365](go-to-the-securitycompliance-center.md). 
    
2. Нажмите **кнопку &amp; Поиск**в расследовании, выберите пункт **Поиск содержимого**, а затем](media/O365-MDM-CreatePolicy-AddIcon.gif)нажмите кнопку **создать** ![значок добавления.
    
3. На странице **Новый поиск** введите имя запроса на поиск содержимого. 
    
4. В разделе **Где нужно искать?** выберите **Поиск во всех почтовых ящиках** и нажмите кнопку **Далее**.
    
5. В поле **Что вы ищете?** введите поисковый запрос. Можно указать ключевые слова или свойства сообщений, например даты отправки и получения, или свойства документов, например имена файлов или дату последнего изменения. Можно использовать более сложные запросы, использующие логический оператор (например, AND, OR, NOT или NEAR), а также выполнять поиск конфиденциальной информации (например, номера социального страхования) в сообщениях. Дополнительные сведения о создании поисковых запросов см. в статье [Keyword queries for Content Search](keyword-queries-and-search-conditions.md).
    
6. Щелкните **Поиск**, чтобы сохранить параметры поиска и начать поиск. 
    
    Через некоторое время в области сведений отображается оценка результатов поиска. Оценка включает в себя общий размер и количество элементов в результатах поиска. После завершения поиска можно просмотреть его результаты. При необходимости нажмите кнопку **Обновить**![значок](media/O365-MDM-Policy-RefreshIcon.gif) обновления, чтобы обновить сведения в области сведений. 
    
7.  При необходимости уточните поисковый запрос, чтобы сузить область результатов поиска, а затем повторите поиск. 
    
### <a name="use-security--compliance-center-powershell-to-search-all-mailboxes"></a>Использование PowerShell центра соответствия требованиям _Амп_ для поиска во всех почтовых ящиках

Для поиска во всех почтовых ящиках организации можно также использовать командлет **New-ComplianceSearch**. Первый шаг — [Подключение к PowerShell центра безопасности &amp; для Office 365](https://go.microsoft.com/fwlink/p/?LinkID=627084).
  
Ниже приведен пример использования PowerShell для поиска всех почтовых ящиков в Организации. Этот поисковый запрос возвращает все сообщения, отправленные в период с 1 января по 30 июня 2015 г. и содержащие фразу "financial report" (финансовый отчет) в строке темы. Первая команда создает поиск, а вторая выполняет его. 
  
```
New-ComplianceSearch -Name "Search All-Financial Report" -ExchangeLocation all -ContentMatchQuery 'sent>=01/01/2015 AND sent<=06/30/2015 AND subject:"financial report"'
```

```
Start-ComplianceSearch -Identity "Search All-Financial Report"
```

Дополнительные сведения см. в статье [New-ComplianceSearch](https://go.microsoft.com/fwlink/p/?LinkId=517935).
  
### <a name="verify-the-number-of-source-mailboxes-in-the-content-search"></a>Проверка количества исходных почтовых ящиков в запросе на поиск содержимого

Поиск контента Возвращает максимум 1 000 исходных почтовых ящиков, которые содержат результаты поиска. При наличии более чем 1 000 почтовых ящиков, которые содержат контент, соответствующий поисковому запросу, в поиск контента, созданный на предыдущем шаге, включаются только первые 1 000 почтовых ящиков с большинством результатов поиска. Таким образом, если почтовые ящики более чем 1 000 содержат результаты поиска, некоторые из них не будут включены в список исходных почтовых ящиков, скопированных в новый запрос на обнаружение электронных данных на месте, созданный на шаге 3. 
  
Чтобы облегчить создание поиска контента, не превышающего 1 000 исходных почтовых ящиков, выполните указанные ниже действия, чтобы выполнить сценарий, в котором отображается количество исходных почтовых ящиков (которые содержат результаты поиска), возвращаемых при поиске контента, созданном на шаге 1. 
  
1. Сохраните приведенный ниже текст в файле скрипта PowerShell с помощью суффикса имени файла. ps1. Например, вы можете сохранить его в файл с именем `SourceMailboxes.ps1`.
    
  ```
  [CmdletBinding()]
  Param(
      [Parameter(Mandatory=$True,Position=1)]
      [string]$SearchName
  )
  $search = Get-ComplianceSearch $SearchName
  if ($search.Status -ne "Completed")
  {
                  "Please wait until the search finishes.";
                  break;
  }
  $results = $search.SuccessResults;
  if (($search.Items -le 0) -or ([string]::IsNullOrWhiteSpace($results)))
  {
                  "The Content Search " + $SearchName + " didn't return any useful results.";
                  break;
  }
  $mailboxes = @();
  $lines = $results -split '[\r\n]+';
  foreach ($line in $lines)
  {
      if ($line -match 'Location: (\S+),.+Item count: (\d+)' -and $matches[2] -gt 0)
      {
          $mailboxes += $matches[1];
      }
  }
  "Number of mailboxes that have search hits: " + $mailboxes.Count
  ```

2. В PowerShell центра безопасности _Амп_ соответствие требованиям перейдите к папке, в которой расположен скрипт, созданный на предыдущем шаге, и запустите его. Например:
    
    ```
    .\SourceMailboxes.ps1
    ```

3. Когда вам это будет предложено, введите имя запроса на поиск содержимого, созданного на шаге 1.
    
    Сценарий отобразит количество исходных почтовых ящиков, которые содержат результаты поиска.
    
Если вы используете более 1 000 исходных почтовых ящиков, попробуйте создать два (или более) поиска контента. Например, найдите половину почтовых ящиков организации в одном поиске контента, а другую половину в другом поиске контента. Кроме того, можно изменить условия поиска, чтобы уменьшить количество почтовых ящиков, которые содержат результаты поиска. Например, можно включить диапазон дат или уточнить запрос ключевых слов.
  
## <a name="step-2-connect-to-the-security--compliance-center-and-exchange-online-in-a-single-remote-powershell-session"></a>Шаг 2: подключение к центру безопасности \& и соответствия требованиям Exchange Online в едином удаленном сеансе PowerShell

Следующий шаг — подключение Windows PowerShell к центру безопасности &amp; и соответствия требованиям в организации Exchange Online. Это необходимо, так как скрипт, выполняемый на шаге 3, должен иметь доступ к командлетам поиска контента в &amp; центре соответствия требованиям безопасности и командлетам обнаружения электронных данных на месте в Exchange Online.
  
1. Сохраните приведенный ниже текст в файле скрипта Windows PowerShell, используя суффикс .ps1 в имени файла. Например, вы можете сохранить его в файл с именем `ConnectEXO-CC.ps1`.
    
    ```
    $UserCredential = Get-Credential
    $Session = New-PSSession -ConfigurationName Microsoft.Exchange -ConnectionUri https://ps.outlook.com/powershell-liveid -Credential $UserCredential -Authentication Basic -AllowRedirection
    Import-PSSession $Session -DisableNameChecking
    $Session = New-PSSession -ConfigurationName Microsoft.Exchange -ConnectionUri https://ps.compliance.protection.outlook.com/powershell-liveid -Credential $UserCredential -Authentication Basic -AllowRedirection
    Import-PSSession $Session -AllowClobber -DisableNameChecking
    $Host.UI.RawUI.WindowTitle = $UserCredential.UserName + " (Exchange Online + Compliance Center)"
    ```

2. На локальном компьютере откройте Windows PowerShell, перейдите к папке, в которой расположен скрипт, созданный на предыдущем шаге, и запустите его. Например:
    
    ```
    .\ConnectEXO-CC.ps1
    ```

Как узнать, работает ли это? После выполнения сценария командлеты из центра соответствия требованиям безопасности &amp; и Exchange Online импортируются в локальный сеанс PowerShell. Если при этом не возникают ошибки, подключение установлено. Быстрая проверка заключается в запуске командлета центра &amp; обеспечения безопасности (например, **Install-унифиедкомплианцепререкуисите** ) и командлета Exchange Online, например **Get-Mailbox**. 
  
## <a name="step-3-run-the-script-to-create-an-in-place-ediscovery-search-from-the-content-search"></a>Шаг 3. Запуск сценария для создания запроса на обнаружение электронных данных на месте, в основе которого лежит поиск содержимого

После создания двойного сеанса PowerShell в действии 2 необходимо выполнить сценарий, который будет преобразовывать существующий поиск контента в поиск обнаружения электронных данных на месте. Вот что делает сценарий:
  
- Запрашивает имя запроса на поиск содержимого, который требуется преобразовать.
    
- Проверяет, завершен ли поиск содержимого. Если ничего не найдено, запрос на обнаружение электронных данных на месте не будет создан.
    
- Сохраняет в переменной список тех исходных почтовых ящиков из запроса на поиск содержимого, которые содержат результаты поиска.
    
- Создает поиск с обнаружением электронных данных на месте с указанными ниже свойствами. Обратите внимание, что новый поиск не запускается. Он запускается на шаге 4.
    
  - **Name** — имя нового поиска использует следующий формат: \<имя _MBSearch1 поиска\>контента. Если выполнить сценарий повторно и использовать тот же Поиск исходного контента, будет использоваться \<имя _MBSearch2 поиска\>контента.
    
  - **Исходные** почтовые ящики — все почтовые ящики из поиска контента, содержащие результаты поиска. 
    
  - **Поисковый запрос** — новый поиск использует поисковый запрос из поиска контента. Если поиск содержимого распространяется на все содержимое (поисковый запрос пустой), новый запрос на поиск также будет пустым (включать все содержимое, найденное в исходных почтовых ящиках). 
    
  - **Только оценить Поиск** — новый поиск помечается как поиск только для оценки. После выполнения такого поиска результаты не копируются в почтовый ящик найденных сообщений. 
    
1. Сохраните приведенный ниже текст в файле скрипта Windows PowerShell, используя суффикс .ps1 в имени файла. Например, вы можете сохранить его в файл с именем `CreateMBSearchFromComplianceSearch.ps1`.
    
  ```
  [CmdletBinding()]
  Param(
      [Parameter(Mandatory=$True,Position=1)]
      [string]$SearchName,
      [switch]$original,
      [switch]$restoreOriginal
  )
  $search = Get-ComplianceSearch $SearchName
  if ($search.Status -ne "Completed")
  {
    "Please wait until the search finishes";
    break;
  }
  $results = $search.SuccessResults;
  if (($search.Items -le 0) -or ([string]::IsNullOrWhiteSpace($results)))
  {
    "The Content Search " + $SearchName + " didn't return any useful results";
    "A mailbox search object wasn't created";
    break;
  }
  $mailboxes = @();
  $lines = $results -split '[\r\n]+';
  foreach ($line in $lines)
  {
      if ($line -match 'Location: (\S+),.+Item count: (\d+)' -and $matches[2] -gt 0)
      {
          $mailboxes += $matches[1];
      }
  }
  $msPrefix = $SearchName + "_MBSearch";
  $I = 1;
  $mbSearches = Get-MailboxSearch;
  while ($true)
  {
      $found = $false;
      $mbsName = "$msPrefix$I";
      foreach ($mbs in $mbSearches)
      {
          if ($mbs.Name -eq $mbsName)
          {
              $found = $true;
              break;
          }
      }
      if (!$found)
      {
          break;
      }
      $I++;
  }
  $query = $search.KeywordQuery;
  if ([string]::IsNullOrWhiteSpace($query))
  {
      $query = $search.ContentMatchQuery;
  }
  if ([string]::IsNullOrWhiteSpace($query))
  {
    New-MailboxSearch "$msPrefix$i" -SourceMailboxes $mailboxes -EstimateOnly;
  }
  else
  {
    New-MailboxSearch "$msPrefix$i" -SourceMailboxes $mailboxes -SearchQuery $query -EstimateOnly;
  }
  
  ```

2. В сеансе Windows PowerShell, созданном на шаге 2, перейдите к папке, в которой расположен скрипт, созданный на предыдущем шаге, и запустите его. Например:
    
    ```
    .\CreateMBSearchFromComplianceSearch.ps1
    ```

3. По запросу введите имя поиска контента, который нужно преобразовать в поиск с обнаружением электронных данных на месте (например, поиск, созданный на шаге 1), а затем нажмите клавишу **Ввод**.
    
    При успешном выполнении сценария создается поиск с обнаружением электронных данных на месте с состоянием **NotStarted**. Выполните команду  `Get-MailboxSearch <Name of Content Search>_MBSearch1 | FL`, чтобы отобразить свойства нового поиска. 
  
## <a name="step-4-start-the-in-place-ediscovery-search"></a>Шаг 4. Запуск поиска с обнаружением электронных данных на месте

Сценарий, выполняемый на шаге 3, создает запрос на поиск с обнаружением электронных данных на месте, но не запускает его. Теперь необходимо запустить поиск, чтобы получить оценку его результатов.
  
1. In the Exchange admin center (EAC), go to **Compliance management** \> **In-Place eDiscovery &amp; Hold**.
    
2. В списке выберите поиск с обнаружением электронных данных на месте, созданный на шаге 3.
    
3. Нажмите кнопку **Поиск поиска** ![](media/5f6f9463-50e9-460b-8738-b67e759c2efc.gif) \> **Оценка результатов поиска** , чтобы начать поиск и получить оценку общего размера и количества элементов, возвращенных в результате поиска. 
    
    Оценка отображается в области сведений. Нажмите кнопку **Обновить** ![значок](media/O365-MDM-Policy-RefreshIcon.gif) обновления, чтобы обновить сведения, отображаемые в области сведений. 
    
4. Для предварительного просмотра результатов после завершения поиска нажмите кнопку **Предварительный просмотр результатов поиска** в области сведений.
  
## <a name="next-steps-after-creating-and-running-the-in-place-ediscovery-search"></a>Действия после создания и запуска поиска с обнаружением электронных данных на месте

После создания и запуска поиска с обнаружением электронных данных на месте, который был создан с помощью сценария на шаге 3, можно выполнять различные стандартные действия над результатами поиска.
  
### <a name="create-an-in-place-hold"></a>Создание хранения на месте

1. In the EAC, go to **Compliance management** \> **In-Place eDiscovery &amp; Hold**.
    
2. В представлении списка выберите Поиск с обнаружением электронных данных на месте, созданный на шаге 3, и нажмите кнопку **изменить** ![значок](media/O365_MDM_CreatePolicy_EditIcon.gif)редактирования.
    
3. На странице **Удержание на месте** установите флажок **Поставить содержимое выбранных почтовых ящиков, соответствующее поисковому запросу, на удержание**, а затем выберите один из следующих параметров: 
    
  - **Хранить бессрочно** — выберите этот параметр, чтобы поместить элементы, возвращаемые поиском, в неопределенное удержание. Такие элементы будут храниться до удаления почтового ящика из поиска или до удаления поиска. 
    
  - **Укажите количество дней хранения элементов относительно даты получения** — выберите этот параметр, чтобы удерживать элементы для определенного периода. Длительность будет вычислена с даты получения или создания элемента почтового ящика. 
    
4. Нажмите кнопку **Сохранить**, чтобы создать запрос на удержание на месте, а затем повторите поиск. 
    
[Return to top](use-content-search-in-ediscovery.md#top)
  
### <a name="copy-the-search-results"></a>Копирование результатов поиска

1. In the EAC, go to **Compliance management** \> **In-Place eDiscovery &amp; Hold**.
    
2. В списке выберите поиск с обнаружением электронных данных на месте, созданный на шаге 3.
    
3. Щелкните **** ![значок](media/5f6f9463-50e9-460b-8738-b67e759c2efc.gif)поиска поиска, а затем в раскрывающемся списке выберите команду **Копировать результаты поиска** . 
    
4. В окне **Копировать результаты поиска** выберите один из следующих вариантов:
    
    - **Включить элементы** , не включаемые в Поиск — установите этот флажок, чтобы включить элементы почтовых ящиков, для которых не удалось выполнить поиск (например, сообщения с вложениями типов файлов, которые не удалось индексировать при поиске Exchange). 
    
    - **Enable un— Дедупликация** — установите этот флажок, чтобы исключить повторяющиеся сообщения. В почтовый ящик найденных сообщений будет копироваться только один экземпляр сообщения. 
    
    - **Включить полное ведение журнала** — установите этот флажок, чтобы включить полный журнал в результаты поиска. 
    
    - **Отправить мне сообщение после завершения копирования** — установите этот флажок, чтобы получать уведомление по завершении поиска. 
    
    - **Копировать результаты в этот почтовый ящик обнаружения** нажмите кнопку **Обзор** , чтобы выбрать почтовый ящик найденных сообщений, в который нужно скопировать результаты поиска. 
    
5. Нажмите кнопку **Копировать**, чтобы начать процесс копирования результатов поиска в указанный почтовый ящик найденных сообщений. 
    
6. Нажмите кнопку **Обновить** ![значок](media/O365-MDM-Policy-RefreshIcon.gif) обновления, чтобы обновить информацию о состоянии копирования, отображаемую в области сведений. 
    
7. После завершения копирования нажмите кнопку **Открыть**, чтобы открыть почтовый ящик найденных сообщений для просмотра результатов поиска. 
  
### <a name="export-the-search-results"></a>Экспорт результатов поиска

1. In the EAC, go to **Compliance management** \> **In-Place eDiscovery &amp; Hold**.
    
2. В списке выберите запрос на поиск с обнаружением электронных данных на месте, созданный на шаге 3, и нажмите кнопку **Экспорт в PST-файл**.
    
3. В окне **Средства экспорта PST eDiscovery** выполните следующие действия: 
    
    - Нажмите кнопку **Обзор**, чтобы указать, откуда нужно загрузить PST-файл. 
    
    - Установите флажок **Включить дедупликацию**, чтобы исключить повторяющиеся сообщения. В PST-файл будет включен только один экземпляр сообщения. 
    
    - Установите флажок **Включить элементы, недоступные для поиска**, чтобы добавить недоступные для поиска элементы почтовых ящиков (например, сообщения с вложенными файлами таких типов, которые не могут быть индексированы при поиске в Exchange). Недоступные для поиска элементы экспортируются в отдельный PST-файл. 
    
4. Нажмите кнопку **Начать**, чтобы экспортировать результаты поиска в PST-файл. 
    
    Откроется окно, содержащее сведения о состоянии экспорта.
