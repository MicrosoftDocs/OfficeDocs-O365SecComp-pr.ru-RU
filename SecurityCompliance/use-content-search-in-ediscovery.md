---
title: Поиск содержимого при обнаружении электронных данных
ms.author: markjjo
author: markjjo
manager: laurawi
ms.date: 12/30/2016
ms.audience: Admin
ms.topic: article
ms.service: o365-administration
localization_priority: Normal
search.appverid:
- MET150
ms.assetid: 55f31488-288a-473a-9b9e-831a11e3711a
description: 'Использование скрипта PowerShell для создания поискового запроса на локальное обнаружение электронных данных в Exchange Online на основании поиска, созданные в Office 365 безопасность &amp; центре соответствия требованиям. '
ms.openlocfilehash: d2f4f845e8c819eed67c3a234bff208a11fb571c
ms.sourcegitcommit: 36c5466056cdef6ad2a8d9372f2bc009a30892bb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/27/2018
ms.locfileid: "22534909"
---
# <a name="use-content-search-in-your-ediscovery-workflow"></a>Поиск содержимого при обнаружении электронных данных

Компонент поиска контента в Office 365 безопасность &amp; центре соответствия требованиям позволяет выполнять поиск всех почтовых ящиков в организации. В отличие от электронного обнаружения на месте в Exchange Online (где можно выполнить поиск до 10 000 почтовых ящиков) не предусмотрено ограничений для количество почтовых ящиков конечного одним. Для сценариев, где требуется выполнение поиска по всей организации можно использовать поиск контента для поиска всех почтовых ящиков. Затем можно использовать возможности рабочего процесса электронного обнаружения на месте для выполнения других задач, связанных с обнаружения электронных данных, таких как размещение почтовые ящики на хранение и результатов поиска в экспорт. Например предположим, необходимо выполнить поиск всех почтовых ящиков для идентификации определенного custodians, которые реагирует на юридических дела. Поиск контента можно использовать в системы &amp; центре соответствия требованиям для поиска всех почтовых ящиков в организации, чтобы определить те, которые реагирует на регистр. Затем можно использовать этот список почтовых ящиков custodian как исходных почтовых ящиков для поиска обнаружения электронных данных на месте в Exchange Online. С помощью электронного обнаружения на месте позволяет блокировка этих исходных почтовых ящиков и копирование результатов поиска в почтовый ящик обнаружения экспортировать результаты поиска.
  
Этот раздел содержит скрипт, который можно запустить для создания поискового запроса на локальное обнаружение электронных данных в Exchange Online с помощью список исходных почтовых ящиков и запросов поиска из поиска, созданные в системы &amp; центре соответствия требованиям. Ниже приведен обзор процесса:
  
[Шаг 1. Создание запроса на поиск содержимого по всем почтовым ящикам в организации](#step-1-create-a-content-search-to-search-all-mailboxes-in-your-organization)

[Шаг 2: Подключение к безопасности &amp; центре соответствия требованиям и Exchange Online в одном удаленного сеанса PowerShell](#step-2-connect-to-the-security-amp-compliance-center-and-exchange-online-in-a-single-remote-powershell-session)
  
[Шаг 3. Запуск сценария для создания запроса на обнаружение электронных данных на месте, в основе которого лежит поиск содержимого](#step-3-run-the-script-to-create-an-in-place-ediscovery-search-from-the-content-search)

[Шаг 4. Запуск поиска с обнаружением электронных данных на месте](#step-4-start-the-in-place-ediscovery-search)

## <a name="step-1-create-a-content-search-to-search-all-mailboxes-in-your-organization"></a>Шаг 1. Создание запроса на поиск содержимого по всем почтовым ящикам в организации

Первым этапом является использование защиты &amp; центре соответствия требованиям (или безопасность и соответствие требованиям центр PowerShell) для создания поиска контента, который осуществляет поиск по всем почтовым ящикам в организации. Нет ограничений для количество почтовых ящиков для одного поиска контента. Укажите запрос на соответствующее ключевое слово (или запрос для типов конфиденциальной информации), чтобы поиск возвращает только тех исходных почтовых ящиков важные для расследования. При необходимости уточнения запросов поиска, чтобы сузить результаты поиска и исходных почтовых ящиков, которые возвращаются.
  
> [!NOTE]
> Если ничего не найдено, операция обнаружения электронных данных на месте не будет создана при выполнении сценария на шаге 3. Возможно, потребуется изменить поисковый запрос, а затем повторить поиск содержимого. 
  
### <a name="use-the-security-amp-compliance-center-to-search-all-mailboxes"></a>Использование безопасности &amp; центре соответствия требованиям для поиска всех почтовых ящиков

1. [Откройте раздел безопасность Office 365 &amp; центре соответствия требованиям](go-to-the-securitycompliance-center.md). 
    
2. Нажмите кнопку **поиска &amp; расследования**, нажмите кнопку **Поиск контента**и нажмите кнопку **Создать** ![значком Добавить](media/O365-MDM-CreatePolicy-AddIcon.gif).
    
3. На странице **Новый поиск** введите имя запроса на поиск содержимого. 
    
4. В разделе **Где нужно искать?** выберите **Поиск во всех почтовых ящиках** и нажмите кнопку **Далее**.
    
5. В поле в разделе **необходимые действия "мне нравится" следует искать?**, введите в поле запрос поиска. Можно указать ключевые слова, сообщение свойства, например, отправленных и полученных даты, или свойств документа, таких как имена файлов или Дата последнего изменения документа. Можно использовать более сложные запросы, не используйте логический оператор, например и, или или РЯДОМ, или можно также выполнить поиск конфиденциальной информации (например, номера социального страхования) в сообщениях. Дополнительные сведения о создании поисковых запросов можно [запросах по ключевым словам для поиска контента](keyword-queries-and-search-conditions.md).
    
6. Щелкните **Поиск**, чтобы сохранить параметры поиска и начать поиск. 
    
    Через некоторое время оценку результатов поиска, отображаемые в области сведений. Оценка включает в себя общего размера и числа элементов для результатов поиска. После завершения поиска можно выполнить предварительный просмотр результатов поиска. При необходимости нажмите кнопку **Обновить**![значок обновления](media/O365-MDM-Policy-RefreshIcon.gif) для обновления данных в области сведений. 
    
7.  При необходимости уточните поисковый запрос, чтобы сузить область результатов поиска, а затем повторите поиск. 
    
### <a name="use-security--compliance-center-powershell-to-search-all-mailboxes"></a>Использование безопасности и соответствия требованиям центр PowerShell для поиска всех почтовых ящиков

Также можно использовать командлет **New-ComplianceSearch** для поиска всех почтовых ящиков в организации. Первым шагом является [подключение к Office 365 безопасность &amp; PowerShell центр соответствия](https://go.microsoft.com/fwlink/p/?LinkID=627084).
  
Ниже приведен пример использования PowerShell для поиска всех почтовых ящиков в организации. Поисковый запрос возвращает все сообщения, отправленные между 1 января 2015 и 30 июня 2015, которые содержат фразу «финансовых отчетов» в строке темы. Первая команда создает поиск, и вторая команда запускается поиск. 
  
```
New-ComplianceSearch -Name "Search All-Financial Report" -ExchangeLocation all -ContentMatchQuery 'sent>=01/01/2015 AND sent<=06/30/2015 AND subject:"financial report"'
```

```
Start-ComplianceSearch -Identity "Search All-Financial Report"
```

Дополнительные сведения см. в статье [New-ComplianceSearch](https://go.microsoft.com/fwlink/p/?LinkId=517935).
  
### <a name="verify-the-number-of-source-mailboxes-in-the-content-search"></a>Проверка количества исходных почтовых ящиков в запросе на поиск содержимого

Поиск контента возвращает не более 1 000 почтовых ящиков источника, содержащих результаты поиска. При наличии более 1000 почтовых ящиков, которые содержат контента, отвечающей поисковому запросу, только в начало 1 000 почтовых ящиков с большинства результатов поиска включаются в поиск содержимого, созданной на предыдущем шаге. Поэтому если более 1000 почтовых ящиков содержит результаты поиска, некоторые из этих почтовых ящиков не включены в список исходных почтовых ящиков скопирован в новый поиск обнаружения электронных данных на месте, созданные в шаге 3. 
  
Для создания поиска контента с не более 1 000 исходных почтовых ящиков, выполните следующие действия для запуска скрипта, который отображает количество исходных почтовых ящиков (, содержащих результаты поиска), возвращенных в результате поиска контента, созданной на шаге 1. 
  
1. Сохраните следующий текст в файл сценария PowerShell с помощью суффикса имени файла .ps1. Например, можно сохранить в файл с именем `SourceMailboxes.ps1`.
    
  ```
  [CmdletBinding()]
  Param(
      [Parameter(Mandatory=$True,Position=1)]
      [string]$SearchName
  )
  $search = Get-ComplianceSearch $SearchName
  if ($search.Status -ne "Completed")
  {
                  "Please wait until the search finishes.";
                  break;
  }
  $results = $search.SuccessResults;
  if (($search.Items -le 0) -or ([string]::IsNullOrWhiteSpace($results)))
  {
                  "The Content Search " + $SearchName + " didn't return any useful results.";
                  break;
  }
  $mailboxes = @();
  $lines = $results -split '[\r\n]+';
  foreach ($line in $lines)
  {
      if ($line -match 'Location: (\S+),.+Item count: (\d+)' -and $matches[2] -gt 0)
      {
          $mailboxes += $matches[1];
      }
  }
  "Number of mailboxes that have search hits: " + $mailboxes.Count
  ```

2. В безопасности и соответствия требованиям центр PowerShell перейдите к папке, где находится сценарий, созданный на предыдущем шаге и запустите сценарий; Например:
    
    ```
    .\SourceMailboxes.ps1
    ```

3. Когда вам это будет предложено, введите имя запроса на поиск содержимого, созданного на шаге 1.
    
    Сценарий отобразит количество исходных почтовых ящиков, которые содержат результаты поиска.
    
При наличии более 1000 исходных почтовых ящиков, попробуйте создать два (или более) контента поиска. К примеру поиск половину почтовых ящиков вашей организации в один поиска контента и вторая в другой поиска контента. Можно также изменить критерии поиска, чтобы уменьшить количество почтовых ящиков, которые содержат результатов поиска. Например может включать диапазон дат или уточнения запроса ключевого слова.
  
## <a name="step-2-connect-to-the-security-amp-compliance-center-and-exchange-online-in-a-single-remote-powershell-session"></a>Шаг 2: Подключение к безопасности &amp; центре соответствия требованиям и Exchange Online в одном удаленного сеанса PowerShell

Следующим шагом является подключение Windows PowerShell для обоих безопасности &amp; центре соответствия требованиям и организацию Exchange Online. Это необходимо, так как для сценариев, которые выполняются на шаге 3 требуется доступ к командлетам поиска контента в системы &amp; центре соответствия требованиям и командлеты обнаружения электронных данных на месте в Exchange Online.
  
1. Сохраните следующий текст в файл сценария Windows PowerShell с помощью суффикса имени файла .ps1. Например, можно сохранить в файл с именем `ConnectEXO-CC.ps1`.
    
    ```
    $UserCredential = Get-Credential
    $Session = New-PSSession -ConfigurationName Microsoft.Exchange -ConnectionUri https://ps.outlook.com/powershell-liveid -Credential $UserCredential -Authentication Basic -AllowRedirection
    Import-PSSession $Session -DisableNameChecking
    $Session = New-PSSession -ConfigurationName Microsoft.Exchange -ConnectionUri https://ps.compliance.protection.outlook.com/powershell-liveid -Credential $UserCredential -Authentication Basic -AllowRedirection
    Import-PSSession $Session -AllowClobber -DisableNameChecking
    $Host.UI.RawUI.WindowTitle = $UserCredential.UserName + " (Exchange Online + Compliance Center)"
    ```

2. На локальном компьютере откройте Windows PowerShell, перейдите к папке, где находится сценарий, созданный на предыдущем шаге и затем запустите сценарий; Например:
    
    ```
    .\ConnectEXO-CC.ps1
    ```

Как узнать, если это работает? После запуска сценария командлеты из безопасности &amp; центре соответствия требованиям и Exchange Online могут быть импортированы в локальный сеанс PowerShell. Если сообщений об ошибках нет, то подключение успешно. Быстрой проверки должна выполняться безопасности &amp; центре соответствия требованиям командлета —, например **Install-UnifiedCompliancePrerequisite** — и Exchange Online командлета, таких как **Get-Mailbox**. 
  
## <a name="step-3-run-the-script-to-create-an-in-place-ediscovery-search-from-the-content-search"></a>Шаг 3. Запуск сценария для создания запроса на обнаружение электронных данных на месте, в основе которого лежит поиск содержимого

После создания двух сеанс PowerShell на шаге 2, следующим шагом является выполнение скрипта, который преобразует существующего контента поиска для поиска методом электронного обнаружения на месте. Вот что означает скрипта:
  
- Запрашивает имя запроса на поиск содержимого, который требуется преобразовать.
    
- Проверяет, завершен ли поиск содержимого. Если ничего не найдено, запрос на обнаружение электронных данных на месте не будет создан.
    
- Сохраняет в переменной список тех исходных почтовых ящиков из запроса на поиск содержимого, которые содержат результаты поиска.
    
- Создает поиск с обнаружением электронных данных на месте с указанными ниже свойствами. Обратите внимание, что новый поиск не запускается. Он запускается на шаге 4.
    
  - **Имя** — имя нового поиска используется в этом формате: \<имя поиска контента\>_MBSearch1. Если снова запустить сценарий и использовать тот же источник контента поиска с именем поиска \<имя поиска контента\>_MBSearch2.
    
  - **Исходные почтовые ящики** - всех почтовых ящиков из поиска контента, содержащих результаты поиска. 
    
  - **Поисковый запрос** - новый поиск с помощью запросов поиска из поиска контента. Если содержимое поиска включает в себя весь контент (где запросов поиска не заполнено) новый поиск также будет иметь пустой поискового запроса и будет включать все содержимое, обнаруженных в исходных почтовых ящиков. 
    
  - **Оценка только поиска** - новый поиск отмечен как только для оценки поиска. Он не будет копирование результатов поиска в почтовый ящик обнаружения после его запуска. 
    
1. Сохраните следующий текст в файл сценария Windows PowerShell с помощью суффикса имени файла ps1. Например, можно сохранить в файл с именем `CreateMBSearchFromComplianceSearch.ps1`.
    
  ```
  [CmdletBinding()]
  Param(
      [Parameter(Mandatory=$True,Position=1)]
      [string]$SearchName,
      [switch]$original,
      [switch]$restoreOriginal
  )
  $search = Get-ComplianceSearch $SearchName
  if ($search.Status -ne "Completed")
  {
    "Please wait until the search finishes";
    break;
  }
  $results = $search.SuccessResults;
  if (($search.Items -le 0) -or ([string]::IsNullOrWhiteSpace($results)))
  {
    "The Content Search " + $SearchName + " didn't return any useful results";
    "A mailbox search object wasn't created";
    break;
  }
  $mailboxes = @();
  $lines = $results -split '[\r\n]+';
  foreach ($line in $lines)
  {
      if ($line -match 'Location: (\S+),.+Item count: (\d+)' -and $matches[2] -gt 0)
      {
          $mailboxes += $matches[1];
      }
  }
  $msPrefix = $SearchName + "_MBSearch";
  $I = 1;
  $mbSearches = Get-MailboxSearch;
  while ($true)
  {
      $found = $false;
      $mbsName = "$msPrefix$I";
      foreach ($mbs in $mbSearches)
      {
          if ($mbs.Name -eq $mbsName)
          {
              $found = $true;
              break;
          }
      }
      if (!$found)
      {
          break;
      }
      $I++;
  }
  $query = $search.KeywordQuery;
  if ([string]::IsNullOrWhiteSpace($query))
  {
      $query = $search.ContentMatchQuery;
  }
  if ([string]::IsNullOrWhiteSpace($query))
  {
    New-MailboxSearch "$msPrefix$i" -SourceMailboxes $mailboxes -EstimateOnly;
  }
  else
  {
    New-MailboxSearch "$msPrefix$i" -SourceMailboxes $mailboxes -SearchQuery $query -EstimateOnly;
  }
  
  ```

2. Во время сеанса Windows PowerShell, созданный на шаге 2 Перейдите к папке, где находится сценарий, созданный на предыдущем шаге и запустите сценарии; Например:
    
    ```
    .\CreateMBSearchFromComplianceSearch.ps1
    ```

3. При появлении запроса с помощью сценария введите имя поиска контента, который требуется преобразовать в поиск обнаружения электронных данных на месте (например, поиска, созданной на шаге 1) и нажмите клавишу **Ввод**.
    
    При успешном выполнении сценария создается поиск с обнаружением электронных данных на месте с состоянием **NotStarted**. Выполните команду  `Get-MailboxSearch <Name of Content Search>_MBSearch1 | FL`, чтобы отобразить свойства нового поиска. 
  
## <a name="step-4-start-the-in-place-ediscovery-search"></a>Шаг 4. Запуск поиска с обнаружением электронных данных на месте

Сценарий, выполняемый на шаге 3, создает запрос на поиск с обнаружением электронных данных на месте, но не запускает его. Теперь необходимо запустить поиск, чтобы получить оценку его результатов.
  
1. В центре администрирования Exchange (EAC) перейдите к **разделу Управление соответствием требованиям** \> **In-Place eDiscovery &amp; хранения**.
    
2. В списке выберите поиск с обнаружением электронных данных на месте, созданный на шаге 3.
    
3. Щелкните **Поиск** ![значок поиска](media/5f6f9463-50e9-460b-8738-b67e759c2efc.gif) \> **оценки результатов поиска** для запуска службы поиска и возврата оценку общего размера и количества элементов, возвращенных в результате поиска. 
    
    Оценки отображаются в области сведений. Нажмите кнопку **Обновить** ![значок обновления](media/O365-MDM-Policy-RefreshIcon.gif) обновить сведения, отображаемые в области сведений. 
    
4. Для предварительного просмотра результатов после завершения поиска нажмите кнопку **Предварительный просмотр результатов поиска** в области сведений.
  
## <a name="next-steps-after-creating-and-running-the-in-place-ediscovery-search"></a>Действия после создания и запуска поиска с обнаружением электронных данных на месте

После создания и запуска поиска с обнаружением электронных данных на месте, который был создан с помощью сценария на шаге 3, можно выполнять различные стандартные действия над результатами поиска.
  
### <a name="create-an-in-place-hold"></a>Создание хранения на месте

1. В центре администрирования Exchange перейдите к **разделу Управление соответствием требованиям** \> **In-Place eDiscovery &amp; хранения**.
    
2. В представлении списка выберите Поиск обнаружения электронных данных на месте, созданной на шаге 3 и нажмите кнопку **Изменить** ![значок Правка](media/O365_MDM_CreatePolicy_EditIcon.gif).
    
3. На странице **Удержание на месте** установите флажок **Поставить содержимое выбранных почтовых ящиков, соответствующее поисковому запросу, на удержание**, а затем выберите один из следующих параметров: 
    
  - **Удержании неопределенное время** — выберите этот параметр, чтобы поместить элементы, возвращенные операцией поиска на неограниченное удержание. До удаления почтового ящика из поиска или удалить поиск элементов на удержании будут сохранены. 
    
  - **Укажите число дней для хранения элементов, относящиеся к их Дата получения** — выберите этот параметр для хранения элементов в течение определенного периода. Во время выполнения рассчитывается из даты, полученного или созданного элемента почтового ящика. 
    
4. Нажмите кнопку **Сохранить**, чтобы создать запрос на удержание на месте, а затем повторите поиск. 
    
[Return to top](use-content-search-in-ediscovery.md#top)
  
### <a name="copy-the-search-results"></a>Копирование результатов поиска

1. В центре администрирования Exchange перейдите к **разделу Управление соответствием требованиям** \> **In-Place eDiscovery &amp; хранения**.
    
2. В списке выберите поиск с обнаружением электронных данных на месте, созданный на шаге 3.
    
3. Щелкните **Поиск** ![значок поиска](media/5f6f9463-50e9-460b-8738-b67e759c2efc.gif)и нажмите кнопку **Копировать результаты поиска** из раскрывающегося списка. 
    
4. В окне **Копировать результаты поиска** выберите один из следующих вариантов:
    
    - **Включить не включаемые элементы** — установите этот флажок, чтобы включить элементы почтовых ящиков, которые не удалось найти (например, сообщения с вложениями типов файлов, которые невозможно индексировать службой поиска Exchange). 
    
    - **Включение дедупликация** — установите этот флажок, чтобы исключить повторяющиеся сообщения. Только один экземпляр сообщение будет копировать в почтовый ящик обнаружения. 
    
    - **Ведение журнала в полный** — установите этот флажок для включения журнала full сохраняется в результатах поиска. 
    
    - **Отправлять почту после завершения эту копию** — установите этот флажок, чтобы получить уведомление по электронной почте после завершения поиска. 
    
    - **Копирование результатов для этого почтового ящика обнаружения** - нажмите кнопку **Обзор** , чтобы выбрать почтового ящика обнаружения, где будут результаты поиска скопирован. 
    
5. Нажмите кнопку **Копировать**, чтобы начать процесс копирования результатов поиска в указанный почтовый ящик найденных сообщений. 
    
6. Нажмите кнопку **Обновить** ![значок обновления](media/O365-MDM-Policy-RefreshIcon.gif) для обновления сведений о ходе выполнения копирования, который отображается в области сведений. 
    
7. После завершения копирования нажмите кнопку **Открыть**, чтобы открыть почтовый ящик найденных сообщений для просмотра результатов поиска. 
  
### <a name="export-the-search-results"></a>Экспорт результатов поиска

1. В центре администрирования Exchange перейдите к **разделу Управление соответствием требованиям** \> **In-Place eDiscovery &amp; хранения**.
    
2. В списке выберите запрос на поиск с обнаружением электронных данных на месте, созданный на шаге 3, и нажмите кнопку **Экспорт в PST-файл**.
    
3. В окне **Средство экспорта PST обнаружения электронных данных** выполните следующие действия: 
    
    - Нажмите кнопку **Обзор**, чтобы указать, откуда нужно загрузить PST-файл. 
    
    - Установите флажок **Включить дедупликацию**, чтобы исключить повторяющиеся сообщения. В PST-файл будет включен только один экземпляр сообщения. 
    
    - Установите флажок **Включить элементы, недоступные для поиска.**, чтобы добавить недоступные для поиска элементы почтовых ящиков (например, сообщения с вложенными файлами таких типов, которые не могут быть индексированы поиском Exchange). Недоступные для поиска элементы экспортируются в отдельный PST-файл. 
    
4. Нажмите кнопку **Начать** для экспорта результатов поиска в PST-файл. 
    
    Откроется окно со сведениями о состоянии процесса экспорта.
