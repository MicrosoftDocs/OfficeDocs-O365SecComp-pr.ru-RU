---
title: Аудит общего доступа с помощью журнала аудита Office 365
ms.author: markjjo
author: markjjo
manager: laurawi
ms.date: ''
audience: Admin
ms.topic: article
ms.service: O365-seccomp
localization_priority: Normal
search.appverid:
- SPO160
- MOE150
- BCS160
- MET150
ms.collection: M365-security-compliance
ms.assetid: 50bbf89f-7870-4c2a-ae14-42635e0cfc01
description: 'Общий доступ является ключевым действием в SharePoint Online и OneDrive для бизнеса. Теперь администраторы могут использовать аудит общего доступа в журнале аудита Office 365 для определения ресурсов, доступ к которым имеют пользователи вне Организации. '
ms.openlocfilehash: 48fc1a67f501c807e76ba2333170df83a1248428
ms.sourcegitcommit: 60c701e9808d505cf96990d0643be10b8fbc0180
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/16/2019
ms.locfileid: "36447366"
---
# <a name="use-sharing-auditing-in-the-office-365-audit-log"></a>Аудит общего доступа с помощью журнала аудита Office 365

Общий доступ является ключевым действием в SharePoint Online и OneDrive для бизнеса, который широко используется в организациях Office 365. Администраторы могут использовать аудит общего доступа в журнале аудита Office 365, чтобы определить, как общий доступ используется в Организации. 
  
## <a name="the-sharepoint-sharing-schema"></a>Схема общего доступа SharePoint

События общего доступа (не включая события, связанные с общими политиками и ссылками для совместного доступа) отличаются от событий, связанных с файлами и папками, одним из основных способов: один пользователь выполняет действие, которое оказывает действие на другом пользователе. Например, когда пользователь ресурса A предоставляет пользователю б доступ к файлу. В этом примере пользователь а является *действующим пользователем* , а пользователь б — конечным *пользователем*. В схеме файлов SharePoint действие действующего пользователя влияет только на сам файл. Когда пользователь а открывает файл, в событии **филеакцессед** требуются только сведения о действующем пользователе. Чтобы устранить это различие, существует отдельная схема, называемая схемой *общего доступа SharePoint*, которая захватывает дополнительные сведения о событиях общего доступа. Это гарантирует, что администраторы могут видеть, кто предоставил общий доступ к ресурсу, а также к пользователю, к которому предоставлен общий доступ к ресурсу. 
  
Схема общего доступа предоставляет два дополнительных поля в записи аудита, связанные с событиями общего доступа: 
  
- **Таржетусерорграуптипе:** Определяет, является ли целевой пользователь или группа участником, гостем, Шарепоинтграуп, SecurityGroup или партнером.

- **Таржетусерорграупнаме:** Сохранение имени участника-пользователя или группы, которым предоставлен общий доступ к ресурсу (пользователь б в предыдущем примере). 

Эти два поля в дополнение к другим свойствам схемы журнала аудита Office 365, например user, Operation и Date, могут сообщить полное описание *того* *, какой* пользователь предоставил ресурс, с *которым* и *когда*. 
  
Существует еще одно свойство схемы, которое важно для общего описания. При экспорте результатов поиска в журнале аудита в столбце **аудитдата** в ЭКСПОРТИРУЕМом CSV-файле хранятся сведения о событиях общего доступа. Например, если пользователь предоставляет доступ к сайту другому пользователю, это достигается путем добавления конечного пользователя в группу SharePoint. В столбце **аудитдата** эта информация захватывается для предоставления контекста администраторам. Инструкции по анализу сведений в столбце **аудитдата** приведены в [шаге 2](#step-2-use-the-powerquery-editor-to-format-the-exported-audit-log) .

## <a name="sharepoint-sharing-events"></a>События общего доступа к SharePoint

Общий доступ определяется, когда пользователь (действующий ** пользователь) хочет предоставить ресурс другому пользователю (конечному пользователю). ** Записи аудита, связанные с предоставлением общего доступа к ресурсу с внешним пользователем (пользователь, который находится за пределами вашей организации и не имеет гостевой учетной записи в Azure Active Directory организации), идентифицируются по следующим событиям, которые регистрируются в Office 365 журнал аудита:

- **Шарингинвитатионкреатед:** Пользователь в Организации попытался предоставить общий доступ к ресурсу (вероятно, к сайту) с внешним пользователем. В результате внешнее приглашение к совместному использованию отправляется конечному пользователю. В данный момент доступ к ресурсу не предоставляется.

- **Шарингинвитатионакцептед:** Внешний пользователь принял приглашение к совместному использованию, отправленное действующим пользователем, и теперь получил доступ к ресурсу.

- **Анонимауслинккреатед:** Для ресурса создается Анонимная ссылка (также называемая ссылкой "кому угодно"). Так как можно создать и скопировать анонимную ссылку, разумно предположить, что к любому документу, к которому применена Анонимная ссылка, предоставлен доступ конечному пользователю.

- **Анонимауслинкусед:** Как следует из названия, это событие записывается в журнал при использовании анонимной ссылки для доступа к ресурсу. 

- **Секурелинккреатед:** Пользователь создал ссылку "определенные пользователи" для предоставления общего доступа к ресурсу определенному человеку. Конечный пользователь может быть пользователем, который является внешним по отношению к вашей организации. Лицо, которому предоставлен общий доступ к ресурсу, определено в записи аудита для события **аддедтосекурелинк** . Метки времени для этих двух событий практически идентичны.

- **Аддедтосекурелинк:** Пользователь добавлен в определенную ссылку "люди". Используйте поле **таржетусерорграупнаме** в этом событии, чтобы определить пользователя, добавленного в соответствующую ссылку на пользователей. Конечный пользователь может быть пользователем, который является внешним по отношению к вашей организации.

## <a name="sharing-auditing-work-flow"></a>Общий доступ к рабочему процесс аудита
  
Когда пользователь (действующий пользователь) хочет предоставить доступ к ресурсу другому пользователю (конечному пользователю), SharePoint (или OneDrive для бизнеса), сначала проверяется, связан ли адрес электронной почты конечного пользователя с учетной записью пользователя в каталоге Организации. Если целевой пользователь находится в каталоге (с соответствующей учетной записью пользователя гостя), SharePoint выполняет следующие действия:
  
-  Немедленно назначает разрешения конечного пользователя на доступ к ресурсу, добавляя конечного пользователя в соответствующую группу SharePoint и записывает событие **аддедтограуп** . 
    
- Отправляет уведомление о совместном доступе на адрес электронной почты целевого пользователя.
    
- Заносит в журнал событие **общего доступа** . Это событие имеет понятное имя "общий файл, папка или сайт" в разделе **действия запросов на общий доступ и доступ** в средстве выбора действий средства поиска журнала аудита. На [шаге 1](#step-1-search-for-sharing-events-and-export-the-results-to-a-csv-file)Просмотрите снимок экрана. 
    
Если учетная запись пользователя конечного пользователя не находится в каталоге, SharePoint выполняет следующие действия: 
    
   - Записывает в журнал одно из следующих событий в зависимости от того, как общий доступ к ресурсу:
   
      - **анонимауслинккреатед**
   
      - **секурелинккреатед**
   
      - **аддедтосекурелинк** 

      - **Шарингинвитатионкреатед** (это событие заносится в журнал только в том случае, если общий ресурс является сайтом)
    
   - Когда целевой пользователь принимает приглашение к совместному использованию, отправленное им (щелкнув ссылку в приглашении), SharePoint заносит в журнал событие **шарингинвитатионакцептед** и назначает целевому пользователю разрешения на доступ к ресурсу. Если конечному пользователю отправляется Анонимная ссылка, событие **анонимауслинкусед** записывается после того, как целевой пользователь применяет ссылку для доступа к ресурсу. Для безопасных ссылок событие **филеакцессед** записывается, когда внешний пользователь использует ссылку для доступа к ресурсу.

Кроме того, регистрируется дополнительная информация о целевом пользователе, например идентификатор пользователя, которому будет предложено приглашение, и пользователя, который принимает приглашение. В некоторых случаях эти пользователи (или адреса электронной почты) могут различаться. 

## <a name="how-to-identify-resources-shared-with-external-users"></a>Как определить ресурсы, к которым предоставлен доступ внешним пользователям

Для администраторов распространенным требованием является создание списка всех ресурсов, к которым предоставлен доступ пользователям за преданной Организацией. С помощью аудита общего доступа в Office 365 администраторы могут создать этот список. Ниже приведено описание процедуры.
  
### <a name="step-1-search-for-sharing-events-and-export-the-results-to-a-csv-file"></a>Шаг 1: Поиск событий общего доступа и экспорт результатов в CSV-файл

Первым шагом является поиск событий общего доступа в журнале аудита Office 365. Дополнительные сведения (в том числе необходимые разрешения), связанные с поиском в журнале аудита, можно найти в статье [Поиск в журнале аудита в центре безопасности & соответствия требованиям](search-the-audit-log-in-security-and-compliance.md).
  
1. Перейдите по ссылке [https://protection.office.com](https://protection.office.com).
    
2. Войдите в Office 365 с помощью своей рабочей или учебной учетной записи.
    
3. В левой области центра безопасности & соответствия требованиям выберите ****  > Поиск по**журналу аудита**.
    
    Отображается страница " **Поиск журнала аудита** ". 
    
4. В разделе **действия**щелкните **действия общего доступа и доступа к запросам** на поиск событий, связанных с общим доступом. 
    
    ![В разделе действия выберите действия общего доступа и запросов на доступ](media/46bb25b7-1eb2-4adf-903a-cc9ab58639f9.png)
  
5.  Выберите диапазон дат и времени, чтобы найти события общего доступа, произошедшие в течение этого периода. 
    
6. Нажмите кнопку **Поиск** , чтобы выполнить поиск. 
    
7. После завершения поиска и отображения результатов нажмите кнопку **Экспорт результатов** \> **скачать все результаты**.
    
    После выбора варианта экспорта в нижней части окна появится сообщение, предлагающее открыть или сохранить CSV-файл.
    
8. Нажмите кнопку **сохранить** \> **Сохранить как** и сохраните CSV-файл в папке на локальном компьютере. 

### <a name="step-2-use-the-powerquery-editor-to-format-the-exported-audit-log"></a>Шаг 2: использование редактора Поверкуери для форматирования экспортированного журнала аудита

Следующий шаг — использование функции преобразования JSON в редакторе Power Query в Excel для разделения каждого свойства в столбце **аудитдата** (который состоит из многозначного объекта JSON) в отдельный столбец. Это позволяет фильтровать столбцы, чтобы просматривать записи, связанные с общим доступом.

Пошаговые инструкции приведены в разделе "шаг 2: форматирование экспортированного журнала аудита с помощью редактора Power Query Editor" в разделе [Экспорт, Настройка и просмотр записей журнала аудита](export-view-audit-log-records.md#step-2-format-the-exported-audit-log-using-the-power-query-editor).

### <a name="step-3-filter-the-csv-file-for-resources-shared-with-external-users"></a>Шаг 3: Фильтрация CSV-файла для ресурсов, к которым предоставлен доступ внешним пользователям

Следующий шаг — фильтрация CSV для различных событий, связанных с общим доступом, описанных ранее в разделе Общие сведения о [событиях SharePoint](#sharepoint-sharing-events) . Кроме того, можно отфильтровать столбец **таржетусерорграуптипе** , чтобы отобразить все записи, для которых значение этого свойства — " **гость**". 

После выполнения инструкций, приведенных на предыдущем шаге, для подготовки CSV-файла с помощью редактора Поверкуери выполните следующие действия:
    
1. Откройте файл Excel, созданный в шаге 2. 

2. На вкладке **Главная** нажмите кнопку **Сортировка & фильтр**, а затем нажмите кнопку **Фильтр**.
    
3. В раскрывающемся списке отсортировать **& фильтра** в столбце **операции** выберите Очистить все, а затем выберите одно или несколько указанных ниже событий, связанных с общим доступом, а затем нажмите кнопку **ОК**.
 
   - **шарингинвитатионкреатед**
   
   - **анонимауслинккреатед**
   
   - **секурелинккреатед**
   
   - **аддедтосекурелинк** 
    
    Excel отображает строки для выбранных событий.
    
4. Перейдите к столбцу с именем **таржетусерорграуптипе** и выберите его. 
    
5. В раскрывающемся списке **сортировать & фильтр** снимите флажок все, а затем выберите **таржетусерорграуптипе: гость**и нажмите кнопку **ОК**.
    
    Теперь в Excel отображаются строки для событий общего доступа и конечных пользователей за пределами Организации, так как внешние пользователи определяются значением **таржетусерорграуптипе: гость**. 
  
> [!TIP]
> Для отображаемых записей аудита в столбце **ObjectID** указывается ресурс, к которому предоставлен общий доступ конечному пользователю; например `ObjectId:https:\/\/contoso-my.sharepoint.com\/personal\/sarad_contoso_com\/Documents\/Southwater Proposal.docx`:.
