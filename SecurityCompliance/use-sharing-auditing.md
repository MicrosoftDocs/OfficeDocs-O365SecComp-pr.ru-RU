---
title: Аудит общего доступа с помощью журнала аудита Office 365
ms.author: markjjo
author: markjjo
manager: laurawi
ms.date: 2/13/2018
audience: Admin
ms.topic: article
ms.service: O365-seccomp
localization_priority: Normal
search.appverid:
- SPO160
- MOE150
- BCS160
- MET150
ms.assetid: 50bbf89f-7870-4c2a-ae14-42635e0cfc01
description: 'Общий доступ является ключевым действием в SharePoint Online и OneDrive для бизнеса. Теперь администраторы могут использовать аудит общего доступа в журнале аудита Office 365, чтобы определить, как общий доступ используется в Организации. '
ms.openlocfilehash: a363ebe2e8b1697521ab5f84df0b3fc221a2abcd
ms.sourcegitcommit: 9d67cb52544321a430343d39eb336112c1a11d35
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/17/2019
ms.locfileid: "34157901"
---
# <a name="use-sharing-auditing-in-the-office-365-audit-log"></a>Аудит общего доступа с помощью журнала аудита Office 365

Общий доступ является ключевым действием в SharePoint Online и OneDrive для бизнеса, который широко используется в организациях Office 365. Теперь администраторы могут использовать аудит общего доступа в журнале аудита Office 365, чтобы определить, как общий доступ используется в Организации. 
  
## <a name="the-sharepoint-sharing-schema"></a>Схема общего доступа SharePoint

События общего доступа (за исключением событий общего доступа и общего доступа к ним) отличаются от событий, связанных с файлами и папками, одним из основных способов: один пользователь предпринимает действия, которые влияют на другого пользователя. Например, пользователь а предоставляет пользователю б доступ к файлу. В этом примере пользователь а является *действующим пользователем* , а пользователь б — конечным *пользователем*. В схеме файлов SharePoint действие действующего пользователя влияет только на сам файл. Когда пользователь а открывает файл, в событии **филеакцессед** требуются только сведения о действующем пользователе. Чтобы устранить это различие, существует отдельная схема, называемая схемой *общего доступа SharePoint*, которая захватывает дополнительные сведения о событиях общего доступа. Это позволяет администраторам получить более подробные сведения о том, кто предоставил общий доступ к ресурсу, а также к пользователю, к которому предоставлен общий доступ к ресурсу. 
  
Схема общего доступа предоставляет два дополнительных поля в журнале аудита, связанные с событиями общего доступа: 
  
- **Таржетусерорграупнаме** — хранит UPN или имя конечного пользователя или группы, к которым предоставлен общий доступ к ресурсу (пользователь б в предыдущем примере). 
    
- **Таржетусерорграуптипе** — указывает, является ли целевой пользователь или группа участником, гостем, группой или партнером. 
    
Эти два поля в дополнение к другим свойствам схемы журнала аудита Office 365, например user, Operation и Date, могут сообщить полное описание *того* *, какой* пользователь предоставил ресурс, с *которым* и *когда*. 
  
Существует еще одно свойство схемы, которое важно для общего описания. Свойство **EVENTDATA** хранит дополнительные сведения о событиях общего доступа. Например, если пользователь предоставляет доступ к сайту другому пользователю, это достигается путем добавления конечного пользователя в группу SharePoint. Свойство **EVENTDATA** записывает эти дополнительные сведения для предоставления контекста администраторам. 

## <a name="the-sharepoint-sharing-model-and-sharing-events"></a>Модель общего доступа и события общего доступа SharePoint

В действительности общий доступ определяется тремя отдельными событиями ****: Sharing, **шарингинвитатионкреатед**и **шарингинвитаитонакцептед**. Ниже показан рабочий процесс, в котором регистрируются события общего доступа в журнале аудита Office 365. 
  
![Схема, в которой работает общий аудит](media/d83dd40f-919b-484f-bfd6-5dc8de31bff6.png)
  
Когда пользователь (действующий пользователь) хочет предоставить доступ к ресурсу другому пользователю (конечному пользователю), SharePoint (или OneDrive для бизнеса), сначала проверяется, связан ли адрес электронной почты конечного пользователя с учетной записью пользователя в каталоге Организации. Если целевой пользователь находится в каталоге Организации, SharePoint выполняет следующие действия:
  
-  Немедленно назначает разрешения конечного пользователя на доступ к ресурсу. 
    
- Отправляет уведомление о совместном доступе на адрес электронной почты целевого пользователя.
    
- Заносит в журнал событие **общего доступа** . 
    
 Если учетная запись пользователя конечного пользователя не находится в каталоге Организации, SharePoint выполняет следующие действия: 
  
- Создает приглашение для совместного доступа и отправляет его на адрес электронной почты конечного пользователя.
    
- Заносит в журнал событие **шарингинвитатионкреатед** . 
    
    > [!NOTE]
    > Событие **шарингинвитатионкреатед** чаще всего связано с внешним или гостевым общим доступом, если целевой пользователь не имеет доступа к общему ресурсу. 
  
Когда целевой пользователь принимает приглашение к совместному использованию, отправленное им (щелкнув ссылку в приглашении), SharePoint заносит в журнал событие **шарингинвитатионакцептед** и назначает целевому пользователю разрешения на доступ к ресурсу. Кроме того, регистрируется дополнительная информация о целевом пользователе, например идентификатор пользователя, которому было отправлено приглашение, и пользователя, который действительно принял приглашение. В некоторых случаях эти пользователи (или адреса электронной почты) могут различаться. 
  

  
## <a name="how-to-identify-resources-shared-with-external-users"></a>Как определить ресурсы, к которым предоставлен доступ внешним пользователям

Для администраторов распространенным требованием является создание списка всех ресурсов, к которым предоставлен доступ пользователям за преданной Организацией. С помощью аудита общего доступа в Office 365 администраторы теперь могут создать этот список. Ниже приведено описание процедуры.
  
### <a name="step-1-search-for-sharing-events-and-export-the-results-to-a-csv-file"></a>Шаг 1: Поиск событий общего доступа и экспорт результатов в CSV-файл

Первым шагом является поиск событий общего доступа в журнале аудита Office 365. Дополнительные сведения (в том числе необходимые разрешения), связанные с поиском в журнале аудита, можно найти [в статье Поиск в журнале аудита в центре безопасности _Амп_ соответствия требованиям](search-the-audit-log-in-security-and-compliance.md).
  
1. Перейдите по ссылке [https://protection.office.com](https://protection.office.com).
    
2. Войдите в Office 365 с помощью своей рабочей или учебной учетной записи.
    
3. В левой области центра безопасности _амп_ соответствие требованиям выберите ****  > Поиск по**журналу аудита**.
    
    Отображается страница " **Поиск журнала аудита** ". 
    
4. В разделе **действия**щелкните **действия общего доступа** , чтобы выполнить поиск только для событий общего доступа. 
    
    ![В разделе действия выберите действия общего доступа](media/46bb25b7-1eb2-4adf-903a-cc9ab58639f9.png)
  
5.  Выберите диапазон дат и времени, чтобы найти события общего доступа, произошедшие в течение этого периода. 
    
6. Нажмите кнопку **Поиск** , чтобы выполнить поиск. 
    
7. После завершения поиска и отображения результатов нажмите кнопку **Экспорт результатов** \> **скачать все результаты**.
    
    После выбора варианта экспорта в нижней части окна отобразится сообщение с предложением открыть или сохранить CSV-файл.
    
8. Нажмите кнопку **сохранить** \> **Сохранить как** и сохраните CSV-файл в папке на локальном компьютере. 
    

  
### <a name="step-2-filter-the-csv-file-for-resources-shared-with-external-users"></a>Шаг 2: Фильтрация CSV-файла для ресурсов, к которым предоставлен доступ внешним пользователям

Следующий шаг состоит в отфильтре CSV для событий **общего доступа** и **шарингинвитатионкреатед** , а также для отображения событий, для которых свойство **таржетусерорграуптипе** является " **гость**". Для этого используется функция Power Query в Excel. Следующая процедура выполняется в Excel 2016. 
  
1. В Excel 2016 откройте пустую книгу.
    
2. Перейдите на вкладку **данные** . 
    
3. Выберите команду **создать запрос** \> **из файла** \> **из CSV**-файла.
    
    ![На вкладке Данные выберите пункт Создать запрос, выберите из файла, а затем выберите из CSV-файла.](media/5170ab34-b449-40ea-bd3f-f1432c1c5973.png)
  
4. Откройте CSV-файл, скачанный в действии 1.
    
    CSV-файл открывается в редакторе запросов. Обратите внимание, что существует четыре столбца: **время**, **пользователь**, **действие**и **сведения**. Столбец **detail** является полем с несколькими свойствами. Следующий шаг — создание нового столбца для каждого свойства в столбце **Detail (сведения** ). 
    
5. Выберите столбец **сведения** , а затем на вкладке **Главная** нажмите кнопку **разделить столбец** \> **по разделителю**.
    
    ![На вкладке Главная выберите команду разделить столбец, а затем щелкните разделитель](media/aeb503e8-565b-42ea-91e2-9f127a74c00c.png)
  
6. В окне **разделить столбец по разделителю** выполните следующие действия: 
    
      - В разделе **Выбор и ввод разделителя**выберите **запятая**.
    
      - В разделе **разделить**выберите **при каждом возникновении разделителя**.
    
7. Нажмите кнопку **ОК**.
    
    Столбец **detail** разделяется на несколько столбцов. Каждый новый столбец называется **detail. 1**, **detail. 2**, **detail. 3**и т. д. Вы заметите значения в каждой ячейке в столбцах **detail. n** с префиксом имя свойства; Например, **Operation: Sharing**, **Operation: шарингинвитатионакцептед**и **Operation: шарингинвитатионкреатед**.
    
    ![Столбец Detail разделяется на несколько столбцов, по одному для каждого свойства.](media/4b104ead-0313-4bd4-b2a9-f143ccb378ac.png)
  
8. На вкладке **файл** нажмите кнопку **Закрыть &amp; загрузку** , чтобы закрыть редактор запросов и открыть файл в книге Excel. 
    
    Следующий шаг состоит в том, чтобы отфильтровать файл, **** чтобы отображались только события Sharing и **шарингинвитатионкреатед** . 
    
9. Перейдите на вкладку **Главная** и выберите столбец **Action (действие** ). 
    
10. В раскрывающемся списке **фильтр &amp; сортировки** снимите все флажки, а затем выберите пункт **общий доступ** и **шарингинвитатионкреатед**, а затем нажмите кнопку **ОК**.
    
    Excel отображает строки для событий **общего доступа** и **шарингинвитатионкреатед** . 
    
11. Перейдите к столбцу с именем **detail. 17** (или к любому столбцу, содержащему свойство **таржетусерорграуптипе** ) и выберите его. 
    
12. В раскрывающемся списке **Сортировка &amp; фильтра** снимите все флажки, затем выберите **таржетусерорграуптипе: гость**и нажмите кнопку **ОК**.
    
    Теперь в Excel отображаются строки для событий **шарингинвитатионкреатед** и **общего доступа** , а целевой пользователь находится за пределами Организации, так как внешние пользователи определяются значением **таржетусерорграуптипе: гость**. 
    
В приведенной ниже таблице показаны все пользователи в Организации, совместно использующих общие ресурсы с гостевым пользователем в указанном диапазоне дат.
  
![Общий доступ к событиям в журнале аудита Office 365](media/0e0ecbe3-c794-4ca6-a2ca-63478fb3bb34.png)
  
Несмотря на то, что он не включен в предыдущую таблицу, столбец **detail. 10** (или любой столбец содержит свойство **ObjectID** ) идентифицирует ресурс, к которому предоставлен доступ конечному пользователю; например `ObjectId:https:\/\/contoso-my.sharepoint.com\/personal\/sarad_contoso_com\/Documents\/Southwater Proposal.docx`:.
  
> [!TIP]
> Если вы хотите определить, когда гостевой пользователю фактически были назначены разрешения на доступ к ресурсу (а не только к ресурсам, в которых они совместно используются), повторите шаги 10, 11 и 12, а затем примените фильтр к **шарингинвитатионакцептед** и общему набору. ** **события, которые находятся на шаге 10. 
